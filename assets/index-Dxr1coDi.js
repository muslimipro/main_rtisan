import{B as He,Z as _e,U as We,V as Ze,W as Ye,X as Xe,Y as Qe,x as fe,$ as Je,a0 as et,a1 as Se,a2 as tt,o as a,p as B,z as T,c as p,m as U,g as k,a3 as pe,a4 as Re,a5 as oe,F as q,j as g,n as nt,t as st,q as D,a6 as ot,s as at,d as lt,u as rt,r as v,a7 as Be,e as re,a as O,b as z,f as ve,P as H,l as he,a8 as it,a9 as ut,A as ct,E as Ve,D as Ee,aa as dt,i as o,ab as $e,M as pt,k as Ce,O as ft,L as vt,ac as ht,Q as ae,ad as mt,w as wt,ae as gt}from"./index-CG54iUaD.js";import{u as Pe,_ as yt,d as bt}from"./defaultConfirmDeleteOptions-BEDASNM7.js";import{u as Ae,c as kt,a as xt,b as Te,T as _t}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-DWFNPQ5a.js";import{S as Ct}from"./SimulationView-CdELHY4c.js";import{_ as Lt}from"./CodeViewer.vue_vue_type_script_setup_true_lang-yMfe0YiQ.js";import{L as St}from"./lessonApi-b6EWekY5.js";import{m as $t}from"./mapLessonFromDto-BxEkOMg4.js";import{U as le}from"./unitApi-J763zgrL.js";import{m as Bt}from"./mapUnitFromDto-BXFFFlEW.js";var Et=function(e){var n=e.dt;return`
.p-drawer {
    display: flex;
    flex-direction: column;
    transform: translate3d(0px, 0px, 0px);
    position: relative;
    transition: transform 0.3s;
    background: `.concat(n("drawer.background"),`;
    color: `).concat(n("drawer.color"),`;
    border: 1px solid `).concat(n("drawer.border.color"),`;
    box-shadow: `).concat(n("drawer.shadow"),`;
}

.p-drawer-content {
    overflow-y: auto;
    flex-grow: 1;
    padding: `).concat(n("drawer.content.padding"),`;
}

.p-drawer-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
    padding: `).concat(n("drawer.header.padding"),`;
}

.p-drawer-footer {
    padding: `).concat(n("drawer.footer.padding"),`;
}

.p-drawer-title {
    font-weight: `).concat(n("drawer.title.font.weight"),`;
    font-size: `).concat(n("drawer.title.font.size"),`;
}

.p-drawer-full .p-drawer {
    transition: none;
    transform: none;
    width: 100vw !important;
    height: 100vh !important;
    max-height: 100%;
    top: 0px !important;
    left: 0px !important;
    border-width: 1px;
}

.p-drawer-left .p-drawer-enter-from,
.p-drawer-left .p-drawer-leave-to {
    transform: translateX(-100%);
}

.p-drawer-right .p-drawer-enter-from,
.p-drawer-right .p-drawer-leave-to {
    transform: translateX(100%);
}

.p-drawer-top .p-drawer-enter-from,
.p-drawer-top .p-drawer-leave-to {
    transform: translateY(-100%);
}

.p-drawer-bottom .p-drawer-enter-from,
.p-drawer-bottom .p-drawer-leave-to {
    transform: translateY(100%);
}

.p-drawer-full .p-drawer-enter-from,
.p-drawer-full .p-drawer-leave-to {
    opacity: 0;
}

.p-drawer-full .p-drawer-enter-active,
.p-drawer-full .p-drawer-leave-active {
    transition: opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1);
}

.p-drawer-left .p-drawer {
    width: 20rem;
    height: 100%;
    border-inline-end-width: 1px;
}

.p-drawer-right .p-drawer {
    width: 20rem;
    height: 100%;
    border-inline-start-width: 1px;
}

.p-drawer-top .p-drawer {
    height: 10rem;
    width: 100%;
    border-block-end-width: 1px;
}

.p-drawer-bottom .p-drawer {
    height: 10rem;
    width: 100%;
    border-block-start-width: 1px;
}

.p-drawer-left .p-drawer-content,
.p-drawer-right .p-drawer-content,
.p-drawer-top .p-drawer-content,
.p-drawer-bottom .p-drawer-content {
    width: 100%;
    height: 100%;
}

.p-drawer-open {
    display: flex;
}

.p-overlay-mask:dir(rtl) {
    flex-direction: row-reverse;
}
`)},It={mask:function(e){var n=e.position,u=e.modal;return{position:"fixed",height:"100%",width:"100%",left:0,top:0,display:"flex",justifyContent:n==="left"?"flex-start":n==="right"?"flex-end":"center",alignItems:n==="top"?"flex-start":n==="bottom"?"flex-end":"center",pointerEvents:u?"auto":"none"}},root:{pointerEvents:"auto"}},Dt={mask:function(e){var n=e.instance,u=e.props,l=["left","right","top","bottom"],c=l.find(function(y){return y===u.position});return["p-drawer-mask",{"p-overlay-mask p-overlay-mask-enter":u.modal,"p-drawer-open":n.containerVisible,"p-drawer-full":n.fullScreen},c?"p-drawer-".concat(c):""]},root:function(e){var n=e.instance;return["p-drawer p-component",{"p-drawer-full":n.fullScreen}]},header:"p-drawer-header",title:"p-drawer-title",pcCloseButton:"p-drawer-close-button",content:"p-drawer-content",footer:"p-drawer-footer"},At=He.extend({name:"drawer",theme:Et,classes:Dt,inlineStyles:It}),Rt={name:"BaseDrawer",extends:at,props:{visible:{type:Boolean,default:!1},position:{type:String,default:"left"},header:{type:null,default:null},baseZIndex:{type:Number,default:0},autoZIndex:{type:Boolean,default:!0},dismissable:{type:Boolean,default:!0},showCloseIcon:{type:Boolean,default:!0},closeButtonProps:{type:Object,default:function(){return{severity:"secondary",text:!0,rounded:!0}}},closeIcon:{type:String,default:void 0},modal:{type:Boolean,default:!0},blockScroll:{type:Boolean,default:!1}},style:At,provide:function(){return{$pcDrawer:this,$parentInstance:this}}},ze={name:"Drawer",extends:Rt,inheritAttrs:!1,emits:["update:visible","show","after-show","hide","after-hide"],data:function(){return{containerVisible:this.visible}},container:null,mask:null,content:null,headerContainer:null,footerContainer:null,closeButton:null,outsideClickListener:null,documentKeydownListener:null,watch:{dismissable:function(e){e?this.enableDocumentSettings():this.disableDocumentSettings()}},updated:function(){this.visible&&(this.containerVisible=this.visible)},beforeUnmount:function(){this.disableDocumentSettings(),this.mask&&this.autoZIndex&&_e.clear(this.mask),this.container=null,this.mask=null},methods:{hide:function(){this.$emit("update:visible",!1)},onEnter:function(){this.$emit("show"),this.focus(),this.bindDocumentKeyDownListener(),this.autoZIndex&&_e.set("modal",this.mask,this.baseZIndex||this.$primevue.config.zIndex.modal)},onAfterEnter:function(){this.enableDocumentSettings(),this.$emit("after-show")},onBeforeLeave:function(){this.modal&&!this.isUnstyled&&We(this.mask,"p-overlay-mask-leave")},onLeave:function(){this.$emit("hide")},onAfterLeave:function(){this.autoZIndex&&_e.clear(this.mask),this.unbindDocumentKeyDownListener(),this.containerVisible=!1,this.disableDocumentSettings(),this.$emit("after-hide")},onMaskClick:function(e){this.dismissable&&this.modal&&this.mask===e.target&&this.hide()},focus:function(){var e=function(l){return l&&l.querySelector("[autofocus]")},n=this.$slots.header&&e(this.headerContainer);n||(n=this.$slots.default&&e(this.container),n||(n=this.$slots.footer&&e(this.footerContainer),n||(n=this.closeButton))),n&&Ze(n)},enableDocumentSettings:function(){this.dismissable&&!this.modal&&this.bindOutsideClickListener(),this.blockScroll&&Ye()},disableDocumentSettings:function(){this.unbindOutsideClickListener(),this.blockScroll&&Xe()},onKeydown:function(e){e.code==="Escape"&&this.hide()},containerRef:function(e){this.container=e},maskRef:function(e){this.mask=e},contentRef:function(e){this.content=e},headerContainerRef:function(e){this.headerContainer=e},footerContainerRef:function(e){this.footerContainer=e},closeButtonRef:function(e){this.closeButton=e?e.$el:void 0},bindDocumentKeyDownListener:function(){this.documentKeydownListener||(this.documentKeydownListener=this.onKeydown,document.addEventListener("keydown",this.documentKeydownListener))},unbindDocumentKeyDownListener:function(){this.documentKeydownListener&&(document.removeEventListener("keydown",this.documentKeydownListener),this.documentKeydownListener=null)},bindOutsideClickListener:function(){var e=this;this.outsideClickListener||(this.outsideClickListener=function(n){e.isOutsideClicked(n)&&e.hide()},document.addEventListener("click",this.outsideClickListener))},unbindOutsideClickListener:function(){this.outsideClickListener&&(document.removeEventListener("click",this.outsideClickListener),this.outsideClickListener=null)},isOutsideClicked:function(e){return this.container&&!this.container.contains(e.target)}},computed:{fullScreen:function(){return this.position==="full"},closeAriaLabel:function(){return this.$primevue.config.locale.aria?this.$primevue.config.locale.aria.close:void 0}},directives:{focustrap:Qe},components:{Button:fe,Portal:Je,TimesIcon:et}},Vt=["aria-modal"];function Pt(t,e,n,u,l,c){var y=Se("Button"),$=Se("Portal"),h=tt("focustrap");return a(),B($,null,{default:T(function(){return[l.containerVisible?(a(),p("div",U({key:0,ref:c.maskRef,onMousedown:e[0]||(e[0]=function(){return c.onMaskClick&&c.onMaskClick.apply(c,arguments)}),class:t.cx("mask"),style:t.sx("mask",!0,{position:t.position,modal:t.modal})},t.ptm("mask")),[k(pe,U({name:"p-drawer",onEnter:c.onEnter,onAfterEnter:c.onAfterEnter,onBeforeLeave:c.onBeforeLeave,onLeave:c.onLeave,onAfterLeave:c.onAfterLeave,appear:""},t.ptm("transition")),{default:T(function(){return[t.visible?Re((a(),p("div",U({key:0,ref:c.containerRef,class:t.cx("root"),style:t.sx("root"),role:"complementary","aria-modal":t.modal},t.ptmi("root")),[t.$slots.container?oe(t.$slots,"container",{key:0,closeCallback:c.hide}):(a(),p(q,{key:1},[g("div",U({ref:c.headerContainerRef,class:t.cx("header")},t.ptm("header")),[oe(t.$slots,"header",{class:nt(t.cx("title"))},function(){return[t.header?(a(),p("div",U({key:0,class:t.cx("title")},t.ptm("title")),st(t.header),17)):D("",!0)]}),t.showCloseIcon?(a(),B(y,U({key:0,ref:c.closeButtonRef,type:"button",class:t.cx("pcCloseButton"),"aria-label":c.closeAriaLabel,unstyled:t.unstyled,onClick:c.hide},t.closeButtonProps,{pt:t.ptm("pcCloseButton"),"data-pc-group-section":"iconcontainer"}),{icon:T(function(r){return[oe(t.$slots,"closeicon",{},function(){return[(a(),B(ot(t.closeIcon?"span":"TimesIcon"),U({class:[t.closeIcon,r.class]},t.ptm("pcCloseButton").icon),null,16,["class"]))]})]}),_:3},16,["class","aria-label","unstyled","onClick","pt"])):D("",!0)],16),g("div",U({ref:c.contentRef,class:t.cx("content")},t.ptm("content")),[oe(t.$slots,"default")],16),t.$slots.footer?(a(),p("div",U({key:0,ref:c.footerContainerRef,class:t.cx("footer")},t.ptm("footer")),[oe(t.$slots,"footer")],16)):D("",!0)],64))],16,Vt)),[[h]]):D("",!0)]}),_:3},16,["onEnter","onAfterEnter","onBeforeLeave","onLeave","onAfterLeave"])],16)):D("",!0)]}),_:3})}ze.render=Pt;async function Le(t){const n=new TextEncoder().encode(t),u=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(u)).map(y=>y.toString(16).padStart(2,"0")).join("")}function Tt(t){let e="",n=!1;for(let u=0;u<t.length;u++){const l=t[u];if(l==="#"&&(n=!0),n)if(l===`
`)n=!1;else continue;l!==" "&&l!=="	"&&l!==`
`&&l!=="\r"&&(e+=l)}return e}function zt(t,e){if(t.length!==e.length)return!1;const n=[...t].sort(),u=[...e].sort();return n.every((l,c)=>l===u[c])}const me=lt("lesson-store",()=>{const t=rt(),e=v(null),n=v(!1),u=v(!1),l=v(!1),c=v(!1),y=v(!1),$=v(0),h=v(0),r=v([]),_=v(0),b=v(new Map),A=v(new Map),f=v([]),i=v("continue"),C=v(!1),x=v(!1),S=v(!1),N=v(!0),V=v(""),X=v(null),Q=v(null),J=v([]),ee=v([]),we=Be(),ge=Pe(),{lang:ye}=re(ge),G=v(void 0),te=O(()=>{var s;return S.value&&(((s=X.value)==null?void 0:s.modulesWerePut)??!0)&&N.value});async function be(s,m){try{n.value=!0,b.value.clear(),A.value.clear(),G.value=we.userRole==="editor"?ye.value:void 0;const{data:w}=await St.getLessonById(s,m,G.value);e.value=$t(w),e.value.stage=="published"&&ie()}catch(w){t.add({severity:"error",summary:w.response.data.error,life:2e3})}finally{n.value=!1}}async function ie(){if(e.value)try{y.value=!0,$.value=0,b.value.clear();const s=[];e.value.pages.forEach(L=>{L.groups.forEach(E=>{E.units.forEach(se=>{s.push({id:se.id,lessonId:e.value.id})})})});const m=s.length,w=5;for(let L=0;L<s.length;L+=w){const se=s.slice(L,L+w).map(async({id:ke,lessonId:qe})=>{try{const{data:xe}=await le.getUnitByIdandLessonId(ke,qe,G.value);b.value.set(ke,xe)}catch(xe){console.warn(`Failed to preload unit ${ke}:`,xe)}});await Promise.all(se),$.value=Math.round(Math.min(L+w,m)/m*100)}}catch(s){console.error("Error preloading units:",s)}finally{y.value=!1}}async function j(s,m){if(b.value.has(s))return b.value.get(s);try{u.value=!0;const{data:w}=await le.getUnitByIdandLessonId(s,m,G.value);return b.value.set(s,w),w}catch(w){t.add({severity:"error",summary:w.response.data.error,life:2e3})}finally{u.value=!1}}async function F(){if(e.value!=null){l.value=!0,r.value=[],h.value=0,_.value=0,f.value=[],V.value="",ee.value=[],x.value=!1;for(let s=0;s<e.value.pages.length;s++)f.value.push(0);i.value="continue",R(),r.value.push(e.value.pages[h.value].groups[_.value]),await W(e.value.id),l.value=!1}}function ne(s,m){let w="";if(V.value==""||m.content.starting!=""){w=`emulator-${m.id}`;const L=m.content.starting;Q.value=Ae(w),Q.value.setCode(L)}V.value=w??V.value,s=="pibody"&&(X.value=xt(V.value),J.value=m.data.neededModules,X.value.addNeededModules(J.value),w!=""&&(ee.value=[]))}async function W(s){S.value=!1,C.value=!1;for(let m=0;m<r.value[_.value].units.length;m++){const w=r.value[_.value].units[m];["options","open","code","pibody"].includes(w.unitType)&&(i.value="check",C.value=!0);const L=await j(w.id,s);if(L){const E=Bt(L);r.value[_.value].units[m].content=E==null?void 0:E.content,r.value[_.value].units[m].data=E==null?void 0:E.data,r.value[_.value].units[m].studentState=E==null?void 0:E.studentState,["code","pibody"].includes(w.unitType)&&(S.value=!0,E.content.answer==""&&E.data.tests.lenght==0||(N.value=!1),ne(w.unitType,E))}}i.value=="continue"&&await ue()}async function ue(){if(e.value!=null)try{c.value=!0,x.value=!1;for(const s of r.value[r.value.length-1].units){if(A.value.set(s.id,s.studentState.answer),["code","pibody"].includes(s.unitType)){const m=Ae(V.value).code.value;if(s.data.tests.length>0){const w=await kt(V.value,m,s.data.tests,s.data.includedCommands);x.value=w.correct}else if(!s.content.hashed_answer)x.value=!0;else{const w=Tt(m),L=await Le(w);x.value=s.content.hashed_answer===L}}else if(s.unitType=="open"){const w=String(s.studentState.answer.open??"").replace(/ /g,"").toLowerCase(),L=await Le(w);x.value=s.content.hashed_answer===L}else if(s.unitType=="options"){const m=s.studentState.answer.options,w=[];for(const L of m)w.push(await Le(L));x.value=zt(s.content.hashed_answer,w)}else x.value=!0;if(x.value==!1)break}r.value[r.value.length-1].units.length||(x.value=!0),x.value?(f.value[h.value]++,_.value>=e.value.pages[h.value].groups.length-1?h.value<e.value.pages.length-1?i.value="continue":i.value="finish":i.value="continue"):i.value="try-again"}finally{c.value=!1}}async function P(){if(e.value!=null){if(_.value>=e.value.pages[h.value].groups.length-1){await De(),Ie();return}l.value=!0,_.value++,r.value.push(e.value.pages[h.value].groups[_.value]),await W(e.value.id),l.value=!1}}async function d(s){const m=r.value[r.value.length-1].id;i.value="continue",f.value[h.value]--,_.value--,r.value.pop(),m==s?h.value==0&&r.value.length==0?await F():await P():await d(s)}function R(){if(!e.value)return;let s=0;for(const m of e.value.pages)if(m.groups.every(L=>L.units.every(E=>E.studentStatus==="completed")))s!=e.value.pages.length-1&&(f.value[s]=m.groups.length,s++);else break;h.value=s}function Z(){h.value!=0&&(f.value[h.value]=0,f.value[h.value-1]=0,h.value-=2,Ie())}function K(s,m){if(e.value!=null){for(const[w,L]of r.value.entries())for(const[E,se]of L.units.entries())if(se.id==s){r.value[w].units[E].studentState.answer=m;break}}}async function ce(){e.value!=null&&(i.value="check")}async function I(){e.value!=null&&(await De(),i.value="completed")}function de(){b.value.clear(),$.value=0,y.value=!1}async function Ie(){e.value!=null&&(l.value=!0,h.value++,r.value=[],_.value=0,i.value="continue",r.value.push(e.value.pages[h.value].groups[_.value]),await W(e.value.id),l.value=!1)}function Ne(s){S.value=s}function Me(){N.value=!0}async function Oe(s){if(V.value=="")return;const m=Number(V.value.split("-")[1]);K(m,s),await le.saveUnitByIdandLessonId(m,e.value.id,{answer:s})}async function De(){if(l.value=!0,e.value==null)return;const s=Array.from(A.value.entries()).map(([w,L])=>({id:w,student_answer:L})),{data:m}=await le.submitUnitsByLessonId(e.value.id,s);x.value=m.correct,A.value=new Map,l.value=!1}const M=O(()=>e.value?e.value.pages[h.value]??null:null),Y=O(()=>M.value?M.value.groups[_.value]??null:null),Ge=O({get:()=>{var s;return((s=Y.value)==null?void 0:s.pibodyDrawerVisible)??!1},set:s=>{Y.value&&(Y.value.pibodyDrawerVisible=s)}}),je=O({get:()=>{var s;return((s=Y.value)==null?void 0:s.codeDrawerVisible)??!1},set:s=>{Y.value&&(Y.value.codeDrawerVisible=s)}}),Fe=O({get:()=>{var s;return((s=M.value)==null?void 0:s.showPibody)??!1},set:s=>{M.value&&(M.value.showPibody=s)}}),Ke=O({get:()=>{var s;return((s=M.value)==null?void 0:s.showCode)??!1},set:s=>{M.value&&(M.value.showCode=s)}});return{selectedLesson:e,isLessonLoading:n,isUnitLoading:u,groups:r,groupIndex:_,isGroupLoading:l,isSubmitLoading:c,isPreloadingUnits:y,preloadingProgress:$,groupStatus:i,submitExist:C,correct:x,submitEnabled:te,pageProgress:f,emulatorID:V,neededModules:J,slots:ee,pibodyDrawerVisible:Ge,codeDrawerVisible:je,showPibody:Fe,showCode:Ke,setSubmitable:Ne,loadLessonById:be,loadUnitByIdandLessonId:j,preloadAllUnits:ie,clearUnitsCache:de,loadInitialGroup:F,submitGroup:ue,nextGroup:P,saveAnswer:K,tryAgain:ce,finishLesson:I,runCodePressed:Me,saveStudentIdeState:Oe,resetGroup:d,pageBack:Z}}),Ue=z({__name:"MdViewer",props:{text:{}},setup(t){const e=t;return(n,u)=>{const l=Se("v-md-preview");return a(),B(l,{text:e.text},null,8,["text"])}}}),Ut=z({__name:"ArticleViewer",props:{article:{}},setup(t){const e=t;return(n,u)=>(a(),B(Ue,{text:e.article.text},null,8,["text"]))}}),Nt={class:"flex flex-col gap-4 pl-4"},Mt=z({__name:"OptionsViewer",props:{optionsData:{},state:{}},emits:["save-answer"],setup(t,{emit:e}){const n=t,u=e,l=v(!1),c=v(!1),y=v(!1),$=v([]),h=v([]),r=v();return ve(()=>{var _,b,A,f,i,C;l.value=((_=n.optionsData)==null?void 0:_.shuffle)??!1,c.value=((b=n.optionsData)==null?void 0:b.feedback)??!1,y.value=((A=n.optionsData)==null?void 0:A.single)??!1,$.value=((f=n.optionsData)==null?void 0:f.options)??[],h.value=((i=n.state.answer)==null?void 0:i.options)??[],r.value=n.state.answer&&n.state.answer.options&&n.state.answer.options.length>0?(C=n.state)==null?void 0:C.answer.options[0]:void 0}),H([r,h,c],()=>{y.value&&r.value?u("save-answer",{options:[r.value],feedback:c.value}):u("save-answer",{options:h.value,feedback:c.value})},{deep:!0}),(_,b)=>{const A=it,f=ut;return a(),p("div",Nt,[(a(!0),p(q,null,he($.value,i=>(a(),p("div",{key:i.id,class:"flex gap-2 items-center"},[y.value?(a(),B(A,{key:0,modelValue:r.value,"onUpdate:modelValue":b[0]||(b[0]=C=>r.value=C),value:i.id},null,8,["modelValue","value"])):(a(),B(f,{key:1,modelValue:h.value,"onUpdate:modelValue":b[1]||(b[1]=C=>h.value=C),value:i.id},null,8,["modelValue","value"])),k(Ue,{text:i.text},null,8,["text"])]))),128))])}}}),Ot=z({__name:"OpenViewer",props:{state:{}},emits:["save-answer"],setup(t,{emit:e}){const n=t,u=e,l=v("");return ve(()=>{l.value=n.state.answer.open}),H(l,()=>{u("save-answer",{open:l.value})}),(c,y)=>{const $=ct;return a(),B($,{type:"text",modelValue:l.value,"onUpdate:modelValue":y[0]||(y[0]=h=>l.value=h),class:"w-full",size:"small"},null,8,["modelValue"])}}}),Gt={key:0,style:{position:"relative",width:"100%",height:"0","padding-bottom":"56.25%"}},jt=["src"],Ft={key:1,style:{position:"relative","margin-left":"5%",width:"90%",height:"0","padding-bottom":"160%"}},Kt=["src"],qt=z({__name:"VideoViewer",props:{video:{}},setup(t){const e=t;function n(u){return u.replace("shorts","embed")}return(u,l)=>e.video.url.includes("embed")?(a(),p("div",Gt,[g("iframe",{credentialless:"",src:n(e.video.url),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,jt)])):(a(),p("div",Ft,[g("iframe",{credentialless:"",src:n(e.video.url??""),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},frameborder:"0",allowfullscreen:"",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin"},null,8,Kt)]))}}),Ht={key:1,class:"flex-grow px-4 py-2"},Wt=z({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},setup(t){const e=t,n=Ve(),u=me(),{saveAnswer:l,setSubmitable:c}=u;function y(r){e.unit.unitType=="options"?c(r.options.length>0):e.unit.unitType=="open"&&c(r.open.length>0),l(e.unit.id,r),$(r)}const $=Te(r=>{h(r)},1e3,{maxWait:5e3});async function h(r){await le.saveUnitByIdandLessonId(e.unit.id,Number(n.params.id),{answer:r})}return(r,_)=>{const b=Ee;return a(),p("div",null,[r.loading?(a(),B(b,{key:0,class:"flex justify-center items-center w-10 h-full"})):(a(),p("div",Ht,[e.unit.unitType=="article"?(a(),B(Ut,{key:0,article:e.unit.content},null,8,["article"])):e.unit.unitType=="options"?(a(),B(Mt,{key:1,"options-data":e.unit.content,state:e.unit.studentState,onSaveAnswer:y},null,8,["options-data","state"])):e.unit.unitType=="open"?(a(),B(Ot,{key:2,state:e.unit.studentState,onSaveAnswer:y},null,8,["state"])):e.unit.unitType=="video"?(a(),B(qt,{key:3,video:e.unit.content},null,8,["video"])):D("",!0)]))])}}}),Zt={key:1,class:"flex flex-col h-full w-full"},Yt={class:"flex-grow flex flex-col gap-4 px-4 py-2"},Xt=z({__name:"GroupCard",props:{group:{},loading:{type:Boolean}},setup(t){const e=t,n=v(null);return H(()=>e.loading,u=>{u===!1&&n.value&&requestAnimationFrame(()=>{var l;(l=n.value)==null||l.scrollIntoView({behavior:"smooth",block:"start"})})}),(u,l)=>{const c=Ee;return a(),p("div",{ref_key:"groupRef",ref:n},[u.loading?(a(),B(c,{key:0,class:"flex justify-center items-center w-10 h-full"})):(a(),p("div",Zt,[g("div",Yt,[(a(!0),p(q,null,he(u.group.units,y=>(a(),B(Wt,{key:y.id,unit:y},null,8,["unit"]))),128))])]))],512)}}}),Qt={key:0,class:"absolute right-0"},Jt=z({__name:"UnitsView",props:{pages:{}},setup(t){const e=me(),{groups:n,isGroupLoading:u}=re(e),{loadInitialGroup:l,resetGroup:c}=e,y=Be(),$=v(null),h=v(null),r=v(0);function _(f){let i=f;for(;i&&i.parentElement;){const C=i.parentElement,S=getComputedStyle(C).overflowY;if(S==="auto"||S==="scroll")return C;i=C}return null}async function b(){await pt();const f=_($.value),i=h.value;if(!f||!i){r.value=0;return}const C=f.clientHeight,x=i.getBoundingClientRect().height,S=Math.max(0,C-x);r.value=S}function A(f,i){var S;const C=(S=n.value[n.value.length-1])==null?void 0:S.id;let x=null;f&&(f instanceof Element?x=f:f.$el instanceof Element&&(x=f.$el)),h.value=i.id===C?x:null}return ve(()=>{l(),b(),window.addEventListener("resize",b)}),dt(()=>{window.removeEventListener("resize",b)}),H(()=>n.value.length,async()=>{await b()}),H(()=>u.value,async(f,i)=>{i===!0&&f===!1&&await b()}),(f,i)=>{const C=fe,x=_t;return a(),p("div",{ref_key:"rootEl",ref:$,class:"flex flex-col gap-8"},[(a(!0),p(q,null,he(o(n),S=>(a(),p("div",{key:S.id,ref_for:!0,ref:N=>A(N,S),class:"relative"},[!o(u)&&o(y).userRole=="editor"?(a(),p("div",Qt,[Re((a(),B(C,{type:"button",class:"w-9 h-9 mr-8 mt-2",rounded:"",severity:"secondary",variant:"text",onClick:N=>o(c)(S.id)},{default:T(()=>i[0]||(i[0]=[g("span",{class:"material-icons"},"restart_alt",-1)])),_:2},1032,["onClick"])),[[x,"Reset step",void 0,{left:!0}]])])):D("",!0),k(Xt,{group:S,loading:o(u)&&S.id==o(n)[o(n).length-1].id},null,8,["group","loading"])]))),128)),g("div",{style:$e({height:r.value+"px"})},null,4)],512)}}}),en={key:0,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},tn={key:1},nn={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},sn={key:"incorrect",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-red-100"},on={key:"no-submit",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},an={key:"try-again",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-gray-50"},ln={key:2},rn={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},un={key:1,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},cn=z({__name:"NavigationBar",setup(t){const e=me(),{isSubmitLoading:n,groupStatus:u,isGroupLoading:l,submitExist:c,correct:y,submitEnabled:$}=re(e),{submitGroup:h,nextGroup:r,tryAgain:_,finishLesson:b}=e;return(A,f)=>{const i=fe;return a(),p(q,null,[o(u)=="check"?(a(),p("div",en,[k(i,{label:"CHECK",icon:"pi pi-check","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:o(h),loading:o(n),disabled:o(n)||!o($)},null,8,["onClick","loading","disabled"])])):D("",!0),o(u)=="continue"?(a(),p("div",tn,[k(pe,{name:"pop",appear:"",mode:"out-in"},{default:T(()=>[o(c)&&o(y)?(a(),p("div",nn,[f[0]||(f[0]=g("div",{class:"text-lg font-bold flex items-center gap-2"},[g("span",{class:"text-3xl"},"🎉"),Ce(" Correct!")],-1)),k(i,{label:"CONTINUE",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:o(r),loading:o(l),disabled:o(l)},null,8,["onClick","loading","disabled"])])):o(c)&&!o(y)?(a(),p("div",sn,[k(i,{label:"CONTINUE",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:o(r),loading:o(l),disabled:o(l)},null,8,["onClick","loading","disabled"])])):(a(),p("div",on,[k(i,{label:"CONTINUE",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:o(r),loading:o(l),disabled:o(l)},null,8,["onClick","loading","disabled"])]))]),_:1})])):D("",!0),k(pe,{name:"shake",appear:""},{default:T(()=>[o(u)=="try-again"?(a(),p("div",an,[f[1]||(f[1]=g("div",{class:"text-lg font-bold flex items-center gap-2"},[g("span",{class:"text-3xl"},"⚠️"),Ce(" Incorrect!")],-1)),k(i,{label:"TRY AGAIN",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:o(_)},null,8,["onClick"])])):D("",!0)]),_:1}),o(u)=="finish"?(a(),p("div",ln,[o(c)&&o(y)?(a(),p("div",rn,[f[2]||(f[2]=g("div",{class:"text-lg font-bold flex items-center gap-2"},[g("span",{class:"text-3xl"},"🎉"),Ce(" Correct!")],-1)),k(i,{label:"FINISH",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:o(b),loading:o(l),disabled:o(l)},null,8,["onClick","loading","disabled"])])):(a(),p("div",un,[k(i,{label:"FINISH",icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:o(b)},null,8,["onClick"])]))])):D("",!0)],64)}}}),dn=ft(cn,[["__scopeId","data-v-fdc42d8d"]]),pn={key:0,class:"h-screen flex flex-col items-center overflow-hidden relative"},fn={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 max-w-[1920px] mx-auto"},vn={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},hn={class:"flex items-center gap-4"},mn={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4"},wn={class:"flex-1 overflow-y-auto mt-16 mb-24 w-full"},gn={key:1,class:"flex justify-center"},yn={key:2},bn={key:3,class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-50 border border-gray-200 flex flex-col items-center gap-4"},kn={key:4,class:"fixed top-20 right-4 bg-white rounded-lg shadow-md z-50 border border-gray-200 p-4 min-w-64"},xn={class:"flex items-center gap-3 mb-2"},_n={class:"fixed bottom-0 left-0 right-0 z-50 bg-white shadow-md max-w-[1920px] mx-auto"},Cn={key:0,class:"absolute left-0 top-1/2 -translate-y-1/2"},Ln={class:"relative h-full"},Sn={class:"absolute -right-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},$n={key:1,class:"absolute right-0 top-1/2 -translate-y-1/2"},Bn={class:"relative h-full"},En={class:"absolute -left-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},In={key:0,class:"h-screen flex flex-col items-center justify-center overflow-hidden gap-10"},Mn=z({__name:"LessonPage",setup(t){const e=Ve(),n=wt(),u=vt(),l=Be(),c=Pe(),{lang:y}=re(c);H(y,async(P,d)=>{P!==d&&r.value&&await Q(Number(e.params.id),(e.query.route_id??"").toString())});const $=me(),{isLessonLoading:h,selectedLesson:r,pageProgress:_,groupStatus:b,emulatorID:A,neededModules:f,slots:i,pibodyDrawerVisible:C,codeDrawerVisible:x,showPibody:S,showCode:N,isPreloadingUnits:V,preloadingProgress:X}=re($),{loadLessonById:Q,runCodePressed:J,saveStudentIdeState:ee,pageBack:we}=$;function ge(){u.require({...bt,header:"Close lesson",message:"Are you sure you want to exit lesson. All progress will be lost!",acceptProps:{label:"Close",severity:"danger"},accept:()=>G()})}function ye(P){var R;const d=((R=r.value)==null?void 0:R.pages.reduce((Z,K)=>Z+K.groups.length,0))||1;return P/d*100}function G(){l.userRole=="editor"?e.query.route_id&&e.query.route_id!=""?n.push(`/v2/route/${e.query.route_id}/edit`):n.push("/v2/routes"):e.query.route_id&&e.query.route_id!=""?n.push("/v2/route/"+e.query.route_id):n.push("/v2/home")}const te=v("");H([te,i],()=>{be({code:te.value,slots:i.value})});const be=Te(P=>{ee(P)},1e3,{maxWait:5e3});function ie(P){te.value=P.code}const j=v(window.innerWidth),F=v(16);function ne(){if(j.value=window.innerWidth,j.value<=1300){F.value=16;return}const d=452-(j.value-1024)/2;F.value=d>16?d:16}ve(()=>{b.value="continue",ne(),Q(Number(e.params.id),(e.query.route_id??"").toString()),window.addEventListener("resize",ne)}),ht(()=>{window.removeEventListener("resize",ne)});const W=O(()=>j.value<=1920?{}:"calc((-100vw + 1920px) / 2)"),ue=()=>{n.push(`${e.path}/edit`)};return(P,d)=>{const R=fe,Z=gt,K=Ee,ce=ze;return a(),p(q,null,[o(b)!="completed"?(a(),p("div",pn,[g("div",fn,[g("div",vn,[g("div",hn,[k(R,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:ge})]),o(r)?(a(),p("div",mn,[(a(!0),p(q,null,he(o(r).pages,(I,de)=>(a(),p("div",{key:de,class:"h-full",style:$e({width:ye(I.groups.length)+"%"})},[k(Z,{value:o(_)[de]/I.groups.length*100,"show-value":!1,class:"w-full rounded-full h-3"},null,8,["value"])],4))),128))])):D("",!0),d[9]||(d[9]=g("div",{class:"w-10"},null,-1))])]),g("div",wn,[g("div",{class:"w-full h-full max-w-screen-lg mx-auto py-8",style:$e({paddingLeft:F.value+"px",paddingRight:F.value+"px"})},[o(h)?(a(),B(K,{key:0,class:"flex justify-center"})):o(r)?(a(),p("div",yn,[k(Jt,{pages:o(r).pages},null,8,["pages"])])):(a(),p("div",gn,"No lesson found")),o(l).userRole=="editor"?(a(),p("div",bn,[k(o(yt)),k(R,{icon:"pi pi-pencil",variant:"text",severity:"contrast",onClick:ue}),k(R,{variant:"text",severity:"contrast",onClick:o(we)},{default:T(()=>d[10]||(d[10]=[g("span",{class:"material-icons"},"swipe_left_alt",-1)])),_:1},8,["onClick"])])):D("",!0),o(V)?(a(),p("div",kn,[g("div",xn,[k(K,{style:{width:"20px",height:"20px"}}),d[11]||(d[11]=g("span",{class:"text-sm font-medium"},"Preloading units...",-1))]),k(Z,{value:o(X),"show-value":!0,class:"h-2"},null,8,["value"])])):D("",!0)],4)]),g("div",_n,[k(dn)]),o(S)?(a(),p("div",Cn,[k(R,{icon:"pi pi-microchip",severity:"secondary",onClick:d[0]||(d[0]=I=>C.value=!0),class:"w-8 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg mt-16"}),k(ce,{visible:o(C),"onUpdate:visible":d[4]||(d[4]=I=>ae(C)?C.value=I:null),modal:!1,dismissable:!1,closeOnEscape:!1,class:"h-[calc(100vh-64px)] w-fit mt-16",pt:{root:{style:`right: ${W.value}`}}},{header:T(()=>d[12]||(d[12]=[g("div",null,null,-1)])),container:T(()=>[g("div",Ln,[g("div",Sn,[k(R,{icon:"pi pi-chevron-left",severity:"secondary",onClick:d[1]||(d[1]=I=>C.value=!1),class:"w-5 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none"})]),(a(),B(o(Ct),{id:o(A),key:o(A),slots:o(i),"onUpdate:slots":d[2]||(d[2]=I=>ae(i)?i.value=I:null),neededModules:o(f),"onUpdate:neededModules":d[3]||(d[3]=I=>ae(f)?f.value=I:null),class:"w-full",horizontal:!1,autoPut:!0},null,8,["id","slots","neededModules"]))])]),_:1},8,["visible","pt"])])):D("",!0),o(N)?(a(),p("div",$n,[k(R,{icon:"pi pi-code",severity:"secondary",onClick:d[5]||(d[5]=I=>x.value=!0),class:"w-8 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none mt-16"}),k(ce,{visible:o(x),"onUpdate:visible":d[8]||(d[8]=I=>ae(x)?x.value=I:null),header:"Drawer",modal:!1,dismissable:!1,closeOnEscape:!1,position:"right",class:"h-[calc(100vh-64px)] w-[452px] mt-16",pt:{root:{style:`left: ${W.value}`}}},{header:T(()=>d[13]||(d[13]=[g("div",null,null,-1)])),container:T(()=>[g("div",Bn,[g("div",En,[k(R,{icon:"pi pi-chevron-right",severity:"secondary",onClick:d[6]||(d[6]=I=>x.value=!1),class:"w-5 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg"})]),(a(),B(mt,null,[(a(),B(o(Lt),{id:o(A),key:o(A),connectbuttons:o(S),"onUpdate:connectbuttons":d[7]||(d[7]=I=>ae(S)?S.value=I:null),onRun:o(J),onSaveAnswer:ie},null,8,["id","connectbuttons","onRun"]))],1024))])]),_:1},8,["visible","pt"])])):D("",!0)])):D("",!0),k(pe,{"enter-active-class":"transition duration-500 ease-out","enter-from-class":"opacity-0 scale-90","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-300 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-90"},{default:T(()=>[o(b)=="completed"?(a(),p("div",In,[d[14]||(d[14]=g("div",{class:"text-5xl"},"⚡️",-1)),d[15]||(d[15]=g("div",{class:"flex flex-col items-center"},[g("div",{class:"text-4xl font-bold mb-8"},"Good work!"),g("div",{class:"text-md text-gray-500"},"TOTAL XP"),g("div",{class:"text-3xl font-bold"},"35")],-1)),g("div",null,[k(R,{label:"Continue",class:"rounded-full w-56 text-xl",onClick:G})])])):D("",!0)]),_:1})],64)}}});export{Mn as default};
