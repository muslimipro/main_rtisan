import{s as O}from"./index-loyErGxx.js";import{b as q,u as H,z as K,ad as L,r as i,f as Y,o as m,l as z,E as o,c as w,t as r,i as s,g as a,j as y,h as J,y as Q,v as W,b5 as X,w as Z,I as ee}from"./index-BsDe7Jd6.js";import{s as ae,a as te}from"./index-O5X_Q5Hg.js";import{s as se}from"./index-PIEH6vH8.js";import{s as le,a as oe}from"./index-DPWG10aP.js";import{b as re,a as ne}from"./index-BqzB1eIE.js";import{s as ie}from"./index-DM_vZNGK.js";import{s as ce}from"./index-Bpp3W0nX.js";import{T as b}from"./teacherApi-CxfJjbuj.js";import{u as de}from"./useTeacherStore-HOKox5rF.js";import"./index-B2sqmu40.js";import"./index-lDtp_9ZK.js";import"./index-CFCgDsO4.js";import"./index-DP0-NLAS.js";import"./index-zTnVSOL5.js";import"./index-CzWox581.js";import"./index-BEtiq_WR.js";import"./index-BVTLLx9J.js";import"./index-CbDHaRwr.js";import"./index--lncSA7P.js";const ue={key:1},pe={key:2,class:"flex flex-col items-start px-8 pb-4 gap-4"},fe={class:"flex items-center justify-between gap-2 w-full"},me={class:"flex flex-col gap-2"},ge={class:"text-3xl"},he={class:"text-sm"},ve={class:"flex items-center self-end"},_e={class:"text-xl"},ye={class:"text-gray-500"},be={class:"flex items-center"},$e={class:"flex-grow flex gap-2 items-center"},xe={class:"text-xl text-gray-500"},Ce={class:"flex flex-col"},ze={class:"text-[10px] text-gray-500"},we={class:"flex justify-center text-[124px]"},Je=q({__name:"ClassView",setup(Fe){const $=H(),F=K(),g=Q(),x=W(),{t:u}=L(),k=i(),d=i();(()=>{d.value={global:{value:null,matchMode:X.CONTAINS}}})();const S=de(),{loadClasses:T}=S,c=i(null),C=i([]),p=i(!1),f=i(!1),h=i(!1);async function I(){if(!p.value){p.value=!0;try{const{data:e}=await b.getClass(Number(g.params.id));c.value=e??null}catch(e){console.log(e)}finally{p.value=!1}}}async function N(){if(!f.value){f.value=!0;try{const{data:e}=await b.getClassStudents(Number(g.params.id));C.value=e??null}catch(e){console.log(e)}finally{f.value=!1}}}Y(()=>{I(),N()});function V(){F.require({message:u("pages.teacher.areYouSureDeleteClass"),header:u("pages.teacher.confirmation"),icon:"pi pi-exclamation-triangle",rejectProps:{label:u("pages.teacher.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:u("pages.teacher.delete"),severity:"danger"},accept:()=>{D(Number(g.params.id))}})}async function D(e){try{const{data:l}=await b.deleteClass(e);await T(),x.go(-1),$.add({severity:"success",summary:l.message,life:2e3})}catch(l){$.add({severity:"error",summary:l.response.data.error,detail:l,life:2e3})}}return(e,l)=>{const j=ce,v=Z,P=re,B=ie,M=ne,n=ae,_=le,A=oe,R=se,U=te,E=ee,G=O;return m(),z(G,{class:"flex-grow flex flex-col gap-2"},{default:o(()=>[p.value?(m(),z(j,{key:0,class:"flex justify-center"})):c.value?(m(),w("div",pe,[s("div",fe,[s("div",me,[s("div",ge,r(c.value.name),1),s("div",he,r(e.$t("pages.teacher.since"))+" "+r(c.value.created_time.split("T")[0]),1)]),a(v,{icon:"pi pi-hashtag",label:e.$t("pages.teacher.classCode"),severity:"info",onClick:l[0]||(l[0]=t=>h.value=!0)},null,8,["label"])]),s("div",ve,[s("div",_e,[s("span",ye,r(e.$t("pages.teacher.teacher")),1),y(" "+r(c.value.creator_name),1)])]),a(U,{ref_key:"dt",ref:k,filters:d.value,"onUpdate:filters":l[2]||(l[2]=t=>d.value=t),value:C.value,dataKey:"id",loading:f.value,scrollable:"",globalFilterFields:["name","email"],class:"overflow-hidden w-full",paginator:"",rows:25,rowsPerPageOptions:[5,10,25],groupHeader:!0,showGridlines:""},{header:o(()=>[s("div",be,[s("div",$e,[s("div",xe,r(e.$t("pages.teacher.students")),1)]),a(M,null,{default:o(()=>[a(P,null,{default:o(()=>l[4]||(l[4]=[s("i",{class:"pi pi-search"},null,-1)])),_:1}),a(B,{modelValue:d.value.global.value,"onUpdate:modelValue":l[1]||(l[1]=t=>d.value.global.value=t),placeholder:e.$t("pages.teacher.search")},null,8,["modelValue","placeholder"])]),_:1})])]),empty:o(()=>[y(r(e.$t("pages.teacher.noStudentsFound")),1)]),loading:o(()=>[y(r(e.$t("pages.teacher.loadingStudents")),1)]),default:o(()=>[a(A,{type:"header"},{default:o(()=>[a(_,null,{default:o(()=>[a(n,{header:e.$t("pages.teacher.projects"),rowspan:2,colspan:2,frozen:!0,alignFrozen:"left"},null,8,["header"]),a(n,{header:"",rowspan:2,colspan:2,frozen:!0,alignFrozen:"right"})]),_:1}),a(_),a(_,null,{default:o(()=>[a(n,{header:e.$t("pages.teacher.avatar"),frozen:!0,alignFrozen:"left"},null,8,["header"]),a(n,{header:e.$t("pages.teacher.name"),frozen:!0,alignFrozen:"left",sortable:"",field:"name"},null,8,["header"]),a(n,{header:e.$t("pages.teacher.xp"),frozen:!0,alignFrozen:"right",sortable:"",field:"xp"},null,8,["header"]),a(n,{header:"",frozen:!0,alignFrozen:"right"})]),_:1})]),_:1}),a(n,{field:"small_avatar_url",header:e.$t("pages.teacher.avatar"),sortable:"",frozen:!0,alignFrozen:"left"},{body:o(({data:t})=>[a(R,{image:t.small_avatar_url},null,8,["image"])]),_:1},8,["header"]),a(n,{field:"name",header:e.$t("pages.teacher.name"),sortable:"",frozen:!0,alignFrozen:"left"},{body:o(({data:t})=>[s("div",Ce,[s("div",null,r(`${t.name.length>0?t.name:t.email}`),1),s("div",ze,r(`Last visited: ${t.last_activity_time.split("T")[0]}`),1)])]),_:1},8,["header"]),a(n,{field:"xp",header:e.$t("pages.teacher.xp"),sortable:"",frozen:!0,alignFrozen:"right"},{body:o(({data:t})=>[s("div",null,r(`${t.xp}xp`),1)]),_:1},8,["header"]),a(n,{exportable:!1,frozen:!0,alignFrozen:"right"},{body:o(({data:t})=>[a(v,{icon:"pi pi-angle-right",outlined:"",rounded:"",severity:"info",onClick:Se=>J(x).push({name:"teacher-student",params:{id:t.id}})},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value","loading"]),a(v,{icon:"pi pi-trash",label:e.$t("pages.teacher.removeClass"),severity:"danger",onClick:V,class:"self-end"},null,8,["label"])])):(m(),w("div",ue,r(e.$t("pages.teacher.noData")),1)),a(E,{visible:h.value,"onUpdate:visible":l[3]||(l[3]=t=>h.value=t),modal:"",header:e.$t("pages.teacher.classCode")},{default:o(()=>{var t;return[s("div",we,r((t=c.value)==null?void 0:t.code),1)]}),_:1},8,["visible","header"])]),_:1})}}});export{Je as default};
