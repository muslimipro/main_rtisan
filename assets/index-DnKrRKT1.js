import{_ as me,a as ye,b as ge,c as we,s as be}from"./VideoViewer.vue_vue_type_script_setup_true_lang-CBsrNeKl.js";import{s as oe}from"./index-Bpp3W0nX.js";import{d as _e,u as he,r as o,x as ne,e as Z,a as k,b as te,o as a,c as f,l as m,h as n,p as H,y as ae,F as xe,k as Se,z as ke,A as se,f as Le,C as Ce,i as d,g as S,t as De,D as Ee,E as K,G as T,K as $e,v as Pe,w as Ie}from"./index-BsDe7Jd6.js";import{d as Ue}from"./defaultConfirmDeleteOptions-BHu3VNzp.js";import{u as Ae,a as Be,b as le}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-B6mLFFGc.js";import{S as Ve}from"./SimulationView-BtlEheH1.js";import{_ as je}from"./CodeViewer.vue_vue_type_script_setup_true_lang-Dwzu0wMf.js";import{u as ie,L as qe}from"./lessonApi-CpnJMPHi.js";import{m as Me}from"./mapLessonFromDto-BRb_Xlqa.js";import{U as ee}from"./unitApi-Ci_RN56J.js";import{m as Ne}from"./mapUnitFromDto-BRBO9875.js";import"./index-DM_vZNGK.js";import"./index-CzWox581.js";import"./index-CbDHaRwr.js";import"./index-B2sqmu40.js";import"./index--lncSA7P.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-zTnVSOL5.js";import"./index-BKvusrGu.js";import"./language-DYQF8nnT.js";const re=_e("project-store",()=>{const V=he(),t=o(null),c=o(!1),b=o(!1),j=o(!1),P=o(!1),y=o(!1),_=o(0),q=o(0),l=o([]),g=o([]),w=o(0),I=o(new Map),L=o([]),C=o(!1),D=o(!1),E=o(!1),W=o(!0),v=o(""),M=o(null),F=o(null),N=o([]),U=o([]),J=ne(),Q=ie(),{lang:A}=Z(Q),h=o(void 0),z=k(()=>{var e;return E.value&&(((e=M.value)==null?void 0:e.modulesWerePut)??!0)&&W.value});async function O(e,u){try{c.value=!0,h.value=J.userRole==="editor"?A.value:void 0;const{data:i}=await qe.getLessonById(e,u,h.value);t.value=Me(i),await p()}catch(i){V.add({severity:"error",summary:i.response.data.error,life:2e3})}finally{c.value=!1}}async function p(){if(t.value)try{y.value=!0,_.value=0,I.value.clear(),l.value=[];const e=[];t.value.pages.forEach(i=>{i.groups.forEach(R=>{R.units.forEach(Y=>{e.push(Y.id)})})});const{data:u}=await ee.getUnitsByIdsandLessonId(e,t.value.id,h.value);for(const i of u)l.value.push(Ne(i)),["code","pibody"].includes(i.unit_type)&&$(i.unit_type,l.value[l.value.length-1])}catch(e){console.error("Error preloading units:",e)}finally{y.value=!1}}function s(e,u){if(t.value!=null){for(const[i,R]of g.value.entries())for(const[Y,fe]of R.units.entries())if(fe.id==e){g.value[i].units[Y].studentState.answer=u;break}}}function $(e,u){let i="";if(v.value==""||u.content.starting!=""){i=`emulator-${u.id}`;const R=u.studentState.answer.code;F.value=Ae(i),F.value.setCode(R)}v.value=i??v.value,e=="pibody"&&(M.value=Be(v.value),N.value=u.data.neededModules,M.value.addNeededModules(N.value),i!=""&&(U.value=u.studentState.answer.slots))}function X(){I.value.clear(),_.value=0,y.value=!1}function G(e){E.value=e}function r(){W.value=!0}async function ue(e){if(v.value=="")return;const u=Number(v.value.split("-")[1]);s(u,e),await ee.saveUnitByIdandLessonId(u,t.value.id,{answer:e})}const x=k(()=>t.value?t.value.pages[q.value]??null:null),B=k(()=>x.value?x.value.groups[w.value]??null:null),de=k({get:()=>{var e;return((e=B.value)==null?void 0:e.pibodyDrawerVisible)??!1},set:e=>{B.value&&(B.value.pibodyDrawerVisible=e)}}),ce=k({get:()=>{var e;return((e=B.value)==null?void 0:e.codeDrawerVisible)??!1},set:e=>{B.value&&(B.value.codeDrawerVisible=e)}}),ve=k({get:()=>{var e;return((e=x.value)==null?void 0:e.showPibody)??!1},set:e=>{x.value&&(x.value.showPibody=e)}}),pe=k({get:()=>{var e;return((e=x.value)==null?void 0:e.showCode)??!1},set:e=>{x.value&&(x.value.showCode=e)}});return{selectedLesson:t,isLessonLoading:c,isUnitLoading:b,units:l,groups:g,groupIndex:w,isGroupLoading:j,isSubmitLoading:P,isLoadingUnits:y,preloadingProgress:_,submitExist:C,correct:D,submitEnabled:z,pageProgress:L,emulatorID:v,neededModules:N,slots:U,pibodyDrawerVisible:de,codeDrawerVisible:ce,showPibody:ve,showCode:pe,setSubmitable:G,loadLessonById:O,loadAllUnits:p,clearUnitsCache:X,saveAnswer:s,runCodePressed:r,saveStudentIdeState:ue}}),ze={key:1,class:"flex-grow px-4 py-2"},Re=te({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},setup(V){const t=V,c=ae(),b=re(),{saveAnswer:j,setSubmitable:P}=b;function y(l){t.unit.unitType=="options"?P(l.options.length>0):t.unit.unitType=="open"&&P(l.open.length>0),j(t.unit.id,l),_(l)}const _=le(l=>{q(l)},1e3,{maxWait:5e3});async function q(l){await ee.saveUnitByIdandLessonId(t.unit.id,Number(c.params.id),{answer:l})}return(l,g)=>{const w=oe;return a(),f("div",null,[l.loading?(a(),m(w,{key:0,class:"flex justify-center items-center w-10 h-full"})):(a(),f("div",ze,[t.unit.unitType=="article"?(a(),m(n(me),{key:0,article:t.unit.content},null,8,["article"])):t.unit.unitType=="options"?(a(),m(n(ye),{key:1,"options-data":t.unit.content,state:t.unit.studentState,onSaveAnswer:y},null,8,["options-data","state"])):t.unit.unitType=="open"?(a(),m(n(ge),{key:2,state:t.unit.studentState,onSaveAnswer:y},null,8,["state"])):t.unit.unitType=="video"?(a(),m(n(we),{key:3,video:t.unit.content},null,8,["video"])):H("",!0)]))])}}}),Te={ref:"rootEl",class:"flex flex-col gap-8"},We=te({__name:"UnitsView",props:{units:{}},setup(V){return(t,c)=>(a(),f("div",Te,[(a(!0),f(xe,null,Se(t.units,b=>(a(),m(Re,{key:b.id,unit:b},null,8,["unit"]))),128))],512))}}),Fe={class:"h-screen bg-white flex flex-col items-center overflow-hidden relative"},Oe={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 max-w-[1920px] mx-auto"},Ge={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},Ke={class:"flex items-center gap-4"},He={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4 justify-center"},Je={class:"text-2xl"},Qe={class:"flex-1 overflow-y-auto mt-16 mb-0 w-full"},Xe={key:1,class:"flex justify-center"},Ye={key:2},Ze={key:0,class:"absolute left-0 top-1/2 -translate-y-1/2"},et={class:"relative h-full"},tt={class:"absolute -right-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},st={key:1,class:"absolute right-0 top-1/2 -translate-y-1/2"},ot={class:"relative h-full"},nt={class:"absolute -left-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},Lt=te({__name:"ProjectPage",setup(V){const t=ae(),c=Pe(),b=ke(),j=ne(),P=ie(),{lang:y}=Z(P);se(y,async(p,s)=>{p!==s&&g.value&&await v(Number(t.params.id),(t.query.route_id??"").toString())});const _=re(),{units:q,isLessonLoading:l,selectedLesson:g,emulatorID:w,neededModules:I,slots:L,pibodyDrawerVisible:C,codeDrawerVisible:D,showPibody:E,showCode:W}=Z(_),{loadLessonById:v,saveStudentIdeState:M}=_;function F(){b.require({...Ue,header:"Close lesson",message:"Are you sure you want to exit lesson. All progress will be lost!",acceptProps:{label:"Close",severity:"danger"},accept:()=>N()})}function N(){j.userRole=="editor"?t.query.route_id&&t.query.route_id!=""?c.push(`/v2/route/${t.query.route_id}/edit`):c.push("/v2/routes"):t.query.route_id&&t.query.route_id!=""?c.push("/v2/route/"+t.query.route_id):c.push("/v2/home")}const U=o("");se([U,L],()=>{J({code:U.value,slots:L.value})});const J=le(p=>{M(p)},1e3,{maxWait:5e3});function Q(p){U.value=p.code}const A=o(window.innerWidth),h=o(16);function z(){if(A.value=window.innerWidth,A.value<=1300){h.value=16;return}const s=452-(A.value-1024)/2;h.value=s>16?s:16}Le(()=>{z(),v(Number(t.params.id),(t.query.route_id??"").toString()),window.addEventListener("resize",z)}),Ce(()=>{window.removeEventListener("resize",z)});const O=k(()=>A.value<=1920?{}:"calc((-100vw + 1920px) / 2)");return(p,s)=>{const $=Ie,X=oe,G=be;return a(),f("div",Fe,[d("div",Oe,[d("div",Ge,[d("div",Ke,[S($,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:F})]),n(g)?(a(),f("div",He,[d("div",Je,De(n(g).name),1)])):H("",!0),s[9]||(s[9]=d("div",{class:"w-10"},null,-1))])]),d("div",Qe,[d("div",{class:"w-full h-full max-w-screen-lg mx-auto py-8",style:Ee({paddingLeft:h.value+"px",paddingRight:h.value+"px"})},[n(l)?(a(),m(X,{key:0,class:"flex justify-center"})):n(g)?(a(),f("div",Ye,[S(We,{units:n(q)},null,8,["units"])])):(a(),f("div",Xe,"No lesson found"))],4)]),n(E)?(a(),f("div",Ze,[S($,{icon:"pi pi-microchip",severity:"secondary",onClick:s[0]||(s[0]=r=>C.value=!0),class:"w-8 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg mt-16"}),S(G,{visible:n(C),"onUpdate:visible":s[4]||(s[4]=r=>T(C)?C.value=r:null),modal:!1,dismissable:!1,closeOnEscape:!1,class:"h-[calc(100vh-64px)] w-fit mt-16",pt:{root:{style:`right: ${O.value}`}}},{header:K(()=>s[10]||(s[10]=[d("div",null,null,-1)])),container:K(()=>[d("div",et,[d("div",tt,[S($,{icon:"pi pi-chevron-left",severity:"secondary",onClick:s[1]||(s[1]=r=>C.value=!1),class:"w-5 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none"})]),(a(),m(n(Ve),{id:n(w),key:n(w),slots:n(L),"onUpdate:slots":s[2]||(s[2]=r=>T(L)?L.value=r:null),neededModules:n(I),"onUpdate:neededModules":s[3]||(s[3]=r=>T(I)?I.value=r:null),class:"w-full",horizontal:!1,autoPut:!0},null,8,["id","slots","neededModules"]))])]),_:1},8,["visible","pt"])])):H("",!0),n(W)?(a(),f("div",st,[S($,{icon:"pi pi-code",severity:"secondary",onClick:s[5]||(s[5]=r=>D.value=!0),class:"w-8 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none mt-16"}),S(G,{visible:n(D),"onUpdate:visible":s[8]||(s[8]=r=>T(D)?D.value=r:null),header:"Drawer",modal:!1,dismissable:!1,closeOnEscape:!1,position:"right",class:"h-[calc(100vh-64px)] w-[452px] mt-16",pt:{root:{style:`left: ${O.value}`}}},{header:K(()=>s[11]||(s[11]=[d("div",null,null,-1)])),container:K(()=>[d("div",ot,[d("div",nt,[S($,{icon:"pi pi-chevron-right",severity:"secondary",onClick:s[6]||(s[6]=r=>D.value=!1),class:"w-5 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg"})]),(a(),m($e,null,[(a(),m(n(je),{id:n(w),key:n(w),connectbuttons:n(E),"onUpdate:connectbuttons":s[7]||(s[7]=r=>T(E)?E.value=r:null),onSaveAnswer:Q},null,8,["id","connectbuttons"]))],1024))])]),_:1},8,["visible","pt"])])):H("",!0)])}}});export{Lt as default};
