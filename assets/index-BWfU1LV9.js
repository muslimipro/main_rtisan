import{d as K,_ as ue,a as de,b as ce,c as pe,s as ve}from"./VideoViewer.vue_vue_type_script_setup_true_lang-Bqsbs2oA.js";import{s as Y}from"./index-D2ra_EFA.js";import{s as fe}from"./index-BeehcYXA.js";import{e as D,o as n,c as u,j as l,h as v,b as S,F as G,l as H,p as i,D as U,k as me,t as M,d as _e,u as ye,r as s,x as we,f as J,i as a,q as V,g as ge,A as xe,C as he,E as be,K as $e,y as ke,v as Le,w as Se}from"./index-CRcQ_LZd.js";import{u as Ce,a as Ee}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-BavQ792j.js";import{S as Ie}from"./SimulationView-D0wr38ER.js";import{_ as Pe}from"./CodeViewer.vue_vue_type_script_setup_true_lang-DUG7eYC0.js";import{L as Ue}from"./lessonApi-D6LLn7IJ.js";import{m as De}from"./mapLessonFromDto-BRb_Xlqa.js";import{U as O}from"./unitApi-LHd8Wnfh.js";import{m as Be}from"./mapUnitFromDto-BRBO9875.js";import{u as Re}from"./useLocaleStore-O7kaEZhf.js";import{s as Te}from"./index-M6XOUipp.js";import"./index-5sqcVIC2.js";import"./index-F1GMW6t5.js";import"./index-Cb3Rqpbh.js";import"./index-ukQs_Lon.js";import"./index-X1kAbo_w.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-c_9yoikE.js";import"./index-BjBwoSS1.js";import"./language-DYQF8nnT.js";const Ve={class:"rounded-2xl p-6 max-w-2xl mx-auto border border-slate-100 gap-2 flex flex-col"},Ne={class:"rounded-xl overflow-clip"},ze=D({__name:"CodeReviseViewer",props:{state:{}},setup(m){const e=m;return(d,r)=>(n(),u("div",Ve,[r[0]||(r[0]=l("div",{class:"text-overline-small text-neutral600"},"Your answer",-1)),l("div",Ne,[v(K,{text:` \`\`\`python
${e.state.answer.code}
\`\`\` `},null,8,["text"])])]))}}),Ae={class:"rounded-2xl p-6 max-w-2xl mx-auto border border-slate-100 gap-2 flex flex-col"},We={class:"space-y-1"},je={class:"flex flex-wrap items-center gap-2 text-slate-800 bg-slate-50 rounded-xl px-3 py-2"},qe={class:"text-slate-800"},Fe={class:"rounded-xl overflow-clip"},Me=D({__name:"PibodyReviseViewer",props:{state:{}},setup(m){const e=m,d=["A","B","C","D","E","F","8","9"],r=S(()=>e.state.answer.slots.map((f,g)=>({slot:f,index:g})).filter(f=>f.slot!==""));return(f,g)=>{const _=Te;return n(),u("div",Ae,[g[0]||(g[0]=l("div",{class:"text-overline-small text-neutral600"},"Your answer",-1)),l("div",We,[l("div",je,[(n(!0),u(G,null,H(r.value,c=>(n(),i(_,{key:c.index,class:"font-medium text-slate-500"},{default:U(()=>[me(" Slot "+M(d[c.index])+": ",1),l("span",qe,M(c.slot),1)]),_:2},1024))),128))])]),l("div",Fe,[v(K,{text:` \`\`\`python
${e.state.answer.code}
\`\`\` `},null,8,["text"])])])}}}),Oe=_e("lesson-revise-store",()=>{const m=ye(),e=s(null),d=s(!1),r=s(!1),f=s(!1),g=s(!1),_=s(!1),c=s(0),N=s(0),C=s([]),E=s([]),b=s(0),h=s(new Map),$=s([]),k=s(!1),I=s(!1),P=s(!1),B=s(!0),t=s(""),y=s(null),R=s(null),z=s([]),T=s([]),p=we(),Q=Re(),{lang:X}=J(Q),A=s(void 0),Z=S(()=>{var o;return P.value&&(((o=y.value)==null?void 0:o.modulesWerePut)??!0)&&B.value});async function ee(o,x){try{d.value=!0,A.value=p.userRole==="editor"?X.value:void 0;const{data:w}=await Ue.getLessonById(o,x,A.value);e.value=De(w),await q()}catch(w){m.add({severity:"error",summary:w.response.data.error,life:2e3})}finally{d.value=!1}}async function q(){if(e.value)try{_.value=!0,c.value=0,h.value.clear(),C.value=[];const o=[];e.value.pages.forEach(w=>{w.groups.forEach(W=>{W.units.forEach(j=>{o.push(j.id)})})});const{data:x}=await O.getUnitsByIdsandLessonId(o,e.value.id,A.value);for(const w of x)C.value.push(Be(w));te()}catch(o){console.error("Error preloading units:",o)}finally{_.value=!1}}function F(o,x){if(e.value!=null){for(const[w,W]of E.value.entries())for(const[j,ie]of W.units.entries())if(ie.id==o){E.value[w].units[j].studentState.answer=x;break}}}function te(){t.value="emulatorID",R.value=Ce(t.value),R.value.setCode(""),y.value=Ee(t.value),y.value.addNeededModules([])}function se(){h.value.clear(),c.value=0,_.value=!1}function oe(o){P.value=o}function ne(){B.value=!0}async function le(o){if(t.value=="")return;const x=Number(t.value.split("-")[1]);F(x,o),await O.saveUnitByIdandLessonId(x,e.value.id,{answer:o})}const L=S(()=>e.value?e.value.pages[N.value]??null:null),ae=S({get:()=>{var o;return((o=L.value)==null?void 0:o.showPibody)??!1},set:o=>{L.value&&(L.value.showPibody=o)}}),re=S({get:()=>{var o;return((o=L.value)==null?void 0:o.showCode)??!1},set:o=>{L.value&&(L.value.showCode=o)}});return{selectedLesson:e,isLessonLoading:d,isUnitLoading:r,units:C,groups:E,groupIndex:b,isGroupLoading:f,isSubmitLoading:g,isLoadingUnits:_,preloadingProgress:c,submitExist:k,correct:I,submitEnabled:Z,pageProgress:$,emulatorID:t,neededModules:z,slots:T,showPibody:ae,showCode:re,setSubmitable:oe,loadLessonById:ee,loadAllUnits:q,clearUnitsCache:se,saveAnswer:F,runCodePressed:ne,saveStudentIdeState:le}}),Ke={key:1,class:"flex-grow px-4 py-2"},Ye=D({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},setup(m){const e=m;return(d,r)=>{const f=Y;return n(),u("div",null,[d.loading?(n(),i(f,{key:0,class:"flex justify-center items-center w-10 h-full"})):(n(),u("div",Ke,[e.unit.unitType=="article"?(n(),i(a(ue),{key:0,article:e.unit.content},null,8,["article"])):e.unit.unitType=="options"?(n(),i(a(de),{key:1,"options-data":e.unit.content,state:e.unit.studentState},null,8,["options-data","state"])):e.unit.unitType=="open"?(n(),i(a(ce),{key:2,state:e.unit.studentState},null,8,["state"])):e.unit.unitType=="video"?(n(),i(a(pe),{key:3,video:e.unit.content},null,8,["video"])):e.unit.unitType=="code"?(n(),i(a(ze),{key:4,state:e.unit.studentState},null,8,["state"])):e.unit.unitType=="pibody"?(n(),i(a(Me),{key:5,state:e.unit.studentState},null,8,["state"])):V("",!0)]))])}}}),Ge={ref:"rootEl",class:"flex flex-col gap-8"},He=D({__name:"UnitsView",props:{units:{}},setup(m){return(e,d)=>(n(),u("div",Ge,[(n(!0),u(G,null,H(e.units,r=>(n(),i(Ye,{key:r.id,unit:r},null,8,["unit"]))),128))],512))}}),Je={class:"h-screen flex flex-col items-center overflow-hidden relative bg-white"},Qe={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 max-w-[1920px] mx-auto"},Xe={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},Ze={class:"flex items-center gap-4"},et={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4"},tt={class:"flex-1 overflow-y-auto mt-16 mb-0 w-full"},st={key:1,class:"flex justify-center"},ot={key:2},nt={key:0,class:"absolute left-0 top-1/2 -translate-y-1/2"},lt={class:"relative h-full"},at={class:"absolute -right-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},rt={key:1,class:"absolute right-0 top-1/2 -translate-y-1/2"},it={class:"relative h-full"},ut={class:"absolute -left-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},Dt=D({__name:"LessonRevisePage",setup(m){const e=ke(),d=Le(),r=Oe(),{units:f,isLessonLoading:g,selectedLesson:_,showPibody:c,showCode:N}=J(r),{loadLessonById:C}=r;function E(){e.query.route_id&&e.query.route_id!=""?d.push("/v2/route/"+e.query.route_id):d.push("/v2/home")}const b=s(window.innerWidth),h=s(16),$=s(!0),k=s(!0);function I(){if(b.value=window.innerWidth,b.value<=1300){h.value=16;return}const t=452-(b.value-1024)/2;h.value=t>16?t:16}ge(()=>{I(),C(Number(e.params.id),(e.query.route_id??"").toString()),window.addEventListener("resize",I)}),xe(()=>{window.removeEventListener("resize",I)});const P=S(()=>b.value<=1920?{}:"calc((-100vw + 1920px) / 2)");return(B,t)=>{const y=Se,R=fe,z=Y,T=ve;return n(),u("div",Je,[l("div",Qe,[l("div",Xe,[l("div",Ze,[v(y,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:E})]),a(_)?(n(),u("div",et,[v(R,{value:100,"show-value":!1,class:"w-full rounded-full h-3"})])):V("",!0),t[7]||(t[7]=l("div",{class:"w-10"},null,-1))])]),l("div",tt,[l("div",{class:"w-full h-full max-w-screen-lg mx-auto py-8",style:he({paddingLeft:h.value+"px",paddingRight:h.value+"px"})},[a(g)?(n(),i(z,{key:0,class:"flex justify-center"})):a(_)?(n(),u("div",ot,[v(He,{units:a(f)},null,8,["units"])])):(n(),u("div",st,"No lesson found"))],4)]),a(c)?(n(),u("div",nt,[v(y,{icon:"pi pi-microchip",severity:"secondary",onClick:t[0]||(t[0]=p=>$.value=!0),class:"w-8 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg mt-16"}),v(T,{visible:$.value,"onUpdate:visible":t[2]||(t[2]=p=>$.value=p),modal:!1,dismissable:!1,closeOnEscape:!1,class:"h-[calc(100vh-64px)] w-fit mt-16",pt:{root:{style:`right: ${P.value}`}}},{header:U(()=>t[8]||(t[8]=[l("div",null,null,-1)])),container:U(()=>[l("div",lt,[l("div",at,[v(y,{icon:"pi pi-chevron-left",severity:"secondary",onClick:t[1]||(t[1]=p=>$.value=!1),class:"w-5 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none"})]),(n(),i(a(Ie),{id:"emulatorID",key:"emulatorID",class:"w-full",horizontal:!1,autoPut:!0}))])]),_:1},8,["visible","pt"])])):V("",!0),a(N)?(n(),u("div",rt,[v(y,{icon:"pi pi-code",severity:"secondary",onClick:t[3]||(t[3]=p=>k.value=!0),class:"w-8 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none mt-16"}),v(T,{visible:k.value,"onUpdate:visible":t[6]||(t[6]=p=>k.value=p),header:"Drawer",modal:!1,dismissable:!1,closeOnEscape:!1,position:"right",class:"h-[calc(100vh-64px)] w-[452px] mt-16",pt:{root:{style:`left: ${P.value}`}}},{header:U(()=>t[9]||(t[9]=[l("div",null,null,-1)])),container:U(()=>[l("div",it,[l("div",ut,[v(y,{icon:"pi pi-chevron-right",severity:"secondary",onClick:t[4]||(t[4]=p=>k.value=!1),class:"w-5 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg"})]),(n(),i($e,null,[(n(),i(a(Pe),{id:"emulatorID",key:"emulatorID",connectbuttons:a(c),"onUpdate:connectbuttons":t[5]||(t[5]=p=>be(c)?c.value=p:null)},null,8,["connectbuttons"]))],1024))])]),_:1},8,["visible","pt"])])):V("",!0)])}}});export{Dt as default};
