import{s as ae,o as re,D as Z,m as ue,M as de,E as pe,F as ce,G as fe,a as q,H as ve,J as he,K as xe,L as ye,N as we,T as me}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-C_HPaqu4.js";import{e as D,r as I,C as E,g as G,_ as ge,o as p,c as y,j as r,E as g,i as e,t as B,F as S,l as T,n as F,aE as le,h as A,q as j,p as P,aF as ie,b as H,Y,$ as be,a2 as _e,a3 as ee,a0 as z,w as te,aG as O,m as W,N as se,x as ke}from"./index-BYxlyoh-.js";import{s as $e}from"./index-rJ23prLF.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Me="/assets/pibody-CmiHEiCK.png",Pe=["width","height"],C=12,Se=D({__name:"DisplayView",props:{id:{default:"default"}},setup(b){const t=b,s=I(112),x=I(160),$=I(null),h=I(null),i=I(0),u=ae(t.id);u.text.value||(u.text.value="");function a(o){const f=o.deltaY>0?1:-1;i.value+=f*C,i.value=Math.max(0,i.value);const{lines:w,visibleLines:v}=n();i.value=Math.min(w.length*C,i.value),c(w,v)}function n(){const o=[];let f=0;return h.value&&u.text.value&&(String(u.text.value).split(`
`).forEach(v=>{let m="";v.split(" ").forEach(_=>{const l=m+_+" ";h.value.measureText(l).width>s.value?(o.push(m),m=_+" "):m=l}),o.push(m)}),f=Math.ceil(x.value/C)),{lines:o,visibleLines:f}}function c(o,f){if(h.value){h.value.fillStyle="#FFFFFF",h.value.fillRect(0,0,s.value,x.value),h.value.fillStyle=String(u.textColor.value)||"#000000",h.value.font="12px Monaco";const w=Math.floor(i.value/C);for(let v=0;v<f;v++){const m=w+v;if(m<o.length){const k=(v+1)*C-i.value%C;h.value.fillText(o[m],0,k)}}}}return E([u.text,u.textColor],()=>{const{lines:o,visibleLines:f}=n();i.value=Math.max(0,(o.length-f)*C),c(o,f)}),G(async()=>{if(await ge(),!!$.value&&(h.value=$.value.getContext("2d"),h.value)){h.value.fillStyle="#FFFFFF",h.value.fillRect(0,0,s.value,x.value);const{lines:o,visibleLines:f}=n();i.value=0,c(o,f)}}),(o,f)=>(p(),y("div",{class:"display-container",onWheel:a},[r("canvas",{ref_key:"canvas",ref:$,width:s.value,height:x.value,style:{border:"1px solid black",width:"112px",height:"160px"}},null,8,Pe)],32))}}),Le=K(Se,[["__scopeId","data-v-0149e8f3"]]),oe=D({__name:"PinInfo",props:{pin:{},withPin:{},isLeft:{type:Boolean}},setup(b){return(t,s)=>(p(),y(S,null,[r("div",{class:F(["flex",t.isLeft?"flex-row":"flex-row-reverse"])},[r("div",{style:g({background:e(re)}),class:"text-center font-mono px-1 mr-1"},B(e(Z)[t.pin.id].name),5),(p(!0),y(S,null,T(e(Z)[t.pin.id].able,x=>(p(),y("div",{style:g({background:x.color}),class:"text-center font-mono px-1 mr-1"},B(x.name),5))),256))],2),r("div",{class:F(["flex my-1 mb-3",t.isLeft?"flex-row":"flex-row-reverse"])},[r("div",{style:g({background:`${e(ue)[t.pin.mode]}`}),class:"text-center px-4 mr-1 rounded-lg"},B(e(de)[t.pin.mode]),5),r("div",{style:g(e(pe)(t.pin,t.withPin)),class:"text-center px-4 mr-1 rounded-lg bg-black"},B(e(ce)(t.pin,t.withPin)),5)],2)],64))}}),Ce=["id"],Fe=D({__name:"SlotView",props:{slot:{},index:{},id:{}},setup(b){const{isOutside:t}=fe(le("theref")),s=q(b.id),{maxAreaIndex:x,fromSlotIndex:$,settings:h}=s,i=b.index<3;return(u,a)=>{var n;return p(),y(S,null,[r("div",{id:`slot-${u.slot.id}`,ref:"theref",class:F(["absolute w-20 h-20 rounded-lg text-center",[{"bg-green-200/[0.5]":e(x)==u.index,"bg-blue-200/[0.5]":e($)==u.index},u.slot.class]]),style:g([u.slot.style,e(ve)(u.slot)])},[!e(t)&&((n=e(h))!=null&&n.showPinInfo)?(p(),y("div",{key:0,class:"absolute w-fit whitespace-nowrap text-white flex flex-col text-xs bg-black/70",style:g(i?"left:100%":"right:100%")},[A(oe,{pin:u.slot.pin2,withPin:u.slot.with.pin2,isLeft:i},null,8,["pin","withPin"]),A(oe,{pin:u.slot.pin3,withPin:u.slot.with.pin3,isLeft:i},null,8,["pin","withPin"])],4)):j("",!0)],14,Ce),e(t)?j("",!0):(p(),P(ie,{key:0,to:`#pibody-${u.id}`},null,8,["to"]))],64)}}}),Ee=["width","height"],De=["points","stroke"],R=3,ne=14,V=10,Ie=D({__name:"Connector",props:{start:{},end:{},style:{},id:{}},setup(b){const t=b,s=q(t.id),x=H(()=>{const{start:a,end:n}=t,c=40,o=[{x:a.x,y:a.y}];return o.push({x:a.x,y:a.y-c}),o.push({x:(n.x+a.x)/2,y:a.y-c}),o.push({x:(n.x+a.x)/2,y:n.y-n.yOffset}),o.push({x:n.x,y:n.y-n.yOffset}),o.push({x:n.x,y:n.y}),o}),$=[{color:"orange",offset:-R,end:-ne/2},{color:"red",offset:0,end:0},{color:"saddlebrown",offset:R,end:ne/2}],h=H(()=>{const a=x.value,n=[];return $.forEach(c=>{const o=c.offset,f=c.end;let w="";for(let k=0;k<a.length-2;k++){const _=a[k];w+=`${_.x-i.value.x-o},${_.y-i.value.y-o} `}const v=a[a.length-2];w+=`${v.x-i.value.x+o},${v.y-i.value.y-o} `;const m=a[a.length-1];w+=`${m.x-i.value.x+f},${m.y-i.value.y+3} `,n.push({color:c.color,points:w})}),n}),i=H(()=>{const a=[],n=[];for(const v of x.value)a.push(v.x),n.push(v.y);const c=Math.min(...a)-V,o=Math.min(...n)-V,f=Math.max(...a)+V,w=Math.max(...n)+V;return{x:c,y:o,w:f-c,h:w-o}}),u=a=>{t.end.at!==s.pinNone&&s.moveConnectorEnd(t,a)};return(a,n)=>(p(),y(S,null,[r("div",{class:"absolute bg-black cursor-move",style:g([t.style,{left:t.end.x-12+"px",top:t.end.y+"px",width:t.end.w+"px",height:t.end.h+"px"}]),onPointerdown:[n[0]||(n[0]=Y(c=>c.preventDefault(),["prevent"])),u]},null,36),r("div",{class:"absolute pointer-events-none",style:g([t.style,e(he)(i.value)])},[(p(),y("svg",{xmlns:"http://www.w3.org/2000/svg",width:i.value.w,height:i.value.h},[(p(!0),y(S,null,T(h.value,(c,o)=>(p(),y("polyline",{key:o,points:c.points,stroke:c.color,fill:"none","stroke-width":R,"stroke-linejoin":"round","stroke-linecap":"round"},null,8,De))),128))],8,Ee))],4)],64))}}),ze=K(Ie,[["__scopeId","data-v-9a0ab2fc"]]),Te=D({__name:"Canvas",setup(b){const t=le("canvasEl");return G(async()=>{t.value&&(await xe(t.value),requestAnimationFrame(ye))}),be(()=>{t.value&&we(t.value)}),(s,x)=>(p(),y("canvas",{ref_key:"canvasEl",ref:t},null,512))}}),Ae=["id"],Be=["id"],Ve={class:"absolute top-[22px] right-[7px] flex flex-col gap-1"},Ne=["id"],He={class:"max-h-fit w-full overflow-auto flex flex-wrap gap-2 justify-center items-start mt-2",style:{"touch-action":"none",padding:"15px 0 15px 0"}},Oe=D({__name:"SimulationView",props:_e({id:{},horizontal:{type:Boolean}},{neededModules:{default:[]},neededModulesModifiers:{},slots:{default:[]},slotsModifiers:{}}),emits:["update:neededModules","update:slots"],setup(b){const t=b,s=q(t.id,t.horizontal),{toDelete:x,slots:$,modules:h,isConnect8or9:i,chosenPin8or9:u,pin8:a,pin9:n,settings:c,clearSlotsModulesClasses:o,modulesWerePut:f,lightUp:w}=s,v=ee(b,"neededModules"),m=ee(b,"slots");G(()=>{s.putModuleList(m.value)});function k(_){if(f.value=!0,!(!v.value||v.value.length===0)){o();for(const l of v.value){if(!l.slot||!l.module)continue;if(s.getSlotPinWith(l.slot).type!==l.module){w(l.slot,l.module),f.value=!1;break}}}}E([s.slotHasList],()=>{m.value=s.slotHasList()});for(const _ of s.slots)E(()=>_.with.type,()=>{k()},{immediate:!0});return E(()=>s.pin8.with.type,()=>{k(s.pin8)},{immediate:!0}),E(()=>s.pin9.with.type,()=>{k(s.pin9)},{immediate:!0}),E(v,()=>{for(const _ of s.slots)k()}),(_,l)=>{var J,Q;const N=$e,U=ke,X=me;return p(),y("div",{id:`emulator-${t.id}`,key:`emulator-${t.id}`,class:F({"h-[450px] flex flex-row":_.horizontal,"h-full flex flex-col":!_.horizontal,"parent relative items-stretch overflow-hidden select-none border-l":!0})},[r("div",{id:`pibody-${t.id}`,class:"relative h-[450px] flex-shrink-0 overflow-x-hidden overflow-y-auto w-[450px]"},[A(N,{src:e(Me),width:"384px",draggable:"false",class:"absolute pt-4 min-w-[384px]",style:{left:"32px",top:"0px"}},null,8,["src"]),A(Le,{class:"absolute top-[217px] left-[168px] w-[112px] h-[160px]",id:`${t.id}`},null,8,["id"]),r("div",Ve,[z((p(),P(U,{severity:(J=e(c))!=null&&J.showPinInfo?void 0:"secondary",class:"w-5 h-7",onClick:l[0]||(l[0]=d=>{var M;return e(s).setSettings({showPinInfo:!((M=e(c))!=null&&M.showPinInfo)})})},{default:te(()=>l[4]||(l[4]=[r("span",{class:"material-icons",style:{"font-size":"18px"}},"question_mark",-1)])),_:1},8,["severity"])),[[X,`Pin Information: ${(Q=e(c))!=null&&Q.showPinInfo?"On":"Off"}`,void 0,{left:!0}]]),z((p(),P(U,{severity:"secondary",class:"w-5 h-7",onClick:l[1]||(l[1]=d=>e(s).reset())},{default:te(()=>l[5]||(l[5]=[r("span",{class:"material-icons",style:{"font-size":"20px"}},"restart_alt",-1)])),_:1})),[[X,"Reset pibody",void 0,{left:!0}]])]),(p(!0),y(S,null,T(e($),(d,M)=>(p(),P(Fe,{key:M,slot:d,index:M,id:t.id},null,8,["slot","index","id"]))),128)),r("div",{class:"absolute bg-black",style:g({left:e(s).usb.x+"px",top:e(s).usb.y-70+"px",width:e(s).usb.w+"px",height:e(s).usb.h+50+"px"})},null,4),r("div",{class:"absolute",style:g({left:e(s).onLED.x+"px",top:e(s).onLED.y+"px",width:e(s).onLED.w+"px",height:e(s).onLED.h+"px"})},null,4),z(r("div",{class:"absolute flex items-center justify-center animate-bounce-up z-10 pointer-events-none",style:g({left:e(s).helpArrows[8].x+"px",top:e(s).helpArrows[8].y+"px"})},[r("span",{class:F(["icon-arrow-down text-5xl",[e(u)===e(a)?"text-green-500":"text-gray-500",e(s).helpArrows[8].class]]),style:g(e(s).helpArrows[8].style)},null,6),l[6]||(l[6]=r("span",{class:"absolute text-white font-bold -mt-2"},"8",-1))],4),[[O,e(s).helpArrows[8].visible||e(i)]]),z(r("div",{class:"absolute flex items-center justify-center animate-bounce-down z-10 pointer-events-none",style:g({left:e(n).x-10+"px",top:e(n).y+8+"px"})},[r("span",{class:F(["icon-arrow-up text-5xl",e(u)===e(n)?"text-green-500":"text-gray-500"]),style:g(e(s).helpArrows[9].style)},null,6),l[7]||(l[7]=r("span",{class:"absolute text-white font-bold -mt-2"},"9",-1))],4),[[O,e(s).helpArrows[9].visible||e(i)]]),A(Te,{class:"absolute top-0 left-0 z-10 w-full h-full pointer-events-none",id:t.id},null,8,["id"])],8,Be),r("div",{id:`module-list-${t.id}`,class:"relative h-full flex-1 overflow-auto overflow-x-hidden w-[450px]"},[r("div",He,[(p(!0),y(S,null,T(e(s).neededModules.value,(d,M)=>(p(),P(se(d.is),W({key:M,class:d.class,style:d.style,ref_for:!0},d,{onPointerdown:[L=>e(s).startDragFromModuleList(d,L),l[2]||(l[2]=Y(L=>L.preventDefault(),["prevent"]))],class:"flex-none w-20 h-20 cursor-move"}),null,16,["class","style","onPointerdown"]))),128)),z(r("div",{class:F(["absolute top-0 left-0 h-full w-full",{"bg-red-500/[0.8]":e(x)}])},l[8]||(l[8]=[r("div",{class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},[r("span",{class:"material-icons",style:{"font-size":"100px"}},"delete")],-1)]),2),[[O,e(x)]])])],8,Ne),(p(!0),y(S,null,T(e(h),(d,M)=>(p(),P(ie,{defer:"",to:d.dragging?`#emulator-${t.id}`:`#pibody-${t.id}`,key:d.id},[d.putOn8or9&&d.connector.end.x!==0&&d.connector.end.y!==0?(p(),P(ze,W({key:0,ref_for:!0},d.connector,{id:t.id}),null,16,["id"])):j("",!0),(p(),P(se(d.is),W({class:d.class,style:[d.style,{left:d.x+"px",top:d.y+"px"}],ref_for:!0},d,{onPointerdown:[L=>e(s).startDragFromSlot(d,M,d.on,L),l[3]||(l[3]=Y(L=>L.preventDefault(),["prevent"]))],class:"absolute w-20 h-20 rounded-xl cursor-move",style:{"touch-action":"none"}}),null,16,["class","style","onPointerdown"]))],8,["to"]))),128))],10,Ae)}}}),qe=K(Oe,[["__scopeId","data-v-2b553ade"]]);export{qe as S};
