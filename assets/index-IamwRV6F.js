import{B as ge,o as d,c as h,Q as ve,m as J,s as xe,j as y,G as N,e as V,a2 as we,a3 as me,r as _,b as le,g as H,z as P,h as u,D as R,t as Q,n as pe,w as F,p as S,l as K,F as O,a4 as he,i as $,y as q,d as Ae,u as Fe,f as M,a5 as ze,M as Re,q as T,Y as fe,v as ke,Z as Pe,_ as Ee,a0 as ae,k as ie,x as Me,H as Ne}from"./index-DahtM8lj.js";import{d as je,_ as Ge}from"./defaultConfirmDeleteOptions-gyGWJYts.js";import{u as $e}from"./useLocaleStore-CQLYhIpY.js";import{L as ye}from"./lessonApi-ChVsmNSY.js";import{m as Oe}from"./mapLessonFromDto-BRb_Xlqa.js";import{U as oe}from"./unitApi-CddXXI7q.js";import{s as He,a as qe,b as Je,c as We}from"./index-D49Ckql9.js";import{s as Ye}from"./index-BWH-atav.js";import{_ as se,d as Se,b as Ke,T as Qe}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-Bcyhz7-E.js";import{s as Ze}from"./index-ekz7f-qv.js";import{s as Ce}from"./index-GUpX1pfL.js";import{s as Le}from"./index-C7_NGefK.js";import{C as Xe}from"./cloudStorageApi-BFpPUPBj.js";import{_ as et}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as tt}from"./index-BcvfGUnb.js";import{s as nt}from"./index-Bo__JrBS.js";import{s as Ue}from"./index-Dq4qGnqI.js";import{s as ot}from"./index-jH-LFEDH.js";import{s as st}from"./index-j0QQ-N9H.js";import{s as lt}from"./index-zBc503VG.js";import{A as at}from"./language-DYQF8nnT.js";import"./mapUnitFromDto-BRBO9875.js";import"./index-B8ImOtmQ.js";import"./index-AjV3mDxz.js";import"./index-B7VVys5w.js";import"./index-CwFCQVYf.js";import"./index-bIm1utdD.js";import"./index-_jBPm5ry.js";import"./index-DVVzbKxq.js";var it=function(s){var e=s.dt;return`
.p-inputgroup,
.p-inputgroup .p-iconfield,
.p-inputgroup .p-floatlabel,
.p-inputgroup .p-iftalabel {
    display: flex;
    align-items: stretch;
    width: 100%;
}

.p-inputgroup .p-inputtext,
.p-inputgroup .p-inputwrapper {
    flex: 1 1 auto;
    width: 1%;
}

.p-inputgroupaddon {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: `.concat(e("inputgroup.addon.padding"),`;
    background: `).concat(e("inputgroup.addon.background"),`;
    color: `).concat(e("inputgroup.addon.color"),`;
    border-block-start: 1px solid `).concat(e("inputgroup.addon.border.color"),`;
    border-block-end: 1px solid `).concat(e("inputgroup.addon.border.color"),`;
    min-width: `).concat(e("inputgroup.addon.min.width"),`;
}

.p-inputgroupaddon:first-child,
.p-inputgroupaddon + .p-inputgroupaddon {
    border-inline-start: 1px solid `).concat(e("inputgroup.addon.border.color"),`;
}

.p-inputgroupaddon:last-child {
    border-inline-end: 1px solid `).concat(e("inputgroup.addon.border.color"),`;
}

.p-inputgroupaddon:has(.p-button) {
    padding: 0;
    overflow: hidden;
}

.p-inputgroupaddon .p-button {
    border-radius: 0;
}

.p-inputgroup > .p-component,
.p-inputgroup > .p-inputwrapper > .p-component,
.p-inputgroup > .p-iconfield > .p-component,
.p-inputgroup > .p-floatlabel > .p-component,
.p-inputgroup > .p-floatlabel > .p-inputwrapper > .p-component,
.p-inputgroup > .p-iftalabel > .p-component,
.p-inputgroup > .p-iftalabel > .p-inputwrapper > .p-component {
    border-radius: 0;
    margin: 0;
}

.p-inputgroupaddon:first-child,
.p-inputgroup > .p-component:first-child,
.p-inputgroup > .p-inputwrapper:first-child > .p-component,
.p-inputgroup > .p-iconfield:first-child > .p-component,
.p-inputgroup > .p-floatlabel:first-child > .p-component,
.p-inputgroup > .p-floatlabel:first-child > .p-inputwrapper > .p-component,
.p-inputgroup > .p-iftalabel:first-child > .p-component,
.p-inputgroup > .p-iftalabel:first-child > .p-inputwrapper > .p-component {
    border-start-start-radius: `).concat(e("inputgroup.addon.border.radius"),`;
    border-end-start-radius: `).concat(e("inputgroup.addon.border.radius"),`;
}

.p-inputgroupaddon:last-child,
.p-inputgroup > .p-component:last-child,
.p-inputgroup > .p-inputwrapper:last-child > .p-component,
.p-inputgroup > .p-iconfield:last-child > .p-component,
.p-inputgroup > .p-floatlabel:last-child > .p-component,
.p-inputgroup > .p-floatlabel:last-child > .p-inputwrapper > .p-component,
.p-inputgroup > .p-iftalabel:last-child > .p-component,
.p-inputgroup > .p-iftalabel:last-child > .p-inputwrapper > .p-component {
    border-start-end-radius: `).concat(e("inputgroup.addon.border.radius"),`;
    border-end-end-radius: `).concat(e("inputgroup.addon.border.radius"),`;
}

.p-inputgroup .p-component:focus,
.p-inputgroup .p-component.p-focus,
.p-inputgroup .p-inputwrapper-focus,
.p-inputgroup .p-component:focus ~ label,
.p-inputgroup .p-component.p-focus ~ label,
.p-inputgroup .p-inputwrapper-focus ~ label {
    z-index: 1;
}

.p-inputgroup > .p-button:not(.p-button-icon-only) {
    width: auto;
}

.p-inputgroup .p-iconfield + .p-iconfield .p-inputtext {
    border-inline-start: 0;
}
`)},rt={root:"p-inputgroup"},dt=ge.extend({name:"inputgroup",theme:it,classes:rt}),ct={name:"BaseInputGroup",extends:xe,style:dt,provide:function(){return{$pcInputGroup:this,$parentInstance:this}}},Ie={name:"InputGroup",extends:ct,inheritAttrs:!1};function ut(o,s,e,i,a,n){return d(),h("div",J({class:o.cx("root")},o.ptmi("root")),[ve(o.$slots,"default")],16)}Ie.render=ut;var pt={root:"p-inputgroupaddon"},gt=ge.extend({name:"inputgroupaddon",classes:pt}),vt={name:"BaseInputGroupAddon",extends:xe,style:gt,provide:function(){return{$pcInputGroupAddon:this,$parentInstance:this}}},Ve={name:"InputGroupAddon",extends:vt,inheritAttrs:!1};function mt(o,s,e,i,a,n){return d(),h("div",J({class:o.cx("root")},o.ptmi("root")),[ve(o.$slots,"default")],16)}Ve.render=mt;var ht=function(s){var e=s.dt;return`
.p-toggleswitch {
    display: inline-block;
    width: `.concat(e("toggleswitch.width"),`;
    height: `).concat(e("toggleswitch.height"),`;
}

.p-toggleswitch-input {
    cursor: pointer;
    appearance: none;
    position: absolute;
    top: 0;
    inset-inline-start: 0;
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0;
    opacity: 0;
    z-index: 1;
    outline: 0 none;
    border-radius: `).concat(e("toggleswitch.border.radius"),`;
}

.p-toggleswitch-slider {
    display: inline-block;
    cursor: pointer;
    width: 100%;
    height: 100%;
    border-width: `).concat(e("toggleswitch.border.width"),`;
    border-style: solid;
    border-color: `).concat(e("toggleswitch.border.color"),`;
    background: `).concat(e("toggleswitch.background"),`;
    transition: background `).concat(e("toggleswitch.transition.duration"),", color ").concat(e("toggleswitch.transition.duration"),", border-color ").concat(e("toggleswitch.transition.duration"),", outline-color ").concat(e("toggleswitch.transition.duration"),", box-shadow ").concat(e("toggleswitch.transition.duration"),`;
    border-radius: `).concat(e("toggleswitch.border.radius"),`;
    outline-color: transparent;
    box-shadow: `).concat(e("toggleswitch.shadow"),`;
}

.p-toggleswitch-handle {
    position: absolute;
    top: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    background: `).concat(e("toggleswitch.handle.background"),`;
    color: `).concat(e("toggleswitch.handle.color"),`;
    width: `).concat(e("toggleswitch.handle.size"),`;
    height: `).concat(e("toggleswitch.handle.size"),`;
    inset-inline-start: `).concat(e("toggleswitch.gap"),`;
    margin-block-start: calc(-1 * calc(`).concat(e("toggleswitch.handle.size"),` / 2));
    border-radius: `).concat(e("toggleswitch.handle.border.radius"),`;
    transition: background `).concat(e("toggleswitch.transition.duration"),", color ").concat(e("toggleswitch.transition.duration"),", inset-inline-start ").concat(e("toggleswitch.slide.duration"),", box-shadow ").concat(e("toggleswitch.slide.duration"),`;
}

.p-toggleswitch.p-toggleswitch-checked .p-toggleswitch-slider {
    background: `).concat(e("toggleswitch.checked.background"),`;
    border-color: `).concat(e("toggleswitch.checked.border.color"),`;
}

.p-toggleswitch.p-toggleswitch-checked .p-toggleswitch-handle {
    background: `).concat(e("toggleswitch.handle.checked.background"),`;
    color: `).concat(e("toggleswitch.handle.checked.color"),`;
    inset-inline-start: calc(`).concat(e("toggleswitch.width")," - calc(").concat(e("toggleswitch.handle.size")," + ").concat(e("toggleswitch.gap"),`));
}

.p-toggleswitch:not(.p-disabled):has(.p-toggleswitch-input:hover) .p-toggleswitch-slider {
    background: `).concat(e("toggleswitch.hover.background"),`;
    border-color: `).concat(e("toggleswitch.hover.border.color"),`;
}

.p-toggleswitch:not(.p-disabled):has(.p-toggleswitch-input:hover) .p-toggleswitch-handle {
    background: `).concat(e("toggleswitch.handle.hover.background"),`;
    color: `).concat(e("toggleswitch.handle.hover.color"),`;
}

.p-toggleswitch:not(.p-disabled):has(.p-toggleswitch-input:hover).p-toggleswitch-checked .p-toggleswitch-slider {
    background: `).concat(e("toggleswitch.checked.hover.background"),`;
    border-color: `).concat(e("toggleswitch.checked.hover.border.color"),`;
}

.p-toggleswitch:not(.p-disabled):has(.p-toggleswitch-input:hover).p-toggleswitch-checked .p-toggleswitch-handle {
    background: `).concat(e("toggleswitch.handle.checked.hover.background"),`;
    color: `).concat(e("toggleswitch.handle.checked.hover.color"),`;
}

.p-toggleswitch:not(.p-disabled):has(.p-toggleswitch-input:focus-visible) .p-toggleswitch-slider {
    box-shadow: `).concat(e("toggleswitch.focus.ring.shadow"),`;
    outline: `).concat(e("toggleswitch.focus.ring.width")," ").concat(e("toggleswitch.focus.ring.style")," ").concat(e("toggleswitch.focus.ring.color"),`;
    outline-offset: `).concat(e("toggleswitch.focus.ring.offset"),`;
}

.p-toggleswitch.p-invalid > .p-toggleswitch-slider {
    border-color: `).concat(e("toggleswitch.invalid.border.color"),`;
}

.p-toggleswitch.p-disabled {
    opacity: 1;
}

.p-toggleswitch.p-disabled .p-toggleswitch-slider {
    background: `).concat(e("toggleswitch.disabled.background"),`;
}

.p-toggleswitch.p-disabled .p-toggleswitch-handle {
    background: `).concat(e("toggleswitch.handle.disabled.background"),`;
}
`)},ft={root:{position:"relative"}},bt={root:function(s){var e=s.instance,i=s.props;return["p-toggleswitch p-component",{"p-toggleswitch-checked":e.checked,"p-disabled":i.disabled,"p-invalid":e.$invalid}]},input:"p-toggleswitch-input",slider:"p-toggleswitch-slider",handle:"p-toggleswitch-handle"},wt=ge.extend({name:"toggleswitch",theme:ht,classes:bt,inlineStyles:ft}),yt={name:"BaseToggleSwitch",extends:nt,props:{trueValue:{type:null,default:!0},falseValue:{type:null,default:!1},readonly:{type:Boolean,default:!1},tabindex:{type:Number,default:null},inputId:{type:String,default:null},inputClass:{type:[String,Object],default:null},inputStyle:{type:Object,default:null},ariaLabelledby:{type:String,default:null},ariaLabel:{type:String,default:null}},style:wt,provide:function(){return{$pcToggleSwitch:this,$parentInstance:this}}},Be={name:"ToggleSwitch",extends:yt,inheritAttrs:!1,emits:["change","focus","blur"],methods:{getPTOptions:function(s){var e=s==="root"?this.ptmi:this.ptm;return e(s,{context:{checked:this.checked,disabled:this.disabled}})},onChange:function(s){if(!this.disabled&&!this.readonly){var e=this.checked?this.falseValue:this.trueValue;this.writeValue(e,s),this.$emit("change",s)}},onFocus:function(s){this.$emit("focus",s)},onBlur:function(s){var e,i;this.$emit("blur",s),(e=(i=this.formField).onBlur)===null||e===void 0||e.call(i,s)}},computed:{checked:function(){return this.d_value===this.trueValue}}},_t=["data-p-checked","data-p-disabled"],xt=["id","checked","tabindex","disabled","readonly","aria-checked","aria-labelledby","aria-label","aria-invalid"];function kt(o,s,e,i,a,n){return d(),h("div",J({class:o.cx("root"),style:o.sx("root")},n.getPTOptions("root"),{"data-p-checked":n.checked,"data-p-disabled":o.disabled}),[y("input",J({id:o.inputId,type:"checkbox",role:"switch",class:[o.cx("input"),o.inputClass],style:o.inputStyle,checked:n.checked,tabindex:o.tabindex,disabled:o.disabled,readonly:o.readonly,"aria-checked":n.checked,"aria-labelledby":o.ariaLabelledby,"aria-label":o.ariaLabel,"aria-invalid":o.invalid||void 0,onFocus:s[0]||(s[0]=function(){return n.onFocus&&n.onFocus.apply(n,arguments)}),onBlur:s[1]||(s[1]=function(){return n.onBlur&&n.onBlur.apply(n,arguments)}),onChange:s[2]||(s[2]=function(){return n.onChange&&n.onChange.apply(n,arguments)})},n.getPTOptions("input")),null,16,xt),y("div",J({class:o.cx("slider")},n.getPTOptions("slider")),[y("div",J({class:o.cx("handle")},n.getPTOptions("handle")),[ve(o.$slots,"handle",{checked:n.checked})],16)],16)],16,_t)}Be.render=kt;const E={hideLesson:$t,modifyLesson:St,publishLesson:Ct,sendLessonForReview:Lt,cancelLessonReview:Ut,startLessonReview:It,acceptLesson:Vt,rejectLesson:Bt,editLesson:Tt};async function $t(o){return await N.patch(`v2/lesson/${o}/hide`)}async function St(o){return await N.patch(`v2/lesson/${o}/modify`)}async function Ct(o){return await N.patch(`v2/lesson/${o}/publish`)}async function Lt(o){return await N.patch(`v2/lesson/${o}/review/send`)}async function Ut(o){return await N.patch(`v2/lesson/${o}/review/cancel`)}async function It(o){return await N.patch(`v2/lesson/${o}/review/start`)}async function Vt(o){return await N.patch(`v2/lesson/${o}/review/accept`)}async function Bt(o){return await N.patch(`v2/lesson/${o}/review/reject`)}async function Tt(o){return await N.patch(`v2/lesson/${o}/review/edit`)}const B=[];for(let o=0;o<256;++o)B.push((o+256).toString(16).slice(1));function Dt(o,s=0){return(B[o[s+0]]+B[o[s+1]]+B[o[s+2]]+B[o[s+3]]+"-"+B[o[s+4]]+B[o[s+5]]+"-"+B[o[s+6]]+B[o[s+7]]+"-"+B[o[s+8]]+B[o[s+9]]+"-"+B[o[s+10]]+B[o[s+11]]+B[o[s+12]]+B[o[s+13]]+B[o[s+14]]+B[o[s+15]]).toLowerCase()}let re;const At=new Uint8Array(16);function Ft(){if(!re){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");re=crypto.getRandomValues.bind(crypto)}return re(At)}const zt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),_e={randomUUID:zt};function Te(o,s,e){var a;if(_e.randomUUID&&!s&&!o)return _e.randomUUID();o=o||{};const i=o.random??((a=o.rng)==null?void 0:a.call(o))??Ft();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,Dt(i)}const Rt={class:"flex items-center"},Pt={class:"flex items-center mr-2"},Et=V({__name:"HighlightEditor",props:we({index:{},usedSlots:{}},{highlight:{},highlightModifiers:{}}),emits:we(["remove","save"],["update:highlight"]),setup(o,{emit:s}){const e=o,i=me(o,"highlight"),a=_(""),n=_(null),t=_(null),l=_(!1),p=le(()=>n.value!=null&&t.value!=null),c=s,b=()=>{c("remove",e.index)};H(()=>{i.value&&(a.value=i.value.id,n.value=i.value.module,t.value=i.value.slot,l.value=i.value.autoPut)}),P([n,t,l],()=>{n.value!=null&&c("save",e.index,a.value,n.value,t.value,l.value)}),P(p,C=>{C||(l.value=!1)});const m=_(["A","B","C","D","E","F"]),k=_(["8","9"]),v=_(["LED","switch","push-button","light-sensor","touch-sensor","potentiometer","encoder","motion-detector","microphone","climate-sensor","gyro-accel","buzzer","color-sensor","joystick","distance-sensor","servo","led-tower"]),x=le(()=>{if(n.value){if(n.value==="servo"||n.value==="led-tower"){const L=k.value.filter(A=>!(e.usedSlots??[]).includes(A));return t.value&&!L.includes(t.value)&&L.unshift(t.value),[null,...L]}const g=m.value.filter(f=>!(e.usedSlots??[]).includes(f));return t.value&&!g.includes(t.value)&&g.unshift(t.value),[null,...g]}const r=[...m.value,...k.value].filter(w=>!(e.usedSlots??[]).includes(w));return t.value&&!r.includes(t.value)&&r.unshift(t.value),[null,...r]}),U=le(()=>t.value?t.value==="8"||t.value==="9"?["servo","led-tower"]:v.value.filter(C=>C!=="servo"&&C!=="led-tower"):v.value);return(C,r)=>{const w=Le,g=Ce,f=Ve,L=Ie,A=F;return d(),h("div",Rt,[y("div",Pt,[u(w,{modelValue:l.value,"onUpdate:modelValue":r[0]||(r[0]=I=>l.value=I),binary:"","input-id":"autoput",disabled:!p.value},null,8,["modelValue","disabled"]),r[3]||(r[3]=y("label",{for:"autoput",class:"ml-1 text-sm"},"auto",-1))]),u(L,null,{default:R(()=>[u(g,{modelValue:n.value,"onUpdate:modelValue":r[1]||(r[1]=I=>n.value=I),options:U.value,placeholder:"Select module",class:"place-content-center",size:"small"},null,8,["modelValue","options"]),u(f,{class:"h-[35px]"},{default:R(()=>r[4]||(r[4]=[y("div",null,"=>",-1)])),_:1}),u(g,{modelValue:t.value,"onUpdate:modelValue":r[2]||(r[2]=I=>t.value=I),options:x.value,placeholder:"Select slot",size:"small"},{option:R(({option:I})=>[y("span",{class:pe(I===null?"text-gray-400":"")},Q(I===null?"[null]":I),3)]),value:R(({value:I})=>[y("span",{class:pe(I===null?"text-gray-400":"")},Q(I===null?"[null]":I),3)]),_:1},8,["modelValue","options"])]),_:1}),u(A,{icon:"pi pi-trash",variant:"text",severity:"danger","aria-label":"Remove",onClick:b,class:"ml-2"})])}}}),Mt={class:"flex flex-col gap-2"},Nt=V({__name:"HighlightPanel",props:{neededModules:{default:[]},neededModulesModifiers:{}},emits:["update:neededModules"],setup(o){const s=me(o,"neededModules");function e(){s.value=[...s.value,{autoPut:!1,module:null,slot:null,id:Te()}]}function i(n){s.value.splice(n,1)}function a(n,t,l,p,c){s.value[n].id=t,s.value[n].module=l,s.value[n].slot=p,s.value[n].autoPut=c}return(n,t)=>{const l=F,p=Ze;return d(),S(p,{header:"Highlight slots & modules"},{default:R(()=>[y("div",Mt,[(d(!0),h(O,null,K(s.value,(c,b)=>(d(),h("div",{key:c.id},[u(Et,{highlight:s.value[b],"onUpdate:highlight":m=>s.value[b]=m,index:b,usedSlots:s.value.filter((m,k)=>{var v;return k!==b&&((v=s.value[k])==null?void 0:v.slot)!=null}).map(m=>m.slot),onRemove:i,onSave:a},null,8,["highlight","onUpdate:highlight","index","usedSlots"])]))),128))]),u(l,{icon:"pi pi-plus",variant:"text","aria-label":"Add",class:"self-center mt-2",onClick:e})]),_:1})}}}),jt={class:"flex"},Gt={class:"h-[500px] flex flex-col w-full relative"},Ot={class:"flex h-full",style:{border:"0.1px solid #808080",borderTopLeftRadius:"12px",borderTopRightRadius:"12px",overflow:"hidden"}},Ht={class:"absolute right-2 bottom-2"},de=!1,qt=V({__name:"PibodyEditor",props:{id:{},content:{},data:{}},emits:["save-content","show-tester"],setup(o,{emit:s}){const e=q(),i=o,a=s,n=_(""),t=_(""),l=_([]);let p=!0;he(()=>{n.value=i.content.starting,t.value=i.content.answer,l.value=i.data.neededModules??[]}),P([n,t,l],()=>{if(p){p=!1;return}a("save-content",{starting:n.value,answer:t.value,hashed_answer:""},{neededModules:l.value.filter(b=>b.module!=null),tests:i.data.tests,includedCommandsForTests:i.data.includedCommandsForTests})},{deep:!0});function c(){a("show-tester",{lesson_id:e.params.id,unit_id:i.id.split("-")[1]})}return(b,m)=>{const k=F;return d(),h(O,null,[y("div",jt,[y("div",Gt,[y("div",Ot,[u(se,{code:n.value,"onUpdate:code":m[0]||(m[0]=v=>n.value=v),runbuttons:!1,connectbuttons:de,id:i.id+"_",class:"flex-1"},null,8,["code","id"]),u(se,{code:t.value,"onUpdate:code":m[1]||(m[1]=v=>t.value=v),connectbuttons:de,"onUpdate:connectbuttons":m[2]||(m[2]=v=>de=v),id:i.id,class:"flex-1"},null,8,["code","id"])]),y("div",Ht,[u(k,{label:"Tests",icon:"pi pi-pen-to-square",class:"w-fit",severity:"info",onClick:c})]),u($(Se),{id:i.id,class:"flex-grow max-h-40"},null,8,["id"])])]),u(Nt,{neededModules:l.value,"onUpdate:neededModules":m[3]||(m[3]=v=>l.value=v),class:"mb-2"},null,8,["neededModules"])],64)}}}),Jt={class:"flex"},Wt={class:"h-[500px] flex flex-col w-full relative"},Yt={class:"flex h-full",style:{border:"0.1px solid #808080",borderTopLeftRadius:"12px",borderTopRightRadius:"12px",overflow:"hidden"}},Kt={class:"absolute right-2 bottom-2"},ce=!1,Qt=V({__name:"CodeEditor",props:{id:{},code:{}},emits:["save-content","show-tester"],setup(o,{emit:s}){const e=q(),i=o,a=s,n=_(""),t=_("");let l=!0;he(()=>{n.value=i.code.starting,t.value=i.code.answer}),P([n,t],()=>{if(l){l=!1;return}a("save-content",{starting:n.value,answer:t.value,hashed_answer:""})});function p(){a("show-tester",{lesson_id:e.params.id,unit_id:i.id.split("-")[1]})}return(c,b)=>{const m=F;return d(),h("div",Jt,[y("div",Wt,[y("div",Yt,[u(se,{code:n.value,"onUpdate:code":b[0]||(b[0]=k=>n.value=k),runbuttons:!1,connectbuttons:ce,id:i.id+"_",class:"flex-1"},null,8,["code","id"]),u(se,{code:t.value,"onUpdate:code":b[1]||(b[1]=k=>t.value=k),connectbuttons:ce,"onUpdate:connectbuttons":b[2]||(b[2]=k=>ce=k),id:i.id,class:"flex-1"},null,8,["code","id"])]),y("div",Kt,[u(m,{label:"Tests",icon:"pi pi-pen-to-square",class:"w-fit",severity:"info",onClick:p})]),u($(Se),{id:i.id,class:"flex-grow max-h-40"},null,8,["id"])])])}}}),Zt=["article","options","open","video","code","pibody"],G=Ae("lesson-edit-store",()=>{const o=Fe(),s=$e(),{lang:e}=M(s),i=_(null),a=_(!1),n=_(!1),t=_(!1),l=_(!1),p=_(!1),c=_(!1);function b(r){t.value=r}async function m(r){try{a.value=!0;const{data:w}=await ye.getLessonById(r,void 0,e.value);i.value=Oe(w)}catch(w){o.add({severity:"error",summary:w.response.data.error,life:2e3})}finally{a.value=!1}}async function k(r,w){try{n.value=!0;const{data:g}=await oe.getUnitByIdandLessonId(r,w,e.value);return g}catch(g){o.add({severity:"error",summary:g.response.data.error,life:2e3})}finally{n.value=!1}}async function v(r){try{l.value=!0;const{data:w}=await oe.createUnitByLessonId(i.value.id,r);o.add({severity:"success",summary:w.message,life:2e3})}catch(w){o.add({severity:"error",summary:w.response.data.error,life:2e3})}finally{l.value=!1}}async function x(r,w,g){try{p.value=!0;const{data:f}=await oe.updateUnitByIdandLessonId(r,w,g,e.value);return f.unit_id}catch(f){o.add({severity:"error",summary:f.response.data.error,life:2e3})}finally{p.value=!1}}async function U(r,w){try{c.value=!0;const{data:g}=await oe.deleteUnitByIdandLessonId(r,w);o.add({severity:"success",summary:g.message,life:2e3})}catch(g){o.add({severity:"error",summary:g.response.data.error,life:2e3})}finally{c.value=!1}}async function C(r,w){try{c.value=!0;const{data:g}=await ye.translateLesson(r,e.value,w,"chatgpt");o.add({severity:"success",summary:g.message,life:2e3})}catch(g){o.add({severity:"error",summary:g.response.data.error,life:2e3})}finally{c.value=!1}}return{selectedLesson:i,isLessonLoading:a,isLessonSaving:t,isUnitLoading:n,isUnitCreating:l,isUnitUpdating:p,isUnitDeleting:c,setLessonSaving:b,loadLessonById:m,loadUnitByIdandLessonId:k,createUnit:v,updateUnitByIdandLessonId:x,deleteUnitByIdandLessonId:U,translateLessonToLang:C}}),Xt={class:"flex items-start"},en=V({__name:"MdEditor",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(o){const s=me(o,"modelValue"),e=ze({title:{title:"Title",icon:"v-md-icon-tip",action(a){a.insert(n=>{const t="# <center>",l="</center>",c=n||"Title";return{text:`${t}${c}${l}`,selected:c}})}},icons:{title:"icons",icon:"v-md-icon-tip",menus:[{name:"Attention",text:"Attention",action(a){a.insert(()=>{const n='<span style="font-size: 20px">',t="</span>",l="⚠️";return{text:`${n}${l}${t}`,selected:l}})}},{name:"PiBody",text:"PiBody",action(a){a.insert(()=>{const n="<b>",t="</b>",l='<span style="color: #FF3F85"> Pi</span>Body';return{text:`${n}${l}${t}`,selected:l}})}},{name:"Run",text:"Run",action(a){a.insert(()=>({text:"▶️<b>Run</b>"}))}}]},style:{title:"Style",icon:"v-md-icon-tip",action(a){a.insert(n=>{const t='<span style="">',l="</span>",c=n||"placeholder";return{text:`${t}${c}${l}`,selected:c}})}},underline:{title:"Underline",icon:"v-md-icon-under-line",action(a){a.insert(n=>{const t='<span style="text-decoration: underline">',l="</span>",c=n||"placeholder";return{text:`${t}${c}${l}`,selected:c}})}},tip:{title:"Tip",icon:"v-md-icon-tip",action(a){a.insert(n=>{const t='<div style="background-color:#F3F5F7; padding: 20px; border-left: solid 8px #42B983">',l="</div>",c=n||"placeholder";return{text:`${t}${c}${l}`,selected:c}})}},note:{title:"Note",icon:"v-md-icon-tip",action(a){a.insert(n=>{const t='<div style="background-color:#F3F5F7; padding: 15px; border-left: solid 8px #FFCD6B; margin-bottom: 15px">',l="</div>",c=n||"placeholder";return{text:`${t}${c}${l}`,selected:c}})}}});async function i(a,n,t){const l=t[0],p=new FormData;p.append("file",l);try{const{data:c}=await Xe.uploadFile(p,"image_"),b=c.source_url;n({url:b,desc:"desc",width:"auto",height:"auto"})}catch(c){console.log(c)}}return(a,n)=>{const t=Re("v-md-editor");return d(),h("div",Xt,[u(t,{modelValue:s.value,"onUpdate:modelValue":n[0]||(n[0]=l=>s.value=l),mode:"edit",onChange:n[1]||(n[1]=l=>s.value=l),"left-toolbar":"undo redo clear | tip emoji todo-list | h bold italic strikethrough quote ul ol table hr link code image | title icons style underline tip note","right-toolbar":"",toolbar:e,"disabled-menus":[],onUploadImage:i},null,8,["modelValue","toolbar"])])}}}),De=et(en,[["__scopeId","data-v-52e9f376"]]),tn=V({__name:"ArticleEditor",props:{article:{}},emits:["save-content"],setup(o,{emit:s}){const e=o,i=s,a=_("");let n=!0;return H(()=>{var t;a.value=((t=e.article)==null?void 0:t.text)??""}),P(a,()=>{if(n){n=!1;return}i("save-content",{text:a.value})},{flush:"post"}),(t,l)=>(d(),S(De,{modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=p=>a.value=p)},null,8,["modelValue"]))}}),nn={class:"flex flex-col gap-2"},on={class:"flex gap-1 text-gray-500"},sn={class:"flex flex-col gap-1"},ln=V({__name:"OptionsEditor",props:{optionsData:{}},emits:["save-content"],setup(o,{emit:s}){const e=o,i=s,a=_(!1),n=_(!1),t=_(!1),l=_([]),p=_([]),c=_();let b=!0;H(()=>{var v,x,U,C,r,w;a.value=((v=e.optionsData)==null?void 0:v.shuffle)??!1,n.value=((x=e.optionsData)==null?void 0:x.feedback)??!1,t.value=((U=e.optionsData)==null?void 0:U.single)??!1,l.value=((C=e.optionsData)==null?void 0:C.options)??[],p.value=((r=e.optionsData)==null?void 0:r.answer)??[],c.value=e.optionsData&&e.optionsData.answer&&e.optionsData.answer.length>0?(w=e.optionsData)==null?void 0:w.answer[0]:void 0}),P([a,n,t,l,p,c],()=>{if(b){b=!1;return}i("save-content",{shuffle:a.value,feedback:n.value,single:t.value,options:l.value,answer:t.value?c.value?[c.value]:[]:p.value,hashed_answer:[]})},{deep:!0});function m(){l.value.push({id:Te(),text:""})}function k(v){l.value=l.value.filter(x=>x.id!==v),p.value=p.value.filter(x=>x!==v),c.value==v&&(c.value=void 0)}return(v,x)=>{const U=Be,C=tt,r=Le,w=F;return d(),h("div",nn,[y("div",on,[x[5]||(x[5]=y("div",null,"shuffle:",-1)),u(U,{modelValue:a.value,"onUpdate:modelValue":x[0]||(x[0]=g=>a.value=g),class:"mr-2"},null,8,["modelValue"]),x[6]||(x[6]=y("div",null,"feedback:",-1)),u(U,{modelValue:n.value,"onUpdate:modelValue":x[1]||(x[1]=g=>n.value=g),class:"mr-2"},null,8,["modelValue"]),x[7]||(x[7]=y("div",null,"single:",-1)),u(U,{modelValue:t.value,"onUpdate:modelValue":x[2]||(x[2]=g=>t.value=g)},null,8,["modelValue"])]),y("div",sn,[(d(!0),h(O,null,K(l.value,g=>(d(),h("div",{key:g.id,class:"flex gap-2 items-center"},[t.value?(d(),S(C,{key:0,modelValue:c.value,"onUpdate:modelValue":x[3]||(x[3]=f=>c.value=f),value:g.id},null,8,["modelValue","value"])):(d(),S(r,{key:1,modelValue:p.value,"onUpdate:modelValue":x[4]||(x[4]=f=>p.value=f),value:g.id},null,8,["modelValue","value"])),u(De,{modelValue:g.text,"onUpdate:modelValue":f=>g.text=f,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"]),u(w,{icon:"pi pi-trash",variant:"text",severity:"danger",size:"small",onClick:f=>k(g.id)},null,8,["onClick"])]))),128))]),u(w,{icon:"pi pi-plus",label:"Add option",variant:"text",size:"small",onClick:m,class:"self-center"})])}}}),an=V({__name:"OpenEditor",props:{open:{}},emits:["save-content"],setup(o,{emit:s}){const e=o,i=s,a=_("");let n=!0;return H(()=>{var t;a.value=((t=e.open)==null?void 0:t.answer)??""}),P(a,()=>{if(n){n=!1;return}i("save-content",{answer:a.value,hashed_answer:""})}),(t,l)=>{const p=Ue;return d(),S(p,{type:"text",modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=c=>a.value=c??""),class:"w-full",size:"small"},null,8,["modelValue"])}}}),rn=V({__name:"VideoEditor",props:{video:{}},emits:["save-content"],setup(o,{emit:s}){const e=o,i=s,a=_("");let n=!0;return H(()=>{var t;a.value=((t=e.video)==null?void 0:t.url)??""}),P(a,()=>{if(n){n=!1;return}i("save-content",{url:a.value})}),(t,l)=>{const p=Ue;return d(),S(p,{type:"text",modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=c=>a.value=c??""),class:"w-full",size:"small"},null,8,["modelValue"])}}}),dn={class:"bg-white rounded-lg border border-gray-200"},cn={key:1,class:"flex flex-col h-full w-full"},un={class:"flex items-center gap-2 px-4 pt-2"},pn={class:"text-sm"},gn={class:"text-sm text-gray-500"},vn={key:1,class:"flex-grow px-4 py-2"},mn={class:"flex justify-end"},hn=V({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},emits:["delete","update"],setup(o,{emit:s}){const e=o,i=s,a=q(),n=ke(),t=G(),{updateUnitByIdandLessonId:l,setLessonSaving:p,loadUnitByIdandLessonId:c}=t,b=_(!1),m=_(null),k=_(null);he(async()=>{b.value=!0;const r=await c(e.unit.id,Number(a.params.id));r&&(m.value=r.content,k.value=r.data),b.value=!1});function v(r,w){p(!0),U(r,w)}function x(r){n.push({name:"tester2",params:{lesson_id:r.lesson_id,unit_id:r.unit_id}})}const U=Ke((r,w)=>{C(r,w)},1e3,{maxWait:5e3});async function C(r,w){const g=await l(e.unit.id,Number(a.params.id),{content:r,data:w});g&&i("update",e.unit,g),p(!1)}return(r,w)=>{const g=Ye,f=F;return d(),h("div",dn,[r.loading?(d(),S(g,{key:0,class:"flex justify-center items-center w-10 h-full"})):(d(),h("div",cn,[y("div",un,[y("div",pn,Q(r.unit.id),1),y("div",gn,Q(`${r.unit.unitType}`),1)]),b.value?(d(),S(g,{key:0,class:"flex justify-center items-center w-10 h-full"})):(d(),h("div",vn,[r.unit.unitType=="article"?(d(),S(tn,{key:0,article:m.value,onSaveContent:v},null,8,["article"])):r.unit.unitType=="options"?(d(),S(ln,{key:1,"options-data":m.value,onSaveContent:v},null,8,["options-data"])):r.unit.unitType=="open"?(d(),S(an,{key:2,open:m.value,onSaveContent:v},null,8,["open"])):r.unit.unitType=="video"?(d(),S(rn,{key:3,video:m.value,onSaveContent:v},null,8,["video"])):e.unit.unitType=="code"?(d(),S($(Qt),{key:4,id:`code-${e.unit.id}`,code:m.value,onSaveContent:v,onShowTester:x},null,8,["id","code"])):e.unit.unitType=="pibody"?(d(),S($(qt),{key:5,id:`code-${e.unit.id}`,content:m.value,data:k.value,onSaveContent:v,onShowTester:x},null,8,["id","content","data"])):T("",!0)])),y("div",mn,[u(f,{icon:"pi pi-trash",size:"small",severity:"danger",variant:"text",onClick:w[0]||(w[0]=fe(L=>i("delete",e.unit),["stop"]))})])]))])}}}),fn={class:"group w-full relative"},bn={class:"flex"},ue=V({__name:"AddUnitButton",props:{unitId:{},showAddGroup:{type:Boolean},hided:{type:Boolean}},emits:["add-group-divider"],setup(o,{emit:s}){const e=o,i=s,a=q(),n=G(),{loadLessonById:t,createUnit:l}=n,p=_(),c=_(Zt.map(m=>({label:m,command:async()=>{await l({unit_type:m,prev_unit_id:e.unitId??void 0}),await t(Number(a.params.id))}}))),b=m=>{p.value.toggle(m)};return(m,k)=>{const v=st,x=F,U=ot;return d(),h(O,null,[y("div",fn,[k[1]||(k[1]=y("div",{class:"h-3"},null,-1)),y("div",{class:pe(["absolute left-1/2 -translate-x-1/2 -top-5 group-hover:block mt-[9px] w-full",m.hided?"hidden":""])},[y("div",bn,[u(v,{class:"w-7",type:"dashed"}),u(v,{class:"flex-grow",type:"dashed"}),u(x,{icon:"pi pi-plus",class:"flex self-end shadow-xl h-7",size:"small",onClick:b}),u(v,{class:"flex-grow",type:"dashed"}),m.showAddGroup?(d(),S(x,{key:0,icon:"pi pi-arrow-up-right-and-arrow-down-left-from-center",class:"flex self-end h-7",size:"small",variant:"text",onClick:k[0]||(k[0]=C=>i("add-group-divider"))})):(d(),S(v,{key:1,class:"w-7",type:"dashed"}))])],2)]),u(U,{ref_key:"menu",ref:p,model:c.value,popup:!0},null,8,["model"])],64)}}}),wn=V({__name:"RemoveGroupButton",emits:["remove-group-divider"],setup(o,{emit:s}){const e=s;return(i,a)=>{const n=F;return d(),S(n,{icon:"pi pi-arrow-down-left-and-arrow-up-right-to-center",severity:"danger",class:"flex self-end h-7 w-7",size:"small",variant:"text",onClick:a[0]||(a[0]=fe(t=>e("remove-group-divider"),["stop"]))})}}}),yn={class:"flex flex-col gap-2"},_n={class:"w-full flex justify-between gap-2 mr-4"},xn={class:"flex flex-row"},kn={class:"flex flex-col p-2 rounded-lg bg-slate-50"},$n=V({__name:"UnitsView",props:{pages:{}},setup(o){const s=o,e=q(),i=Pe(),a=G(),{isUnitDeleting:n}=M(a),{loadLessonById:t,createUnit:l,deleteUnitByIdandLessonId:p}=a,c=_(null);async function b(f){await l({unit_type:"group-divider",prev_unit_id:f.id}),await t(Number(e.params.id))}async function m(){await l({unit_type:"page-divider"}),await t(Number(e.params.id))}async function k(f){await l({unit_type:"page-divider",prev_unit_id:f}),await p(f,Number(e.params.id)),await t(Number(e.params.id))}async function v(f){await p(f,Number(e.params.id)),await t(Number(e.params.id))}function x(f){c.value=f,i.require({...je,message:"Are you sure you want to delete this lesson?",accept:async()=>{await p(f.id,Number(e.params.id)),await t(Number(e.params.id))}})}function U(f,L){L>f.id&&(f.id=L)}const C=Number(e.params.id),r=`openedPanels-${C}`,w=_({});H(async()=>{const f=localStorage.getItem(r);f&&(w.value=JSON.parse(f)),await Ee(),setTimeout(()=>{const L=localStorage.getItem(`lastOpenedGroup-${C}`);if(L){const A=document.getElementById(`group-${L}`);if(A){A.scrollIntoView({behavior:"smooth"});return}}},1e3)}),P(w,f=>{localStorage.setItem(r,JSON.stringify(f))},{deep:!0});function g(f,L){w.value[L]=f,w.value[L].length>0&&localStorage.setItem(`lastOpenedGroup-${C}`,f[f.length-1])}return(f,L)=>{const A=F,I=He,Z=qe,X=Je,ee=We;return d(),h("div",yn,[(d(!0),h(O,null,K(s.pages,j=>(d(),S(ee,{value:w.value[j.id]||[],"onUpdate:value":D=>g(D,j.id),multiple:"",key:j.id,class:"flex flex-col gap-2 bg-white p-4 rounded-lg shadow-lg"},{default:R(()=>[(d(!0),h(O,null,K(j.groups,(D,W)=>(d(),S(X,{key:D.id,value:D.id,id:`group-${D.id}`},{default:R(()=>[u(I,null,{default:R(()=>[y("div",_n,[y("div",null,"Step: "+Q(W),1),y("div",xn,[W!=0?(d(),S(A,{key:0,icon:"pi pi-file-plus",class:"flex self-end h-7 w-7",size:"small",variant:"text",onClick:fe(z=>k(D.id),["stop"])},null,8,["onClick"])):T("",!0),D.id!=-1?(d(),S(wn,{key:1,onRemoveGroupDivider:z=>v(D.id)},null,8,["onRemoveGroupDivider"])):T("",!0)])])]),_:2},1024),u(Z,{class:"flex flex-col"},{default:R(()=>[y("div",kn,[(d(!0),h(O,null,K(D.units,(z,te)=>{var Y;return d(),h("div",{key:z.id},[te==0?(d(),S(ue,{key:0,hided:!0,"unit-id":D.id,"show-add-group":!1},null,8,["unit-id"])):T("",!0),u(hn,{unit:z,loading:((Y=c.value)==null?void 0:Y.id)===z.id&&$(n),onDelete:ne=>x(z),onUpdate:U},null,8,["unit","loading","onDelete"]),u(ue,{hided:!0,"unit-id":z.id,"show-add-group":!0,onAddGroupDivider:ne=>b(z)},null,8,["unit-id","onAddGroupDivider"])])}),128)),D.units.length==0?(d(),S(ue,{key:0,hided:!1,"unit-id":D.id,"show-add-group":!1},null,8,["unit-id"])):T("",!0)])]),_:2},1024)]),_:2},1032,["value","id"]))),128))]),_:2},1032,["value","onUpdate:value"]))),128)),u(A,{id:"newpage",icon:"pi pi-plus",label:"New page",variant:"text",size:"small",class:"flex self-center",onClick:L[0]||(L[0]=j=>m())})])}}}),Sn={class:"w-[24px] h-[24px]"},Cn={key:0,class:"flex items-center"},Ln={key:0,class:"material-icons text-gray-500"},Un={key:1,class:"material-icons text-gray-500"},In={key:1},Vn={class:"material-icons text-gray-500"},Bn=V({__name:"AutoSaveCloud",setup(o){const s=G(),{selectedLesson:e,isLessonSaving:i}=M(s);return(a,n)=>{var l;const t=Qe;return d(),h("div",Sn,[(l=$(e))!=null&&l.editable?(d(),h("div",Cn,[$(i)?ae((d(),h("span",Un,n[1]||(n[1]=[ie("cloud_sync")]))),[[t,"Saving...",void 0,{bottom:!0}]]):ae((d(),h("span",Ln,n[0]||(n[0]=[ie("cloud_done")]))),[[t,"Saved",void 0,{bottom:!0}]])])):(d(),h("div",In,[ae((d(),h("span",Vn,n[2]||(n[2]=[ie("cloud_off")]))),[[t,"Save not allowed",void 0,{bottom:!0}]])]))])}}}),Tn={key:0},Dn={key:0},An={key:1},Fn={key:0},zn={key:1},Rn={key:2},Pn={key:0,class:"flex gap-1"},En={key:3},Mn={key:0},Nn={key:4},jn={key:0,class:"flex gap-1"},Gn={key:5},On={key:0,class:"flex gap-1"},Hn={key:6},qn={key:0,class:"flex gap-1"},Jn=V({__name:"StageButtons",setup(o){const s=q(),e=Me(),{user:i}=M(e),a=G(),{selectedLesson:n}=M(a),t=_(!1),l=_(!1);async function p(){t.value=!0;try{await E.sendLessonForReview(s.params.id.toString()),window.location.reload()}catch(r){console.log(r)}finally{t.value=!1}}async function c(){t.value=!0;try{await E.cancelLessonReview(s.params.id.toString()),window.location.reload()}catch(r){console.log(r)}finally{t.value=!1}}async function b(){t.value=!0;try{await E.startLessonReview(s.params.id.toString()),window.location.reload()}catch(r){console.log(r)}finally{t.value=!1}}async function m(){t.value=!0;try{await E.acceptLesson(s.params.id.toString()),window.location.reload()}catch(r){console.log(r)}finally{t.value=!1}}async function k(){l.value=!0;try{await E.rejectLesson(s.params.id.toString()),window.location.reload()}catch(r){console.log(r)}finally{l.value=!1}}async function v(){t.value=!0;try{await E.editLesson(s.params.id.toString()),window.location.reload()}catch(r){console.log(r)}finally{t.value=!1}}async function x(){t.value=!0;try{await E.publishLesson(s.params.id.toString()),window.location.reload()}catch(r){console.log(r)}finally{t.value=!1}}async function U(){l.value=!0;try{await E.hideLesson(s.params.id.toString()),window.location.reload()}catch(r){console.log(r)}finally{l.value=!1}}async function C(){t.value=!0;try{await E.modifyLesson(s.params.id.toString()),window.location.reload()}catch(r){console.log(r)}finally{t.value=!1}}return(r,w)=>{var f,L,A,I,Z,X,ee,j,D,W,z,te,Y,ne,be;const g=F;return((f=$(n))==null?void 0:f.stage)=="prepare_for_submission"?(d(),h("div",Tn,[((L=$(i))==null?void 0:L.user_type)=="contributor"?(d(),h("div",Dn,[u(g,{label:"Send for review",severity:"info",size:"small",onClick:p,disabled:t.value,loading:t.value},null,8,["disabled","loading"])])):T("",!0)])):((A=$(n))==null?void 0:A.stage)=="waiting_for_review"?(d(),h("div",An,[((I=$(i))==null?void 0:I.user_type)=="contributor"?(d(),h("div",Fn,[u(g,{label:"Cancel submission",severity:"danger",size:"small",onClick:c,disabled:t.value,loading:t.value},null,8,["disabled","loading"])])):((Z=$(i))==null?void 0:Z.user_type)=="editor"?(d(),h("div",zn,[u(g,{label:"Start review",severity:"info",size:"small",onClick:b,disabled:t.value,loading:t.value},null,8,["disabled","loading"])])):T("",!0)])):((X=$(n))==null?void 0:X.stage)=="in_review"?(d(),h("div",Rn,[((ee=$(i))==null?void 0:ee.user_type)=="editor"?(d(),h("div",Pn,[u(g,{label:"Reject",severity:"danger",size:"small",onClick:k,disabled:t.value||l.value,loading:l.value},null,8,["disabled","loading"]),u(g,{label:"Accept",size:"small",onClick:m,disabled:t.value||l.value,loading:t.value},null,8,["disabled","loading"])])):T("",!0)])):((j=$(n))==null?void 0:j.stage)=="rejected"?(d(),h("div",En,[((D=$(i))==null?void 0:D.user_type)=="contributor"?(d(),h("div",Mn,[u(g,{label:"Edit submission",severity:"info",size:"small",onClick:v,disabled:t.value,loading:t.value},null,8,["disabled","loading"])])):T("",!0)])):((W=$(n))==null?void 0:W.stage)=="ready_for_publish"?(d(),h("div",Nn,[((z=$(i))==null?void 0:z.user_type)=="editor"?(d(),h("div",jn,[$(n).createdBy!=Number($(i).user_id)?(d(),S(g,{key:0,label:"Reject",severity:"danger",size:"small",onClick:k,disabled:t.value||l.value,loading:l.value},null,8,["disabled","loading"])):T("",!0),u(g,{label:"Publish",size:"small",onClick:x,disabled:t.value||l.value,loading:t.value},null,8,["disabled","loading"])])):T("",!0)])):((te=$(n))==null?void 0:te.stage)=="published"?(d(),h("div",Gn,[((Y=$(i))==null?void 0:Y.user_type)=="editor"?(d(),h("div",On,[u(g,{label:"Hide",severity:"danger",size:"small",onClick:U,disabled:t.value||l.value,loading:l.value},null,8,["disabled","loading"]),u(g,{label:"Modify",size:"small",onClick:C,disabled:t.value||l.value,loading:t.value},null,8,["disabled","loading"])])):T("",!0)])):((ne=$(n))==null?void 0:ne.stage)=="in_modify"?(d(),h("div",Hn,[((be=$(i))==null?void 0:be.user_type)=="editor"?(d(),h("div",qn,[u(g,{label:"Hide",severity:"danger",size:"small",onClick:U,disabled:t.value||l.value,loading:l.value},null,8,["disabled","loading"]),u(g,{label:"Publish",size:"small",onClick:x,disabled:t.value||l.value,loading:t.value},null,8,["disabled","loading"])])):T("",!0)])):T("",!0)}}}),Wn={key:0},Yn=V({__name:"StageStatus",setup(o){const s=G(),{selectedLesson:e}=M(s);return(i,a)=>{const n=lt;return $(e)?(d(),h("div",Wn,[["prepare_for_submission","waiting_for_review","in_review","in_modify"].includes($(e).stage)?(d(),S(n,{key:0,label:$(e).stage.replace(/_/g," ").replace(/^./,t=>t.toUpperCase()),icon:"pi pi-clock",pt:{icon:{class:"text-yellow-500"}},class:"h-8 bg-yellow-50 w-fit"},null,8,["label"])):["ready_for_publish","published"].includes($(e).stage)?(d(),S(n,{key:1,label:$(e).stage.replace(/_/g," ").replace(/^./,t=>t.toUpperCase()),icon:"pi pi-check-circle",pt:{icon:{class:"text-green-500"}},class:"h-8 bg-green-50 w-fit"},null,8,["label"])):["rejected"].includes($(e).stage)?(d(),S(n,{key:2,label:$(e).stage.replace(/_/g," ").replace(/^./,t=>t.toUpperCase()),icon:"pi pi-times-circle",pt:{icon:{class:"text-red-500"}},class:"h-8 bg-red-50 w-fit"},null,8,["label"])):T("",!0)])):T("",!0)}}}),Kn={class:"flex flex-col gap-4"},Qn={class:"flex justify-end gap-2 mt-4"},Zn=V({__name:"TranslateSelector",setup(o){const s=G(),{translateLessonToLang:e}=s,{selectedLesson:i}=M(s),a=_(!1),n=_(null),t=_(!1);async function l(){var p;if(!(!n.value||!((p=i.value)!=null&&p.id))){t.value=!0;try{console.log("▶️ Translating lesson",i.value.id,"→",n.value),await e(i.value.id,n.value),console.log("✅ Translation complete")}catch(c){console.error("❌ Translation error:",c)}finally{t.value=!1,a.value=!1}}}return(p,c)=>{const b=F,m=Ce,k=Ne;return d(),h("div",null,[u(b,{icon:"pi pi-language",variant:"text",severity:"contrast",onClick:c[0]||(c[0]=v=>a.value=!0)}),u(k,{visible:a.value,"onUpdate:visible":c[3]||(c[3]=v=>a.value=v),modal:"",header:"Translate lesson",style:{width:"400px"}},{default:R(()=>[y("div",Kn,[c[4]||(c[4]=y("label",{for:"targetLang",class:"font-semibold"}," Choose language to translate to: ",-1)),u(m,{id:"targetLang",modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=v=>n.value=v),options:$(at),optionLabel:"label",optionValue:"locale",placeholder:"Choose",class:"w-full"},null,8,["modelValue","options"]),y("div",Qn,[u(b,{label:"Cancel",text:"",onClick:c[2]||(c[2]=v=>a.value=!1)}),u(b,{label:"Translate",disabled:!n.value,loading:t.value,onClick:l},null,8,["disabled","loading"])])])]),_:1},8,["visible"])])}}}),Xn={class:"flex flex-col items-center"},eo={class:"flex justify-between items-center w-full min-h-16 border-b border-gray-200 px-8 shadow-md gap-8"},to={class:"flex items-center gap-4"},no={class:"flex items-center gap-4"},oo={class:"w-full h-full max-w-screen-lg px-4 md:px-28 py-8"},so={class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-50 border border-gray-200 flex flex-col items-center gap-4"},Fo=V({__name:"LessonEditPage",setup(o){const s=q(),e=ke(),i=$e(),{lang:a}=M(i),n=G(),{selectedLesson:t}=M(n),{loadLessonById:l}=n;H(()=>l(Number(s.params.id))),P(a,async(b,m)=>{b!==m&&t.value&&await l(t.value.id)});const p=()=>{const b=s.path.endsWith("/edit")?s.path.replace(/\/edit$/,""):"#";window.open(b,"_blank")};function c(){window.history.length>2?e.go(-1):e.push("/v2/routes")}return(b,m)=>{var v;const k=F;return d(),h("div",Xn,[y("div",eo,[y("div",to,[u(k,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:c}),u(Yn)]),y("div",no,[u(Jn)])]),y("div",oo,[(d(),S($n,{key:$(a),pages:(v=$(t))==null?void 0:v.pages},null,8,["pages"]))]),y("div",so,[u(Bn),u($(Ge)),u(k,{icon:"pi pi-eye",variant:"text",severity:"contrast",onClick:p}),u(Zn)])])}}});export{Fo as default};
