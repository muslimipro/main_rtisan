import{d as K,_ as pe,a as ve,b as fe,c as me,s as _e}from"./VideoViewer.vue_vue_type_script_setup_true_lang-CBsrNeKl.js";import{s as Y}from"./index-Bpp3W0nX.js";import{s as ye}from"./index-Biw4TmaB.js";import{b as V,o as n,c as u,i as l,g as v,a as g,F as H,k as J,l as i,E as U,j as we,t as G,d as ge,u as xe,r as o,x as be,e as Q,h as a,p as N,f as he,C as $e,D as ke,G as Le,K as Se,y as Ce,v as De,w as Ee}from"./index-BsDe7Jd6.js";import{u as Ie,a as Pe}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-B6mLFFGc.js";import{S as Ue}from"./SimulationView-BtlEheH1.js";import{_ as Ve}from"./CodeViewer.vue_vue_type_script_setup_true_lang-Dwzu0wMf.js";import{u as Be,L as Re}from"./lessonApi-CpnJMPHi.js";import{m as Te}from"./mapLessonFromDto-BRb_Xlqa.js";import{U as O}from"./unitApi-Ci_RN56J.js";import{m as Ne}from"./mapUnitFromDto-BRBO9875.js";import{s as ze}from"./index-Al-Y_3EX.js";import"./index-DM_vZNGK.js";import"./index-CzWox581.js";import"./index-CbDHaRwr.js";import"./index-B2sqmu40.js";import"./index--lncSA7P.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-zTnVSOL5.js";import"./index-BKvusrGu.js";import"./language-DYQF8nnT.js";const Ae={class:"rounded-2xl p-6 max-w-2xl mx-auto border border-slate-100 gap-2 flex flex-col"},We={class:"rounded-xl overflow-clip"},je=V({__name:"CodeReviseViewer",props:{state:{}},setup(m){const e=m;return(d,r)=>(n(),u("div",Ae,[r[0]||(r[0]=l("div",{class:"text-overline-small text-neutral600"},"Your answer",-1)),l("div",We,[v(K,{text:` \`\`\`python
${e.state.answer.code}
\`\`\` `},null,8,["text"])])]))}}),Fe={class:"rounded-2xl p-6 max-w-2xl mx-auto border border-slate-100 gap-2 flex flex-col"},qe={class:"space-y-1"},Me={class:"flex flex-wrap items-center gap-2 text-slate-800 bg-slate-50 rounded-xl px-3 py-2"},Ge={class:"text-slate-800"},Oe={class:"rounded-xl overflow-clip"},Ke=V({__name:"PibodyReviseViewer",props:{state:{}},setup(m){const e=m,d=["A","B","C","D","E","F","8","9"],r=g(()=>e.state.answer.slots.map((f,x)=>({slot:f,index:x})).filter(f=>f.slot!==""));return(f,x)=>{const _=ze;return n(),u("div",Fe,[x[0]||(x[0]=l("div",{class:"text-overline-small text-neutral600"},"Your answer",-1)),l("div",qe,[l("div",Me,[(n(!0),u(H,null,J(r.value,c=>(n(),i(_,{key:c.index,class:"font-medium text-slate-500"},{default:U(()=>[we(" Slot "+G(d[c.index])+": ",1),l("span",Ge,G(c.slot),1)]),_:2},1024))),128))])]),l("div",Oe,[v(K,{text:` \`\`\`python
${e.state.answer.code}
\`\`\` `},null,8,["text"])])])}}}),Ye=ge("lesson-revise-store",()=>{const m=xe(),e=o(null),d=o(!1),r=o(!1),f=o(!1),x=o(!1),_=o(!1),c=o(0),z=o(0),D=o([]),E=o([]),$=o(0),k=o(new Map),L=o([]),S=o(!1),I=o(!1),P=o(!1),B=o(!0),s=o(""),y=o(null),R=o(null),A=o([]),T=o([]),p=be(),X=Be(),{lang:Z}=Q(X),W=o(void 0),ee=g(()=>{var t;return P.value&&(((t=y.value)==null?void 0:t.modulesWerePut)??!0)&&B.value});async function te(t,h){try{d.value=!0,W.value=p.userRole==="editor"?Z.value:void 0;const{data:w}=await Re.getLessonById(t,h,W.value);e.value=Te(w),await q()}catch(w){m.add({severity:"error",summary:w.response.data.error,life:2e3})}finally{d.value=!1}}async function q(){if(e.value)try{_.value=!0,c.value=0,k.value.clear(),D.value=[];const t=[];e.value.pages.forEach(w=>{w.groups.forEach(j=>{j.units.forEach(F=>{t.push(F.id)})})});const{data:h}=await O.getUnitsByIdsandLessonId(t,e.value.id,W.value);for(const w of h)D.value.push(Ne(w));se()}catch(t){console.error("Error preloading units:",t)}finally{_.value=!1}}function M(t,h){if(e.value!=null){for(const[w,j]of E.value.entries())for(const[F,ce]of j.units.entries())if(ce.id==t){E.value[w].units[F].studentState.answer=h;break}}}function se(){s.value="emulatorID",R.value=Ie(s.value),R.value.setCode(""),y.value=Pe(s.value),y.value.addNeededModules([])}function oe(){k.value.clear(),c.value=0,_.value=!1}function ne(t){P.value=t}function le(){B.value=!0}async function ae(t){if(s.value=="")return;const h=Number(s.value.split("-")[1]);M(h,t),await O.saveUnitByIdandLessonId(h,e.value.id,{answer:t})}const b=g(()=>e.value?e.value.pages[z.value]??null:null),C=g(()=>b.value?b.value.groups[$.value]??null:null),re=g({get:()=>{var t;return((t=C.value)==null?void 0:t.pibodyDrawerVisible)??!1},set:t=>{C.value&&(C.value.pibodyDrawerVisible=t)}}),ie=g({get:()=>{var t;return((t=C.value)==null?void 0:t.codeDrawerVisible)??!1},set:t=>{C.value&&(C.value.codeDrawerVisible=t)}}),ue=g({get:()=>{var t;return((t=b.value)==null?void 0:t.showPibody)??!1},set:t=>{b.value&&(b.value.showPibody=t)}}),de=g({get:()=>{var t;return((t=b.value)==null?void 0:t.showCode)??!1},set:t=>{b.value&&(b.value.showCode=t)}});return{selectedLesson:e,isLessonLoading:d,isUnitLoading:r,units:D,groups:E,groupIndex:$,isGroupLoading:f,isSubmitLoading:x,isLoadingUnits:_,preloadingProgress:c,submitExist:S,correct:I,submitEnabled:ee,pageProgress:L,emulatorID:s,neededModules:A,slots:T,pibodyDrawerVisible:re,codeDrawerVisible:ie,showPibody:ue,showCode:de,setSubmitable:ne,loadLessonById:te,loadAllUnits:q,clearUnitsCache:oe,saveAnswer:M,runCodePressed:le,saveStudentIdeState:ae}}),He={key:1,class:"flex-grow px-4 py-2"},Je=V({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},setup(m){const e=m;return(d,r)=>{const f=Y;return n(),u("div",null,[d.loading?(n(),i(f,{key:0,class:"flex justify-center items-center w-10 h-full"})):(n(),u("div",He,[e.unit.unitType=="article"?(n(),i(a(pe),{key:0,article:e.unit.content},null,8,["article"])):e.unit.unitType=="options"?(n(),i(a(ve),{key:1,"options-data":e.unit.content,state:e.unit.studentState},null,8,["options-data","state"])):e.unit.unitType=="open"?(n(),i(a(fe),{key:2,state:e.unit.studentState},null,8,["state"])):e.unit.unitType=="video"?(n(),i(a(me),{key:3,video:e.unit.content},null,8,["video"])):e.unit.unitType=="code"?(n(),i(a(je),{key:4,state:e.unit.studentState},null,8,["state"])):e.unit.unitType=="pibody"?(n(),i(a(Ke),{key:5,state:e.unit.studentState},null,8,["state"])):N("",!0)]))])}}}),Qe={ref:"rootEl",class:"flex flex-col gap-8"},Xe=V({__name:"UnitsView",props:{units:{}},setup(m){return(e,d)=>(n(),u("div",Qe,[(n(!0),u(H,null,J(e.units,r=>(n(),i(Je,{key:r.id,unit:r},null,8,["unit"]))),128))],512))}}),Ze={class:"h-screen flex flex-col items-center overflow-hidden relative bg-white"},et={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 max-w-[1920px] mx-auto"},tt={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},st={class:"flex items-center gap-4"},ot={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4"},nt={class:"flex-1 overflow-y-auto mt-16 mb-0 w-full"},lt={key:1,class:"flex justify-center"},at={key:2},rt={key:0,class:"absolute left-0 top-1/2 -translate-y-1/2"},it={class:"relative h-full"},ut={class:"absolute -right-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},dt={key:1,class:"absolute right-0 top-1/2 -translate-y-1/2"},ct={class:"relative h-full"},pt={class:"absolute -left-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},Bt=V({__name:"LessonRevisePage",setup(m){const e=Ce(),d=De(),r=Ye(),{units:f,isLessonLoading:x,selectedLesson:_,showPibody:c,showCode:z}=Q(r),{loadLessonById:D}=r;function E(){e.query.route_id&&e.query.route_id!=""?d.push("/v2/route/"+e.query.route_id):d.push("/v2/home")}const $=o(window.innerWidth),k=o(16),L=o(!0),S=o(!0);function I(){if($.value=window.innerWidth,$.value<=1300){k.value=16;return}const s=452-($.value-1024)/2;k.value=s>16?s:16}he(()=>{I(),D(Number(e.params.id),(e.query.route_id??"").toString()),window.addEventListener("resize",I)}),$e(()=>{window.removeEventListener("resize",I)});const P=g(()=>$.value<=1920?{}:"calc((-100vw + 1920px) / 2)");return(B,s)=>{const y=Ee,R=ye,A=Y,T=_e;return n(),u("div",Ze,[l("div",et,[l("div",tt,[l("div",st,[v(y,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:E})]),a(_)?(n(),u("div",ot,[v(R,{value:100,"show-value":!1,class:"w-full rounded-full h-3"})])):N("",!0),s[7]||(s[7]=l("div",{class:"w-10"},null,-1))])]),l("div",nt,[l("div",{class:"w-full h-full max-w-screen-lg mx-auto py-8",style:ke({paddingLeft:k.value+"px",paddingRight:k.value+"px"})},[a(x)?(n(),i(A,{key:0,class:"flex justify-center"})):a(_)?(n(),u("div",at,[v(Xe,{units:a(f)},null,8,["units"])])):(n(),u("div",lt,"No lesson found"))],4)]),a(c)?(n(),u("div",rt,[v(y,{icon:"pi pi-microchip",severity:"secondary",onClick:s[0]||(s[0]=p=>L.value=!0),class:"w-8 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg mt-16"}),v(T,{visible:L.value,"onUpdate:visible":s[2]||(s[2]=p=>L.value=p),modal:!1,dismissable:!1,closeOnEscape:!1,class:"h-[calc(100vh-64px)] w-fit mt-16",pt:{root:{style:`right: ${P.value}`}}},{header:U(()=>s[8]||(s[8]=[l("div",null,null,-1)])),container:U(()=>[l("div",it,[l("div",ut,[v(y,{icon:"pi pi-chevron-left",severity:"secondary",onClick:s[1]||(s[1]=p=>L.value=!1),class:"w-5 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none"})]),(n(),i(a(Ue),{id:"emulatorID",key:"emulatorID",class:"w-full",horizontal:!1,autoPut:!0}))])]),_:1},8,["visible","pt"])])):N("",!0),a(z)?(n(),u("div",dt,[v(y,{icon:"pi pi-code",severity:"secondary",onClick:s[3]||(s[3]=p=>S.value=!0),class:"w-8 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none mt-16"}),v(T,{visible:S.value,"onUpdate:visible":s[6]||(s[6]=p=>S.value=p),header:"Drawer",modal:!1,dismissable:!1,closeOnEscape:!1,position:"right",class:"h-[calc(100vh-64px)] w-[452px] mt-16",pt:{root:{style:`left: ${P.value}`}}},{header:U(()=>s[9]||(s[9]=[l("div",null,null,-1)])),container:U(()=>[l("div",ct,[l("div",pt,[v(y,{icon:"pi pi-chevron-right",severity:"secondary",onClick:s[4]||(s[4]=p=>S.value=!1),class:"w-5 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg"})]),(n(),i(Se,null,[(n(),i(a(Ve),{id:"emulatorID",key:"emulatorID",connectbuttons:a(c),"onUpdate:connectbuttons":s[5]||(s[5]=p=>Le(c)?c.value=p:null)},null,8,["connectbuttons"]))],1024))])]),_:1},8,["visible","pt"])])):N("",!0)])}}});export{Bt as default};
