import{_ as ve,a as pe,b as fe,c as me,s as ye}from"./VideoViewer.vue_vue_type_script_setup_true_lang-Bqsbs2oA.js";import{s as Z}from"./index-D2ra_EFA.js";import{d as ge,u as we,r as o,x as ee,f as J,b as N,e as X,o as i,c as m,p as y,i as a,q as O,y as te,F as _e,l as be,z as Y,g as he,A as xe,j as d,h as x,t as Se,C as ke,D as V,E as H,K as Le,v as Ce,w as $e}from"./index-CRcQ_LZd.js";import{u as Ee,a as Pe,b as se}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-BavQ792j.js";import{S as Ie}from"./SimulationView-D0wr38ER.js";import{_ as Ue}from"./CodeViewer.vue_vue_type_script_setup_true_lang-DUG7eYC0.js";import{u as oe}from"./useLocaleStore-O7kaEZhf.js";import{L as Be}from"./lessonApi-D6LLn7IJ.js";import{m as Ae}from"./mapLessonFromDto-BRb_Xlqa.js";import{U as Q}from"./unitApi-LHd8Wnfh.js";import{m as De}from"./mapUnitFromDto-BRBO9875.js";import"./index-5sqcVIC2.js";import"./index-F1GMW6t5.js";import"./index-Cb3Rqpbh.js";import"./index-ukQs_Lon.js";import"./index-X1kAbo_w.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-c_9yoikE.js";import"./index-BjBwoSS1.js";import"./language-DYQF8nnT.js";const ne=ge("project-store",()=>{const U=we(),e=o(null),c=o(!1),_=o(!1),B=o(!1),$=o(!1),v=o(!1),S=o(0),A=o(0),n=o([]),g=o([]),k=o(0),w=o(new Map),E=o([]),K=o(!1),z=o(!1),R=o(!1),T=o(!0),p=o(""),D=o(null),b=o(null),h=o([]),L=o([]),P=ee(),j=oe(),{lang:W}=J(j),f=o(void 0),t=N(()=>{var s;return R.value&&(((s=D.value)==null?void 0:s.modulesWerePut)??!0)&&T.value});async function C(s,u){try{c.value=!0,f.value=P.userRole==="editor"?W.value:void 0;const{data:l}=await Be.getLessonById(s,u,f.value);e.value=Ae(l),await F()}catch(l){U.add({severity:"error",summary:l.response.data.error,life:2e3})}finally{c.value=!1}}async function F(){if(e.value)try{v.value=!0,S.value=0,w.value.clear(),n.value=[];const s=[];e.value.pages.forEach(l=>{l.groups.forEach(M=>{M.units.forEach(G=>{s.push(G.id)})})});const{data:u}=await Q.getUnitsByIdsandLessonId(s,e.value.id,f.value);for(const l of u)n.value.push(De(l)),["code","pibody"].includes(l.unit_type)&&r(l.unit_type,n.value[n.value.length-1])}catch(s){console.error("Error preloading units:",s)}finally{v.value=!1}}function q(s,u){if(e.value!=null){for(const[l,M]of g.value.entries())for(const[G,ce]of M.units.entries())if(ce.id==s){g.value[l].units[G].studentState.answer=u;break}}}function r(s,u){let l="";if(p.value==""||u.content.starting!=""){l=`emulator-${u.id}`;const M=u.studentState.answer.code;b.value=Ee(l),b.value.setCode(M)}p.value=l??p.value,s=="pibody"&&(D.value=Pe(p.value),h.value=u.data.neededModules,D.value.addNeededModules(h.value),l!=""&&(L.value=u.studentState.answer.slots))}function ae(){w.value.clear(),S.value=0,v.value=!1}function ie(s){R.value=s}function le(){T.value=!0}async function re(s){if(p.value=="")return;const u=Number(p.value.split("-")[1]);s.code=b.value.code,q(u,s),await Q.saveUnitByIdandLessonId(u,e.value.id,{answer:s})}const I=N(()=>e.value?e.value.pages[A.value]??null:null),ue=N({get:()=>{var s;return((s=I.value)==null?void 0:s.showPibody)??!1},set:s=>{I.value&&(I.value.showPibody=s)}}),de=N({get:()=>{var s;return((s=I.value)==null?void 0:s.showCode)??!1},set:s=>{I.value&&(I.value.showCode=s)}});return{selectedLesson:e,isLessonLoading:c,isUnitLoading:_,units:n,groups:g,groupIndex:k,isGroupLoading:B,isSubmitLoading:$,isLoadingUnits:v,preloadingProgress:S,submitExist:K,correct:z,submitEnabled:t,pageProgress:E,emulatorID:p,neededModules:h,slots:L,showPibody:ue,showCode:de,setSubmitable:ie,loadLessonById:C,loadAllUnits:F,clearUnitsCache:ae,saveAnswer:q,runCodePressed:le,saveStudentIdeState:re}}),je={key:1,class:"flex-grow px-4 py-2"},qe=X({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},setup(U){const e=U,c=te(),_=ne(),{saveAnswer:B,setSubmitable:$}=_;function v(n){e.unit.unitType=="options"?$(n.options.length>0):e.unit.unitType=="open"&&$(n.open.length>0),B(e.unit.id,n),S(n)}const S=se(n=>{A(n)},1e3,{maxWait:5e3});async function A(n){await Q.saveUnitByIdandLessonId(e.unit.id,Number(c.params.id),{answer:n})}return(n,g)=>{const k=Z;return i(),m("div",null,[n.loading?(i(),y(k,{key:0,class:"flex justify-center items-center w-10 h-full"})):(i(),m("div",je,[e.unit.unitType=="article"?(i(),y(a(ve),{key:0,article:e.unit.content},null,8,["article"])):e.unit.unitType=="options"?(i(),y(a(pe),{key:1,"options-data":e.unit.content,state:e.unit.studentState,onSaveAnswer:v},null,8,["options-data","state"])):e.unit.unitType=="open"?(i(),y(a(fe),{key:2,state:e.unit.studentState,onSaveAnswer:v},null,8,["state"])):e.unit.unitType=="video"?(i(),y(a(me),{key:3,video:e.unit.content},null,8,["video"])):O("",!0)]))])}}}),Me={ref:"rootEl",class:"flex flex-col gap-8"},Ne=X({__name:"UnitsView",props:{units:{}},setup(U){return(e,c)=>(i(),m("div",Me,[(i(!0),m(_e,null,be(e.units,_=>(i(),y(qe,{key:_.id,unit:_},null,8,["unit"]))),128))],512))}}),ze={class:"h-screen bg-white flex flex-col items-center overflow-hidden relative"},Re={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 max-w-[1920px] mx-auto"},Te={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},We={class:"flex items-center gap-4"},Fe={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4 justify-center"},Ve={class:"text-2xl"},Oe={class:"flex-1 overflow-y-auto mt-16 mb-0 w-full"},Ke={key:1,class:"flex justify-center"},Ge={key:2},He={key:0,class:"absolute left-0 top-1/2 -translate-y-1/2"},Je={class:"relative h-full"},Qe={class:"absolute -right-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},Xe={key:1,class:"absolute right-0 top-1/2 -translate-y-1/2"},Ye={class:"relative h-full"},Ze={class:"absolute -left-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},bt=X({__name:"ProjectPage",setup(U){const e=te(),c=Ce(),_=ee(),B=oe(),{lang:$}=J(B);Y($,async(f,t)=>{f!==t&&n.value&&await z(Number(e.params.id),(e.query.route_id??"").toString())});const v=ne(),{units:S,isLessonLoading:A,selectedLesson:n,emulatorID:g,neededModules:k,slots:w,showPibody:E,showCode:K}=J(v),{loadLessonById:z,saveStudentIdeState:R}=v;function T(){_.userRole=="editor"?e.query.route_id&&e.query.route_id!=""?c.push(`/v2/route/${e.query.route_id}/edit`):c.push("/v2/routes"):e.query.route_id&&e.query.route_id!=""?c.push("/v2/route/"+e.query.route_id):c.push("/v2/home")}Y(w,()=>{p({slots:w.value})});const p=se(f=>{R(f)},1e3,{maxWait:5e3});function D(f){p({slots:w.value})}const b=o(window.innerWidth),h=o(16),L=o(!0),P=o(!0);function j(){if(b.value=window.innerWidth,b.value<=1300){h.value=16;return}const t=452-(b.value-1024)/2;h.value=t>16?t:16}he(()=>{j(),z(Number(e.params.id),(e.query.route_id??"").toString()),window.addEventListener("resize",j)}),xe(()=>{window.removeEventListener("resize",j)});const W=N(()=>b.value<=1920?{}:"calc((-100vw + 1920px) / 2)");return(f,t)=>{const C=$e,F=Z,q=ye;return i(),m("div",ze,[d("div",Re,[d("div",Te,[d("div",We,[x(C,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:T})]),a(n)?(i(),m("div",Fe,[d("div",Ve,Se(a(n).name),1)])):O("",!0),t[9]||(t[9]=d("div",{class:"w-10"},null,-1))])]),d("div",Oe,[d("div",{class:"w-full h-full max-w-screen-lg mx-auto py-8",style:ke({paddingLeft:h.value+"px",paddingRight:h.value+"px"})},[a(A)?(i(),y(F,{key:0,class:"flex justify-center"})):a(n)?(i(),m("div",Ge,[x(Ne,{units:a(S)},null,8,["units"])])):(i(),m("div",Ke,"No lesson found"))],4)]),a(E)?(i(),m("div",He,[x(C,{icon:"pi pi-microchip",severity:"secondary",onClick:t[0]||(t[0]=r=>L.value=!0),class:"w-8 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg mt-16"}),x(q,{visible:L.value,"onUpdate:visible":t[4]||(t[4]=r=>L.value=r),modal:!1,dismissable:!1,closeOnEscape:!1,class:"h-[calc(100vh-64px)] w-fit mt-16",pt:{root:{style:`right: ${W.value}`}}},{header:V(()=>t[10]||(t[10]=[d("div",null,null,-1)])),container:V(()=>[d("div",Je,[d("div",Qe,[x(C,{icon:"pi pi-chevron-left",severity:"secondary",onClick:t[1]||(t[1]=r=>L.value=!1),class:"w-5 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none"})]),(i(),y(a(Ie),{id:a(g),key:a(g),slots:a(w),"onUpdate:slots":t[2]||(t[2]=r=>H(w)?w.value=r:null),neededModules:a(k),"onUpdate:neededModules":t[3]||(t[3]=r=>H(k)?k.value=r:null),class:"w-full",horizontal:!1,autoPut:!0},null,8,["id","slots","neededModules"]))])]),_:1},8,["visible","pt"])])):O("",!0),a(K)?(i(),m("div",Xe,[x(C,{icon:"pi pi-code",severity:"secondary",onClick:t[5]||(t[5]=r=>P.value=!0),class:"w-8 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none mt-16"}),x(q,{visible:P.value,"onUpdate:visible":t[8]||(t[8]=r=>P.value=r),header:"Drawer",modal:!1,dismissable:!1,closeOnEscape:!1,position:"right",class:"h-[calc(100vh-64px)] w-[452px] mt-16",pt:{root:{style:`left: ${W.value}`}}},{header:V(()=>t[11]||(t[11]=[d("div",null,null,-1)])),container:V(()=>[d("div",Ye,[d("div",Ze,[x(C,{icon:"pi pi-chevron-right",severity:"secondary",onClick:t[6]||(t[6]=r=>P.value=!1),class:"w-5 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg"})]),(i(),y(Le,null,[(i(),y(a(Ue),{id:a(g),key:a(g),connectbuttons:a(E),"onUpdate:connectbuttons":t[7]||(t[7]=r=>H(E)?E.value=r:null),onSaveAnswer:D},null,8,["id","connectbuttons"]))],1024))])]),_:1},8,["visible","pt"])])):O("",!0)])}}});export{bt as default};
