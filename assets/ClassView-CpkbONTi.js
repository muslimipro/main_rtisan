import{s as ce}from"./index-C1OZXwWa.js";import{s as de}from"./index-Dcimsdoi.js";import{b as ue,u as pe,z as fe,ad as me,r as c,e as ge,a as he,f as ve,o as i,l as m,E as l,c as b,t as r,i as o,g as a,j as g,h as S,p as V,F as D,k as L,y as ye,v as _e,b5 as be,w as $e,I as Ce}from"./index-CRqy2v5g.js";import{s as we,a as xe}from"./index-tTmNqjMf.js";import{s as ze}from"./index-aOvCueU7.js";import{s as Te,a as ke}from"./index-DUvsS5o2.js";import{s as Fe}from"./index-DM20WyF2.js";import{s as je}from"./index-DXgWTrfm.js";import{b as Se,a as Ve}from"./index-B1GPnGVH.js";import{s as De}from"./index-B31iczSB.js";import{s as Ne}from"./index-CsE7fwuf.js";import{u as Pe,S as $}from"./useSchoolStore-oqwEGo3t.js";import"./index-BppDnUrD.js";import"./index-BkVspKhF.js";import"./index-VtV6ykBj.js";import"./index-DHTXTWdU.js";import"./index-BbReKCKG.js";import"./index-Dm3FeG1e.js";import"./index-DUmaJzN8.js";import"./index-DTQ7lgp0.js";import"./index-BbXzjJEF.js";const Ie={key:1},Be={key:2,class:"flex flex-col items-start px-8 pb-4 gap-4"},Me={class:"flex items-center justify-between gap-2 w-full"},Ue={class:"flex flex-col gap-2"},Re={class:"text-3xl"},Ae={class:"text-sm"},He={class:"flex items-center px-4 self-end"},Le={class:"text-xl mr-2"},qe={class:"text-gray-500"},Ee={class:"flex items-center"},Ge={class:"flex-grow flex gap-2 items-center"},Oe={class:"text-xl text-gray-500"},Ke={class:"flex flex-col"},Je={class:"text-[10px] text-gray-500"},Qe={class:"flex justify-center text-[124px]"},We={class:"flex justify-between items-center mb-8"},Xe={class:"flex justify-end gap-2"},$s=ue({__name:"ClassView",setup(Ye){const C=pe(),N=fe(),h=ye(),P=_e(),{t:d}=me(),q=c(),v=c();(()=>{v.value={global:{value:null,matchMode:be.CONTAINS}}})();const I=Pe(),{teachers:B,school:E}=ge(I),{loadClasses:G}=I,u=c(null),M=c([]),w=c(!1),x=c(!1),z=c(!1),k=c(!1),y=c(!1),_=c(null);async function F(){if(!w.value){w.value=!0;try{const{data:e}=await $.getClass(Number(h.params.id));u.value=e??null,_.value=B.value.find(t=>{var T;return t.teacher_id==((T=u.value)==null?void 0:T.creator)})??null}catch(e){console.log(e)}finally{w.value=!1}}}async function O(){if(!x.value){x.value=!0;try{const{data:e}=await $.getClassStudents(Number(h.params.id));M.value=e??null}catch(e){console.log(e)}finally{x.value=!1}}}async function K(){}const J=["secondary","success","info","warn","danger","contrast"],U=he(()=>({}));ve(()=>{F(),K(),O()});function Q(){N.require({message:d("pages.school.confirmDeleteClass"),header:d("pages.school.confirmHeader"),icon:"pi pi-exclamation-triangle",rejectProps:{label:d("pages.school.confirmCancel"),severity:"secondary",outlined:!0},acceptProps:{label:d("pages.school.confirmDeleteBtn"),severity:"danger"},accept:()=>{W(Number(h.params.id))}})}async function W(e){try{const{data:t}=await $.deleteClass(e);await G(),P.go(-1),C.add({severity:"success",summary:t.message,life:2e3})}catch(t){C.add({severity:"error",summary:t.response.data.error,detail:t,life:2e3})}}async function X(){if(_.value){z.value=!0;try{await $.assignTeacherToClass(Number(h.params.id),_.value.teacher_id),await F()}catch(e){console.log(e)}finally{z.value=!1,y.value=!1}}}function Y(){N.require({message:d("pages.school.confirmDeleteTeacher"),header:d("pages.school.confirmHeader"),icon:"pi pi-exclamation-triangle",rejectProps:{label:d("pages.school.confirmCancel"),severity:"secondary",outlined:!0},acceptProps:{label:d("pages.school.confirmDeleteBtn"),severity:"danger"},accept:()=>{Z()}})}async function Z(){try{const{data:e}=await $.assignTeacherToClass(Number(h.params.id));await F(),C.add({severity:"success",summary:e.message,life:2e3})}catch(e){C.add({severity:"error",summary:e.response.data.error,detail:e,life:2e3})}}return(e,t)=>{const T=Ne,f=$e,ee=Se,se=De,ae=Ve,n=we,te=je,j=Te,R=Fe,le=ke,oe=ze,re=xe,A=Ce,ne=de,ie=ce;return i(),m(ie,{class:"min-w-0 flex-grow flex flex-col gap-2"},{default:l(()=>{var H;return[w.value?(i(),m(T,{key:0,class:"flex justify-center"})):u.value?(i(),b("div",Be,[o("div",Me,[o("div",Ue,[o("div",Re,r(u.value.name),1),o("div",Ae,r(e.$t("pages.school.since"))+" "+r(u.value.created_time.split("T")[0]),1)]),a(f,{icon:"pi pi-hashtag",label:e.$t("pages.school.classCode"),severity:"info",onClick:t[0]||(t[0]=s=>k.value=!0)},null,8,["label"])]),o("div",He,[o("div",Le,[o("span",qe,r(e.$t("pages.school.classTeacher")),1),g(": "+r(u.value.creator_name),1)]),a(f,{icon:"pi pi-pencil",severity:"info",variant:"text",rounded:"",onClick:t[1]||(t[1]=s=>y.value=!0)}),u.value.creator!=((H=S(E))==null?void 0:H.manager_id)?(i(),m(f,{key:0,icon:"pi pi-trash",severity:"danger",variant:"text",rounded:"",onClick:Y})):V("",!0)]),a(re,{ref_key:"dt",ref:q,filters:v.value,"onUpdate:filters":t[3]||(t[3]=s=>v.value=s),value:M.value,dataKey:"id",loading:x.value,scrollable:"",globalFilterFields:["name","email"],class:"overflow-hidden w-full",paginator:"",rows:25,rowsPerPageOptions:[5,10,25],groupHeader:!0,showGridlines:""},{header:l(()=>[o("div",Ee,[o("div",Ge,[o("div",Oe,r(e.$t("pages.school.students")),1)]),a(ae,null,{default:l(()=>[a(ee,null,{default:l(()=>t[8]||(t[8]=[o("i",{class:"pi pi-search"},null,-1)])),_:1}),a(se,{modelValue:v.value.global.value,"onUpdate:modelValue":t[2]||(t[2]=s=>v.value.global.value=s),placeholder:e.$t("pages.school.search")},null,8,["modelValue","placeholder"])]),_:1})])]),empty:l(()=>[g(r(e.$t("pages.school.noStudentsFound")),1)]),loading:l(()=>[g(r(e.$t("pages.school.loadingStudents")),1)]),default:l(()=>[a(le,{type:"header"},{default:l(()=>[a(j,null,{default:l(()=>[a(n,{header:e.$t("pages.school.projects"),rowspan:2,colspan:2,frozen:!0,alignFrozen:"left"},null,8,["header"]),(i(!0),b(D,null,L(U.value,(s,p)=>(i(),m(n,{key:p,colspan:s.learn+s.practice},{header:l(()=>[a(te,{class:"w-full text-md px-2",severity:p==999?"secondary":J[p]},{default:l(()=>[g(r(p==999?e.$t("pages.school.other"):`${e.$t("pages.school.level")} ${p}`),1)]),_:2},1032,["severity"])]),_:2},1032,["colspan"]))),128)),a(n,{header:"",rowspan:2,colspan:2,frozen:!0,alignFrozen:"right"})]),_:1}),a(j,null,{default:l(()=>[(i(!0),b(D,null,L(U.value,(s,p)=>(i(),b(D,{key:p},[s.learn>0?(i(),m(n,{key:0,colspan:s.learn},{header:l(()=>[a(R,{class:"w-full flex justify-center",size:"small",severity:"success"},{default:l(()=>[g(r(e.$t("pages.projects.learn")),1)]),_:1})]),_:2},1032,["colspan"])):V("",!0),s.practice>0?(i(),m(n,{key:1,colspan:s.practice},{header:l(()=>[a(R,{class:"w-full flex justify-center",size:"small",severity:"info"},{default:l(()=>[g(r(e.$t("pages.projects.practice")),1)]),_:1})]),_:2},1032,["colspan"])):V("",!0)],64))),128))]),_:1}),a(j,null,{default:l(()=>[a(n,{header:e.$t("pages.school.avatar"),frozen:!0,alignFrozen:"left"},null,8,["header"]),a(n,{header:e.$t("pages.school.name"),frozen:!0,alignFrozen:"left",sortable:"",field:"name"},null,8,["header"]),a(n,{header:e.$t("pages.school.xp"),frozen:!0,alignFrozen:"right",sortable:"",field:"xp"},null,8,["header"]),a(n,{header:"",frozen:!0,alignFrozen:"right"})]),_:1})]),_:1}),a(n,{field:"small_avatar_url",header:e.$t("pages.school.avatar"),sortable:"",frozen:!0,alignFrozen:"left"},{body:l(({data:s})=>[a(oe,{image:s.small_avatar_url},null,8,["image"])]),_:1},8,["header"]),a(n,{field:"name",header:e.$t("pages.school.name"),sortable:"",frozen:!0,alignFrozen:"left"},{body:l(({data:s})=>[o("div",Ke,[o("div",null,r(`${s.name.length>0?s.name:s.email}`),1),o("div",Je,r(`Last visited: ${s.last_activity_time.split("T")[0]}`),1)])]),_:1},8,["header"]),a(n,{field:"xp",header:e.$t("pages.school.xp"),sortable:"",frozen:!0,alignFrozen:"right"},{body:l(({data:s})=>[o("div",null,r(`${s.xp}xp`),1)]),_:1},8,["header"]),a(n,{exportable:!1,frozen:!0,alignFrozen:"right"},{body:l(({data:s})=>[a(f,{icon:"pi pi-angle-right",outlined:"",rounded:"",severity:"info",onClick:p=>S(P).push({name:"school-student",params:{id:s.id}})},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value","loading"]),a(f,{icon:"pi pi-trash",label:e.$t("pages.school.remove"),severity:"danger",onClick:Q,class:"self-end"},null,8,["label"])])):(i(),b("div",Ie,r(e.$t("pages.school.noData")),1)),a(A,{visible:k.value,"onUpdate:visible":t[4]||(t[4]=s=>k.value=s),modal:"",header:e.$t("pages.school.classCode")},{default:l(()=>{var s;return[o("div",Qe,r((s=u.value)==null?void 0:s.code),1)]}),_:1},8,["visible","header"]),a(A,{visible:y.value,"onUpdate:visible":t[7]||(t[7]=s=>y.value=s),modal:"",header:e.$t("pages.school.assignTeacher"),closable:!1},{default:l(()=>[o("div",We,[a(ne,{modelValue:_.value,"onUpdate:modelValue":t[5]||(t[5]=s=>_.value=s),options:S(B),"option-label":"email",placeholder:e.$t("pages.school.selectTeacher")},null,8,["modelValue","options","placeholder"])]),o("div",Xe,[a(f,{type:"button",label:e.$t("pages.school.cancel"),severity:"secondary",onClick:t[6]||(t[6]=s=>y.value=!1)},null,8,["label"]),a(f,{type:"button",label:e.$t("pages.school.assign"),onClick:X,loading:z.value,disabled:z.value},null,8,["label","loading","disabled"])])]),_:1},8,["visible","header"])]}),_:1})}}});export{$s as default};
