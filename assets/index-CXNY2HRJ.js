import{H as B,b as X,u as I,r as p,ad as ee,a as L,f as te,o as n,c as o,g as se,h as g,i as l,t as d,F as h,k as D,n as S,p as $,Z as T}from"./index-BsDe7Jd6.js";import{_ as ae}from"./MainHeader.vue_vue_type_script_setup_true_lang-IA3hGOZ7.js";import"./index-uSyKvKh9.js";import"./index-zTnVSOL5.js";import"./index-BKvusrGu.js";import"./logo-D1-3uCnC.js";const j={fetchAllBookings:ne,fetchStudentBookings:oe,bookSlot:le,cancelBooking:re,fetchAll:de,fetchMine:ce};async function ne(){const{data:_}=await B.get("/v2/booking");return _}async function oe(_){const{data:f}=await B.get(`/v2/booking/list/student/${_}`);return f}async function le(_){return B.post(`/v2/booking/${_}/student`)}async function re(_){return B.delete(`/v2/booking/${_}/student`)}async function de(){return await B.get("/v2/booking")}async function ce(){return await B.get("/v2/booking/list/student")}const ie={class:"flex flex-col min-h-screen bg-slate-50 gap-6"},ue={class:"flex-grow flex flex-col content-start gap-4 bg-slate-50 px-10 mb-6"},ge={class:"p-6"},ye={class:"text-2xl font-bold mb-4"},_e={class:"hidden md:flex items-center justify-center gap-4 mb-4"},ve={class:"font-semibold text-lg"},he={class:"md:hidden flex items-center justify-center gap-4 mb-4"},pe={class:"font-semibold text-lg"},fe={class:"max-w-6xl mx-auto flex flex-col items-center"},xe={class:"hidden md:block overflow-x-auto w-full relative"},me={class:"min-w-full text-center border border-slate-300"},ke={class:"text-xs text-slate-500"},be={class:"px-2 py-1 font-semibold bg-slate-50 sticky left-0 z-10 border border-slate-300"},we={key:0,class:"text-gray-400"},De={key:0},Se={class:"text-xs font-bold"},$e={key:0,class:"text-xs text-emerald-700 mt-1"},Be={key:1,class:"text-xs text-emerald-700 mt-1"},Ce={class:"flex gap-1 mt-1"},Le=["disabled","onClick"],Me={key:0},Ae={key:1},ze=["disabled","onClick"],Ee={key:0},We={key:1},Te={key:1,class:"text-gray-300 text-xs"},je={class:"md:hidden w-full"},Fe={class:"w-full text-center border border-slate-300"},Ve={class:"text-xs text-slate-500"},Ne={class:"px-2 py-1 font-semibold bg-slate-50 sticky left-0 z-10 border border-slate-300"},Ye={key:0,class:"text-gray-400"},He={key:0},Pe={class:"text-xs font-bold"},Re={key:0,class:"text-xs text-emerald-700 mt-1"},Ze={key:1,class:"text-xs text-emerald-700 mt-1"},qe={class:"flex gap-1 mt-1"},Ge=["disabled","onClick"],Je={key:0},Ke={key:1},Oe=["disabled","onClick"],Qe={key:0},Ue={key:1},Xe={key:1,class:"text-gray-300 text-xs"},lt=X({__name:"StudentScheduleView",setup(_){const f=I(),M=p([]),N=p([]),A=p(!1),x=p({}),m=p({}),{t:c}=ee();function Z(s){const a=new Date(s),t=a.getDay(),e=a.getDate()-(t+6)%7;return new Date(a.setDate(e))}const C=p(Z(new Date)),i=p(0);function z(s){const a=new Date(C.value);a.setDate(C.value.getDate()+s*7),C.value=a}function q(){z(-1)}function G(){z(1)}function J(){i.value>0?i.value--:(z(-1),i.value=6)}function K(){i.value<6?i.value++:(z(1),i.value=0)}const u=L(()=>{const s=[];for(let a=0;a<7;a++){const t=new Date(C.value);t.setDate(C.value.getDate()+a),s.push({date:t,label:c(`pages.schedule.weekDay${a+1}`),dateLabel:`${t.getDate().toString().padStart(2,"0")}.${(t.getMonth()+1).toString().padStart(2,"0")}`})}return s}),O=L(()=>{const s=u.value[0].date,a=u.value[6].date;return`${s.getDate().toString().padStart(2,"0")}.${(s.getMonth()+1).toString().padStart(2,"0")} - ${a.getDate().toString().padStart(2,"0")}.${(a.getMonth()+1).toString().padStart(2,"0")}`}),Q=L(()=>{const s=u.value[i.value];return`${s.label}, ${s.dateLabel}`}),Y=L(()=>{const s=new Date,a=u.value[i.value].date;return E(s,a)}),H=L(()=>{const s=u.value[0].date,a=u.value[6].date,t=new Set;return M.value.forEach(e=>{const w=new Date(e.starts_at);if(w>=s&&w<=a){const r=k(e.starts_at);t.add(r)}}),t.size===0&&t.add("09:00"),Array.from(t).sort()});function E(s,a){const t=new Date(s);return t.getFullYear()===a.getFullYear()&&t.getMonth()===a.getMonth()&&t.getDate()===a.getDate()}function W(s,a){return M.value.filter(t=>{const e=new Date(t.starts_at);return E(e,s)&&k(t.starts_at)===a})}function k(s){return new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})}function v(s){const a=M.value.find(t=>t.id===s);return a&&a.my_class===!0?!0:N.value.some(t=>t.booking_id===s)}function y(s){return s.active===!1}function b(s){return new Date(s.starts_at)<new Date}async function F(){var s,a;A.value=!0;try{const{data:t}=await j.fetchAll();M.value=t}catch(t){f.add({severity:"error",summary:((a=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:a.error)||"Error",life:2e3})}finally{A.value=!1}}async function V(){const{data:s}=await j.fetchMine();N.value=s??[]}te(async()=>{await F(),await V()});async function P(s){var a,t;x.value[s]=!0;try{const{data:e}=await j.bookSlot(s);await F(),await V(),f.add({severity:"success",summary:e.message,life:2e3})}catch(e){f.add({severity:"error",summary:((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.error)||"Error",life:2e3})}finally{x.value[s]=!1}}async function R(s){var a,t;m.value[s]=!0;try{await j.cancelBooking(s),await F(),await V()}catch(e){f.add({severity:"error",summary:((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.error)||"Error",life:2e3})}finally{m.value[s]=!1}}return(s,a)=>(n(),o("div",ie,[se(g(ae),{class:"bg-white"}),l("div",ue,[l("div",ge,[l("h2",ye,d(g(c)("pages.teacher.schedule")),1),l("div",_e,[l("button",{onClick:q,class:"px-3 py-1 rounded bg-slate-200 hover:bg-slate-300 text-sm"},d(g(c)("pages.schedule.prevWeek")),1),l("span",ve,d(O.value),1),l("button",{onClick:G,class:"px-3 py-1 rounded bg-slate-200 hover:bg-slate-300 text-sm"},d(g(c)("pages.schedule.nextWeek")),1)]),l("div",he,[l("button",{onClick:J,class:"px-3 py-1 rounded bg-slate-200 hover:bg-slate-300 text-sm"},"←"),l("span",pe,d(Q.value),1),l("button",{onClick:K,class:"px-3 py-1 rounded bg-slate-200 hover:bg-slate-300 text-sm"},"→")]),l("div",fe,[l("div",xe,[l("table",me,[l("thead",null,[l("tr",null,[a[0]||(a[0]=l("th",{class:"px-2 py-1 bg-slate-100 sticky left-0 z-10 border border-slate-300"},null,-1)),(n(!0),o(h,null,D(u.value,(t,e)=>(n(),o("th",{key:e,class:S(["px-2 py-1 border border-slate-300",E(t.date,new Date)?"bg-green-100":"bg-slate-100"])},[l("div",null,d(t.label),1),l("div",ke,d(t.dateLabel),1)],2))),128))])]),l("tbody",null,[(n(!0),o(h,null,D(H.value,t=>(n(),o("tr",{key:t},[l("td",be,d(t),1),(n(!0),o(h,null,D(u.value,(e,w)=>(n(),o("td",{key:w,class:S(["px-1 py-1 min-w-[120px] border border-slate-300",E(e.date,new Date)?"bg-green-50":""])},[A.value?(n(),o("div",we)):(n(),o(h,{key:1},[W(e.date,t).length?(n(),o("div",De,[(n(!0),o(h,null,D(W(e.date,t),r=>(n(),o("div",{key:r.id,class:S(["mb-1 p-1 rounded flex flex-col items-center justify-center",[y(r)?"bg-red-100 border-red-300":r.my_class===!0?"bg-orange-100 border-orange-300":v(r.id)?"bg-blue-100 border-blue-300":b(r)?"bg-gray-100 border-gray-300":"bg-emerald-50 border-emerald-200"]])},[l("span",Se,d(k(r.starts_at))+"-"+d(k(r.ends_at))+" ("+d(r.count)+"/"+d(r.max_count)+") ",1),r.my_class===!0&&!y(r)?(n(),o("div",$e,d(g(c)("pages.schedule.fixedLesson")),1)):$("",!0),v(r.id)&&!y(r)&&r.my_class!==!0?(n(),o("div",Be,d(g(c)("pages.schedule.freeLesson")),1)):$("",!0),l("div",Ce,[!v(r.id)&&r.count<r.max_count&&!b(r)&&!y(r)?(n(),o("button",{key:0,type:"button",class:"px-2 py-1 rounded bg-emerald-500 text-white hover:bg-emerald-600 text-xs",disabled:x.value[r.id],onClick:T(U=>P(r.id),["stop"])},[x.value[r.id]?(n(),o("span",Me,"...")):(n(),o("span",Ae,d(g(c)("pages.schedule.bookSlot")),1))],8,Le)):r.my_class!==!0&&v(r.id)&&!b(r)&&!y(r)?(n(),o("button",{key:1,type:"button",class:"px-2 py-1 rounded bg-red-500 text-white hover:bg-red-600 text-xs",disabled:m.value[r.id],onClick:T(U=>R(r.id),["stop"])},[m.value[r.id]?(n(),o("span",Ee,"...")):(n(),o("span",We,d(g(c)("pages.schedule.cancelBooking")),1))],8,ze)):$("",!0)])],2))),128))])):(n(),o("div",Te,"—"))],64))],2))),128))]))),128))])])]),l("div",je,[l("table",Fe,[l("thead",null,[l("tr",null,[a[1]||(a[1]=l("th",{class:"px-2 py-1 bg-slate-100 sticky left-0 z-10 w-1/5 border border-slate-300"},null,-1)),l("th",{class:S(["px-2 py-1 border border-slate-300",Y.value?"bg-green-100":"bg-slate-100"])},[l("div",null,d(u.value[i.value].label),1),l("div",Ve,d(u.value[i.value].dateLabel),1)],2)])]),l("tbody",null,[(n(!0),o(h,null,D(H.value,t=>(n(),o("tr",{key:t},[l("td",Ne,d(t),1),l("td",{class:S(["px-1 py-1 border border-slate-300",Y.value?"bg-green-50":""])},[A.value?(n(),o("div",Ye)):(n(),o(h,{key:1},[W(u.value[i.value].date,t).length?(n(),o("div",He,[(n(!0),o(h,null,D(W(u.value[i.value].date,t),e=>(n(),o("div",{key:e.id,class:S(["mb-2 p-2 rounded flex flex-col items-center justify-center",[y(e)?"bg-red-100 border-red-300":e.my_class===!0?"bg-orange-100 border-orange-300":v(e.id)?"bg-blue-100 border-blue-300":b(e)?"bg-gray-100 border-gray-300":"bg-emerald-50 border-emerald-200"]])},[l("span",Pe,d(k(e.starts_at))+"-"+d(k(e.ends_at))+" ("+d(e.count)+"/"+d(e.max_count)+") ",1),e.my_class===!0&&!y(e)?(n(),o("div",Re,d(g(c)("pages.schedule.fixedLesson")),1)):$("",!0),v(e.id)&&!y(e)&&e.my_class!==!0?(n(),o("div",Ze,d(g(c)("pages.schedule.freeLesson")),1)):$("",!0),l("div",qe,[!v(e.id)&&e.count<e.max_count&&!b(e)&&!y(e)?(n(),o("button",{key:0,type:"button",class:"px-2 py-1 rounded bg-emerald-500 text-white hover:bg-emerald-600 text-xs",disabled:x.value[e.id],onClick:T(w=>P(e.id),["stop"])},[x.value[e.id]?(n(),o("span",Je,"...")):(n(),o("span",Ke,d(g(c)("pages.schedule.bookSlot")),1))],8,Ge)):e.my_class!==!0&&v(e.id)&&!b(e)&&!y(e)?(n(),o("button",{key:1,type:"button",class:"px-2 py-1 rounded bg-red-500 text-white hover:bg-red-600 text-xs",disabled:m.value[e.id],onClick:T(w=>R(e.id),["stop"])},[m.value[e.id]?(n(),o("span",Qe,"...")):(n(),o("span",Ue,d(g(c)("pages.schedule.cancelBooking")),1))],8,Oe)):$("",!0)])],2))),128))])):(n(),o("div",Xe,"—"))],64))],2)]))),128))])])])])])])]))}});export{lt as default};
