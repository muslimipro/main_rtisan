import{s as ce}from"./index-Tyk5v5qC.js";import{s as de}from"./index-Deq_jJZH.js";import{e as ue,u as pe,Z as fe,a as me,r as c,f as ge,b as he,g as ve,o as i,p as m,D as l,c as b,t as r,j as o,h as a,k as g,i as S,q as D,F as V,l as A,y as ye,v as _e,b5 as be,w as $e,H as Ce}from"./index-CRcQ_LZd.js";import{s as we,a as xe}from"./index-kMIcTJwl.js";import{s as ze}from"./index-ARb1D-t-.js";import{s as Te,a as ke}from"./index-Cuudt7zM.js";import{s as Fe}from"./index-DBfKnEwG.js";import{s as je}from"./index-uBFrKglC.js";import{b as Se,a as De}from"./index-BsWwtUor.js";import{s as Ve}from"./index-5sqcVIC2.js";import{s as Ne}from"./index-D2ra_EFA.js";import{u as Pe,S as $}from"./useSchoolStore-DBgzC2Su.js";import"./index-ukQs_Lon.js";import"./index-KNiOdcss.js";import"./index-Ca6dKkpA.js";import"./index-c_9yoikE.js";import"./index-F1GMW6t5.js";import"./index-DJ7Ai9_T.js";import"./index-i5zJqUYc.js";import"./index-Cb3Rqpbh.js";import"./index-X1kAbo_w.js";const Be={key:1},Ie={key:2,class:"flex flex-col items-start px-8 pb-4 gap-4"},Me={class:"flex items-center justify-between gap-2 w-full"},Ue={class:"flex flex-col gap-2"},He={class:"text-3xl"},Re={class:"text-sm"},qe={class:"flex items-center px-4 self-end"},Ae={class:"text-xl mr-2"},Le={class:"text-gray-500"},Ge={class:"flex items-center"},Oe={class:"flex-grow flex gap-2 items-center"},Ee={class:"text-xl text-gray-500"},Ke={class:"flex flex-col"},Ze={class:"text-[10px] text-gray-500"},Je={class:"flex justify-center text-[124px]"},Qe={class:"flex justify-between items-center mb-8"},We={class:"flex justify-end gap-2"},$s=ue({__name:"ClassView",setup(Xe){const C=pe(),N=fe(),h=ye(),P=_e(),{t:d}=me(),L=c(),v=c();(()=>{v.value={global:{value:null,matchMode:be.CONTAINS}}})();const B=Pe(),{teachers:I,school:G}=ge(B),{loadClasses:O}=B,u=c(null),M=c([]),w=c(!1),x=c(!1),z=c(!1),k=c(!1),y=c(!1),_=c(null);async function F(){if(!w.value){w.value=!0;try{const{data:e}=await $.getClass(Number(h.params.id));u.value=e??null,_.value=I.value.find(t=>{var T;return t.teacher_id==((T=u.value)==null?void 0:T.creator)})??null}catch(e){console.log(e)}finally{w.value=!1}}}async function E(){if(!x.value){x.value=!0;try{const{data:e}=await $.getClassStudents(Number(h.params.id));M.value=e??null}catch(e){console.log(e)}finally{x.value=!1}}}async function K(){}const Z=["secondary","success","info","warn","danger","contrast"],U=he(()=>({}));ve(()=>{F(),K(),E()});function J(){N.require({message:d("pages.school.confirmDeleteClass"),header:d("pages.school.confirmHeader"),icon:"pi pi-exclamation-triangle",rejectProps:{label:d("pages.school.confirmCancel"),severity:"secondary",outlined:!0},acceptProps:{label:d("pages.school.confirmDeleteBtn"),severity:"danger"},accept:()=>{Q(Number(h.params.id))}})}async function Q(e){try{const{data:t}=await $.deleteClass(e);await O(),P.go(-1),C.add({severity:"success",summary:t.message,life:2e3})}catch(t){C.add({severity:"error",summary:t.response.data.error,detail:t,life:2e3})}}async function W(){if(_.value){z.value=!0;try{await $.assignTeacherToClass(Number(h.params.id),_.value.teacher_id),await F()}catch(e){console.log(e)}finally{z.value=!1,y.value=!1}}}function X(){N.require({message:d("pages.school.confirmDeleteTeacher"),header:d("pages.school.confirmHeader"),icon:"pi pi-exclamation-triangle",rejectProps:{label:d("pages.school.confirmCancel"),severity:"secondary",outlined:!0},acceptProps:{label:d("pages.school.confirmDeleteBtn"),severity:"danger"},accept:()=>{Y()}})}async function Y(){try{const{data:e}=await $.assignTeacherToClass(Number(h.params.id));await F(),C.add({severity:"success",summary:e.message,life:2e3})}catch(e){C.add({severity:"error",summary:e.response.data.error,detail:e,life:2e3})}}return(e,t)=>{const T=Ne,f=$e,ee=Se,se=Ve,ae=De,n=we,te=je,j=Te,H=Fe,le=ke,oe=ze,re=xe,R=Ce,ne=de,ie=ce;return i(),m(ie,{class:"min-w-0 flex-grow flex flex-col gap-2"},{default:l(()=>{var q;return[w.value?(i(),m(T,{key:0,class:"flex justify-center"})):u.value?(i(),b("div",Ie,[o("div",Me,[o("div",Ue,[o("div",He,r(u.value.name),1),o("div",Re,r(e.$t("pages.school.since"))+" "+r(u.value.created_time.split("T")[0]),1)]),a(f,{icon:"pi pi-hashtag",label:e.$t("pages.school.classCode"),severity:"info",onClick:t[0]||(t[0]=s=>k.value=!0)},null,8,["label"])]),o("div",qe,[o("div",Ae,[o("span",Le,r(e.$t("pages.school.classTeacher")),1),g(": "+r(u.value.creator_name),1)]),a(f,{icon:"pi pi-pencil",severity:"info",variant:"text",rounded:"",onClick:t[1]||(t[1]=s=>y.value=!0)}),u.value.creator!=((q=S(G))==null?void 0:q.manager_id)?(i(),m(f,{key:0,icon:"pi pi-trash",severity:"danger",variant:"text",rounded:"",onClick:X})):D("",!0)]),a(re,{ref_key:"dt",ref:L,filters:v.value,"onUpdate:filters":t[3]||(t[3]=s=>v.value=s),value:M.value,dataKey:"id",loading:x.value,scrollable:"",globalFilterFields:["name","email"],class:"overflow-hidden w-full",paginator:"",rows:25,rowsPerPageOptions:[5,10,25],groupHeader:!0,showGridlines:""},{header:l(()=>[o("div",Ge,[o("div",Oe,[o("div",Ee,r(e.$t("pages.school.students")),1)]),a(ae,null,{default:l(()=>[a(ee,null,{default:l(()=>t[8]||(t[8]=[o("i",{class:"pi pi-search"},null,-1)])),_:1}),a(se,{modelValue:v.value.global.value,"onUpdate:modelValue":t[2]||(t[2]=s=>v.value.global.value=s),placeholder:e.$t("pages.school.search")},null,8,["modelValue","placeholder"])]),_:1})])]),empty:l(()=>[g(r(e.$t("pages.school.noStudentsFound")),1)]),loading:l(()=>[g(r(e.$t("pages.school.loadingStudents")),1)]),default:l(()=>[a(le,{type:"header"},{default:l(()=>[a(j,null,{default:l(()=>[a(n,{header:e.$t("pages.school.projects"),rowspan:2,colspan:2,frozen:!0,alignFrozen:"left"},null,8,["header"]),(i(!0),b(V,null,A(U.value,(s,p)=>(i(),m(n,{key:p,colspan:s.learn+s.practice},{header:l(()=>[a(te,{class:"w-full text-md px-2",severity:p==999?"secondary":Z[p]},{default:l(()=>[g(r(p==999?e.$t("pages.school.other"):`${e.$t("pages.school.level")} ${p}`),1)]),_:2},1032,["severity"])]),_:2},1032,["colspan"]))),128)),a(n,{header:"",rowspan:2,colspan:2,frozen:!0,alignFrozen:"right"})]),_:1}),a(j,null,{default:l(()=>[(i(!0),b(V,null,A(U.value,(s,p)=>(i(),b(V,{key:p},[s.learn>0?(i(),m(n,{key:0,colspan:s.learn},{header:l(()=>[a(H,{class:"w-full flex justify-center",size:"small",severity:"success"},{default:l(()=>[g(r(e.$t("pages.projects.learn")),1)]),_:1})]),_:2},1032,["colspan"])):D("",!0),s.practice>0?(i(),m(n,{key:1,colspan:s.practice},{header:l(()=>[a(H,{class:"w-full flex justify-center",size:"small",severity:"info"},{default:l(()=>[g(r(e.$t("pages.projects.practice")),1)]),_:1})]),_:2},1032,["colspan"])):D("",!0)],64))),128))]),_:1}),a(j,null,{default:l(()=>[a(n,{header:e.$t("pages.school.avatar"),frozen:!0,alignFrozen:"left"},null,8,["header"]),a(n,{header:e.$t("pages.school.name"),frozen:!0,alignFrozen:"left",sortable:"",field:"name"},null,8,["header"]),a(n,{header:e.$t("pages.school.xp"),frozen:!0,alignFrozen:"right",sortable:"",field:"xp"},null,8,["header"]),a(n,{header:"",frozen:!0,alignFrozen:"right"})]),_:1})]),_:1}),a(n,{field:"small_avatar_url",header:e.$t("pages.school.avatar"),sortable:"",frozen:!0,alignFrozen:"left"},{body:l(({data:s})=>[a(oe,{image:s.small_avatar_url},null,8,["image"])]),_:1},8,["header"]),a(n,{field:"name",header:e.$t("pages.school.name"),sortable:"",frozen:!0,alignFrozen:"left"},{body:l(({data:s})=>[o("div",Ke,[o("div",null,r(`${s.name.length>0?s.name:s.email}`),1),o("div",Ze,r(`Last visited: ${s.last_activity_time.split("T")[0]}`),1)])]),_:1},8,["header"]),a(n,{field:"xp",header:e.$t("pages.school.xp"),sortable:"",frozen:!0,alignFrozen:"right"},{body:l(({data:s})=>[o("div",null,r(`${s.xp}xp`),1)]),_:1},8,["header"]),a(n,{exportable:!1,frozen:!0,alignFrozen:"right"},{body:l(({data:s})=>[a(f,{icon:"pi pi-angle-right",outlined:"",rounded:"",severity:"info",onClick:p=>S(P).push({name:"school-student",params:{id:s.id}})},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value","loading"]),a(f,{icon:"pi pi-trash",label:e.$t("pages.school.remove"),severity:"danger",onClick:J,class:"self-end"},null,8,["label"])])):(i(),b("div",Be,r(e.$t("pages.school.noData")),1)),a(R,{visible:k.value,"onUpdate:visible":t[4]||(t[4]=s=>k.value=s),modal:"",header:e.$t("pages.school.classCode")},{default:l(()=>{var s;return[o("div",Je,r((s=u.value)==null?void 0:s.code),1)]}),_:1},8,["visible","header"]),a(R,{visible:y.value,"onUpdate:visible":t[7]||(t[7]=s=>y.value=s),modal:"",header:e.$t("pages.school.assignTeacher"),closable:!1},{default:l(()=>[o("div",Qe,[a(ne,{modelValue:_.value,"onUpdate:modelValue":t[5]||(t[5]=s=>_.value=s),options:S(I),"option-label":"email",placeholder:e.$t("pages.school.selectTeacher")},null,8,["modelValue","options","placeholder"])]),o("div",We,[a(f,{type:"button",label:e.$t("pages.school.cancel"),severity:"secondary",onClick:t[6]||(t[6]=s=>y.value=!1)},null,8,["label"]),a(f,{type:"button",label:e.$t("pages.school.assign"),onClick:W,loading:z.value,disabled:z.value},null,8,["label","loading","disabled"])])]),_:1},8,["visible","header"])]}),_:1})}}});export{$s as default};
