import{a as I,a2 as ce,a3 as re,r as w,c as se,o as G,G as M,b as a,e as _,h as $,f as p,w as R,t as Y,n as ie,q as F,k as S,j as W,F as j,a4 as ve,g as b,x as H,d as we,u as be,s as P,a5 as xe,Q as $e,l as B,C as de,p as me,D as ke,E as Se,U as oe,i as ne,Y as Ce}from"./index-CqrHncwp.js";import{u as fe,d as Ue,_ as Le}from"./defaultConfirmDeleteOptions-EUUfz6pe.js";import{L as Ve}from"./lessonApi-sN6PhYGd.js";import{h as E}from"./http-Dp9UZaKl.js";import{m as Be}from"./mapLessonFromDto-BxEkOMg4.js";import{U as te}from"./unitApi-B6VYzTL0.js";import{s as Ie,a as De,b as Te,c as ze}from"./index-DPkudw1w.js";import{s as Fe}from"./index-Bz2avWh2.js";import{_ as pe,T as Ae}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-B-b3Tkrj.js";import{s as Re}from"./index-CfqgX4Wb.js";import{s as Me,a as Ee}from"./index-CHyMrW1F.js";import{s as Ne}from"./index-CStOu2H2.js";import{s as _e}from"./index-BU8VD61z.js";import{v as ge}from"./v4-CmTdKEVZ.js";import{_ as Pe}from"./CodeEditor.vue_vue_type_script_setup_true_lang-C2n8r96A.js";import{C as je}from"./cloudStorageApi-Ddk_02Jc.js";import{_ as Ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Oe}from"./index-BBqVcdTo.js";import{s as He}from"./index-DGa9v8Zf.js";import{s as ye}from"./index-CSdd1Zyi.js";import{u as qe}from"./index-DqTwODSC.js";import{s as Je}from"./index-DWdgdhmN.js";import{s as We}from"./index-STyxpM0_.js";import{T as Ye}from"./index-BhIgIjuh.js";import{s as Ke}from"./index-BBLNAogz.js";import"./mapUnitFromDto-BXFFFlEW.js";import"./index-BuNCOrFM.js";import"./index-Q-Y0xawK.js";import"./index-CWqhTR1L.js";import"./index-B_JRNsze.js";import"./index-CVODHrd5.js";import"./index-MeFpN6XJ.js";import"./index-ZxluIE0u.js";const A={hideLesson:Qe,modifyLesson:Xe,publishLesson:Ze,sendLessonForReview:et,cancelLessonReview:tt,startLessonReview:st,acceptLesson:ot,rejectLesson:nt,editLesson:lt};async function Qe(u){return await E.patch(`v2/lesson/${u}/hide`)}async function Xe(u){return await E.patch(`v2/lesson/${u}/modify`)}async function Ze(u){return await E.patch(`v2/lesson/${u}/publish`)}async function et(u){return await E.patch(`v2/lesson/${u}/review/send`)}async function tt(u){return await E.patch(`v2/lesson/${u}/review/cancel`)}async function st(u){return await E.patch(`v2/lesson/${u}/review/start`)}async function ot(u){return await E.patch(`v2/lesson/${u}/review/accept`)}async function nt(u){return await E.patch(`v2/lesson/${u}/review/reject`)}async function lt(u){return await E.patch(`v2/lesson/${u}/review/edit`)}const at={class:"flex items-center"},it={class:"flex items-center mr-2"},rt=I({__name:"HighlightEditor",props:ce({index:{},usedSlots:{}},{highlight:{},highlightModifiers:{}}),emits:ce(["remove","save"],["update:highlight"]),setup(u,{emit:i}){const l=u,d=re(u,"highlight"),n=w(""),t=w(null),e=w(null),s=w(!1),c=se(()=>t.value!=null&&e.value!=null),r=i,k=()=>{r("remove",l.index)};G(()=>{d.value&&(n.value=d.value.id,t.value=d.value.module,e.value=d.value.slot,s.value=d.value.autoPut)}),M([t,e,s],()=>{t.value!=null&&r("save",l.index,n.value,t.value,e.value,s.value)}),M(c,x=>{x||(s.value=!1)});const m=w(["A","B","C","D","E","F"]),C=w(["8","9"]),f=w(["LED","switch","push-button","light-sensor","touch-sensor","potentiometer","encoder","motion-detector","microphone","climate-sensor","gyro-accel","buzzer","color-sensor","joystick","distance-sensor","servo","led-tower"]),y=se(()=>{if(t.value){if(t.value==="servo"||t.value==="led-tower"){const U=C.value.filter(T=>!(l.usedSlots??[]).includes(T));return e.value&&!U.includes(e.value)&&U.unshift(e.value),[null,...U]}const v=m.value.filter(g=>!(l.usedSlots??[]).includes(g));return e.value&&!v.includes(e.value)&&v.unshift(e.value),[null,...v]}const o=[...m.value,...C.value].filter(h=>!(l.usedSlots??[]).includes(h));return e.value&&!o.includes(e.value)&&o.unshift(e.value),[null,...o]}),L=se(()=>e.value?e.value==="8"||e.value==="9"?["servo","led-tower"]:f.value.filter(x=>x!=="servo"&&x!=="led-tower"):f.value);return(x,o)=>{const h=_e,v=Ne,g=Me,U=Ee,T=F;return a(),_("div",at,[$("div",it,[p(h,{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=V=>s.value=V),binary:"","input-id":"autoput",disabled:!c.value},null,8,["modelValue","disabled"]),o[3]||(o[3]=$("label",{for:"autoput",class:"ml-1 text-sm"},"auto",-1))]),p(U,null,{default:R(()=>[p(v,{modelValue:t.value,"onUpdate:modelValue":o[1]||(o[1]=V=>t.value=V),options:L.value,placeholder:"Select module",class:"place-content-center",size:"small"},null,8,["modelValue","options"]),p(g,{class:"h-[35px]"},{default:R(()=>o[4]||(o[4]=[$("div",null,"=>",-1)])),_:1}),p(v,{modelValue:e.value,"onUpdate:modelValue":o[2]||(o[2]=V=>e.value=V),options:y.value,placeholder:"Select slot",size:"small"},{option:R(({option:V})=>[$("span",{class:ie(V===null?"text-gray-400":"")},Y(V===null?"[null]":V),3)]),value:R(({value:V})=>[$("span",{class:ie(V===null?"text-gray-400":"")},Y(V===null?"[null]":V),3)]),_:1},8,["modelValue","options"])]),_:1}),p(T,{icon:"pi pi-trash",variant:"text",severity:"danger","aria-label":"Remove",onClick:k,class:"ml-2"})])}}}),dt={class:"flex flex-col gap-2"},ut=I({__name:"HighlightPanel",props:{neededModules:{default:[]},neededModulesModifiers:{}},emits:["update:neededModules"],setup(u){const i=re(u,"neededModules");function l(){i.value=[...i.value,{autoPut:!1,module:null,slot:null,id:ge()}]}function d(t){i.value.splice(t,1)}function n(t,e,s,c,r){i.value[t].id=e,i.value[t].module=s,i.value[t].slot=c,i.value[t].autoPut=r}return(t,e)=>{const s=F,c=Re;return a(),S(c,{header:"Highlight slots & modules"},{default:R(()=>[$("div",dt,[(a(!0),_(j,null,W(i.value,(r,k)=>(a(),_("div",{key:r.id},[p(rt,{highlight:i.value[k],"onUpdate:highlight":m=>i.value[k]=m,index:k,usedSlots:i.value.filter((m,C)=>{var f;return C!==k&&((f=i.value[C])==null?void 0:f.slot)!=null}).map(m=>m.slot),onRemove:d,onSave:n},null,8,["highlight","onUpdate:highlight","index","usedSlots"])]))),128))]),p(s,{icon:"pi pi-plus",variant:"text","aria-label":"Add",class:"self-center mt-2",onClick:l})]),_:1})}}}),ct={class:"flex"},pt={class:"h-[500px] flex flex-col w-full relative"},vt={class:"flex h-full",style:{border:"0.1px solid #808080",borderTopLeftRadius:"12px",borderTopRightRadius:"12px",overflow:"hidden"}},mt={class:"absolute right-2 bottom-2"},le=!1,ft=I({__name:"PibodyEditor",props:{id:{},content:{},data:{}},emits:["save-content","show-tester"],setup(u,{emit:i}){const l=H(),d=u,n=i,t=w(""),e=w(""),s=w([]);let c=!0;ve(()=>{t.value=d.content.starting,e.value=d.content.answer,s.value=d.data.neededModules??[]}),M([t,e,s],()=>{if(console.log(1),c){c=!1;return}n("save-content",{starting:t.value,answer:e.value,hashed_answer:""},{neededModules:s.value.filter(k=>k.module!=null),tests:d.data.tests,includedCommandsForTests:d.data.includedCommandsForTests})},{deep:!0});function r(){n("show-tester",{lesson_id:l.params.id,unit_id:d.id.split("-")[1]})}return(k,m)=>{const C=F;return a(),_(j,null,[$("div",ct,[$("div",pt,[$("div",vt,[p(pe,{code:t.value,"onUpdate:code":m[0]||(m[0]=f=>t.value=f),runbuttons:!1,connectbuttons:le,id:d.id+"_",class:"flex-1"},null,8,["code","id"]),p(pe,{code:e.value,"onUpdate:code":m[1]||(m[1]=f=>e.value=f),connectbuttons:le,"onUpdate:connectbuttons":m[2]||(m[2]=f=>le=f),id:d.id,class:"flex-1"},null,8,["code","id"])]),$("div",mt,[p(C,{label:"Tests",icon:"pi pi-pen-to-square",class:"w-fit",severity:"info",onClick:r})]),p(b(Ae),{id:d.id,class:"flex-grow max-h-40"},null,8,["id"])])]),p(ut,{neededModules:s.value,"onUpdate:neededModules":m[3]||(m[3]=f=>s.value=f),class:"mb-2"},null,8,["neededModules"])],64)}}}),_t=["article","options","open","video","code","pibody"],O=we("lesson-edit-store",()=>{const u=be(),i=fe(),{lang:l}=P(i),d=w(null),n=w(!1),t=w(!1),e=w(!1),s=w(!1),c=w(!1),r=w(!1);function k(x){e.value=x}async function m(x){try{n.value=!0;const{data:o}=await Ve.getLessonById(x,void 0,l.value);d.value=Be(o)}catch(o){u.add({severity:"error",summary:o.response.data.error,life:2e3})}finally{n.value=!1}}async function C(x,o){try{t.value=!0;const{data:h}=await te.getUnitByIdandLessonId(x,o,l.value);return h}catch(h){u.add({severity:"error",summary:h.response.data.error,life:2e3})}finally{t.value=!1}}async function f(x){try{s.value=!0;const{data:o}=await te.createUnitByLessonId(d.value.id,x);u.add({severity:"success",summary:o.message,life:2e3})}catch(o){u.add({severity:"error",summary:o.response.data.error,life:2e3})}finally{s.value=!1}}async function y(x,o,h){try{c.value=!0;const{data:v}=await te.updateUnitByIdandLessonId(x,o,h,l.value);return v.unit_id}catch(v){u.add({severity:"error",summary:v.response.data.error,life:2e3})}finally{c.value=!1}}async function L(x,o){try{r.value=!0;const{data:h}=await te.deleteUnitByIdandLessonId(x,o);u.add({severity:"success",summary:h.message,life:2e3})}catch(h){u.add({severity:"error",summary:h.response.data.error,life:2e3})}finally{r.value=!1}}return{selectedLesson:d,isLessonLoading:n,isLessonSaving:e,isUnitLoading:t,isUnitCreating:s,isUnitUpdating:c,isUnitDeleting:r,setLessonSaving:k,loadLessonById:m,loadUnitByIdandLessonId:C,createUnit:f,updateUnitByIdandLessonId:y,deleteUnitByIdandLessonId:L}}),gt={class:"flex items-start"},yt=I({__name:"MdEditor",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(u){const i=re(u,"modelValue"),l=xe({title:{title:"Title",icon:"v-md-icon-tip",action(n){n.insert(t=>{const e="# <center>",s="</center>",r=t||"Title";return{text:`${e}${r}${s}`,selected:r}})}},icons:{title:"icons",icon:"v-md-icon-tip",menus:[{name:"Attention",text:"Attention",action(n){n.insert(()=>{const t='<span style="font-size: 20px">',e="</span>",s="⚠️";return{text:`${t}${s}${e}`,selected:s}})}},{name:"PiBody",text:"PiBody",action(n){n.insert(()=>{const t="<b>",e="</b>",s='<span style="color: #FF3F85"> Pi</span>Body';return{text:`${t}${s}${e}`,selected:s}})}},{name:"Run",text:"Run",action(n){n.insert(()=>({text:"▶️<b>Run</b>"}))}}]},style:{title:"Style",icon:"v-md-icon-tip",action(n){n.insert(t=>{const e='<span style="">',s="</span>",r=t||"placeholder";return{text:`${e}${r}${s}`,selected:r}})}},underline:{title:"Underline",icon:"v-md-icon-under-line",action(n){n.insert(t=>{const e='<span style="text-decoration: underline">',s="</span>",r=t||"placeholder";return{text:`${e}${r}${s}`,selected:r}})}},tip:{title:"Tip",icon:"v-md-icon-tip",action(n){n.insert(t=>{const e='<div style="background-color:#F3F5F7; padding: 20px; border-left: solid 8px #42B983">',s="</div>",r=t||"placeholder";return{text:`${e}${r}${s}`,selected:r}})}},note:{title:"Note",icon:"v-md-icon-tip",action(n){n.insert(t=>{const e='<div style="background-color:#F3F5F7; padding: 15px; border-left: solid 8px #FFCD6B; margin-bottom: 15px">',s="</div>",r=t||"placeholder";return{text:`${e}${r}${s}`,selected:r}})}}});async function d(n,t,e){const s=e[0],c=new FormData;c.append("file",s);try{const{data:r}=await je.uploadFile(c,"image_"),k=r.source_url;t({url:k,desc:"desc",width:"auto",height:"auto"})}catch(r){console.log(r)}}return(n,t)=>{const e=$e("v-md-editor");return a(),_("div",gt,[p(e,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=s=>i.value=s),mode:"edit",onChange:t[1]||(t[1]=s=>i.value=s),"left-toolbar":"undo redo clear | tip emoji todo-list | h bold italic strikethrough quote ul ol table hr link code image | title icons style underline tip note","right-toolbar":"",toolbar:l,"disabled-menus":[],onUploadImage:d},null,8,["modelValue","toolbar"])])}}}),he=Ge(yt,[["__scopeId","data-v-52e9f376"]]),ht=I({__name:"ArticleEditor",props:{article:{}},emits:["save-content"],setup(u,{emit:i}){const l=u,d=i,n=w("");let t=!0;return G(()=>{var e;n.value=((e=l.article)==null?void 0:e.text)??""}),M(n,()=>{if(t){t=!1;return}d("save-content",{text:n.value})},{flush:"post"}),(e,s)=>(a(),S(he,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=c=>n.value=c)},null,8,["modelValue"]))}}),wt={class:"flex flex-col gap-2"},bt={class:"flex gap-1 text-gray-500"},xt={class:"flex flex-col gap-1"},$t=I({__name:"OptionsEditor",props:{optionsData:{}},emits:["save-content"],setup(u,{emit:i}){const l=u,d=i,n=w(!1),t=w(!1),e=w(!1),s=w([]),c=w([]),r=w();let k=!0;G(()=>{var f,y,L,x,o,h;n.value=((f=l.optionsData)==null?void 0:f.shuffle)??!1,t.value=((y=l.optionsData)==null?void 0:y.feedback)??!1,e.value=((L=l.optionsData)==null?void 0:L.single)??!1,s.value=((x=l.optionsData)==null?void 0:x.options)??[],c.value=((o=l.optionsData)==null?void 0:o.answer)??[],r.value=l.optionsData&&l.optionsData.answer&&l.optionsData.answer.length>0?(h=l.optionsData)==null?void 0:h.answer[0]:void 0}),M([n,t,e,s,c,r],()=>{if(k){k=!1;return}d("save-content",{shuffle:n.value,feedback:t.value,single:e.value,options:s.value,answer:e.value?r.value?[r.value]:[]:c.value,hashed_answer:[]})},{deep:!0});function m(){s.value.push({id:ge(),text:""})}function C(f){s.value=s.value.filter(y=>y.id!==f),c.value=c.value.filter(y=>y!==f),r.value==f&&(r.value=void 0)}return(f,y)=>{const L=He,x=Oe,o=_e,h=F;return a(),_("div",wt,[$("div",bt,[y[5]||(y[5]=$("div",null,"shuffle:",-1)),p(L,{modelValue:n.value,"onUpdate:modelValue":y[0]||(y[0]=v=>n.value=v),class:"mr-2"},null,8,["modelValue"]),y[6]||(y[6]=$("div",null,"feedback:",-1)),p(L,{modelValue:t.value,"onUpdate:modelValue":y[1]||(y[1]=v=>t.value=v),class:"mr-2"},null,8,["modelValue"]),y[7]||(y[7]=$("div",null,"single:",-1)),p(L,{modelValue:e.value,"onUpdate:modelValue":y[2]||(y[2]=v=>e.value=v)},null,8,["modelValue"])]),$("div",xt,[(a(!0),_(j,null,W(s.value,v=>(a(),_("div",{key:v.id,class:"flex gap-2 items-center"},[e.value?(a(),S(x,{key:0,modelValue:r.value,"onUpdate:modelValue":y[3]||(y[3]=g=>r.value=g),value:v.id},null,8,["modelValue","value"])):(a(),S(o,{key:1,modelValue:c.value,"onUpdate:modelValue":y[4]||(y[4]=g=>c.value=g),value:v.id},null,8,["modelValue","value"])),p(he,{modelValue:v.text,"onUpdate:modelValue":g=>v.text=g,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"]),p(h,{icon:"pi pi-trash",variant:"text",severity:"danger",size:"small",onClick:g=>C(v.id)},null,8,["onClick"])]))),128))]),p(h,{icon:"pi pi-plus",label:"Add option",variant:"text",size:"small",onClick:m,class:"self-center"})])}}}),kt=I({__name:"OpenEditor",props:{open:{}},emits:["save-content"],setup(u,{emit:i}){const l=u,d=i,n=w("");let t=!0;return G(()=>{var e;n.value=((e=l.open)==null?void 0:e.answer)??""}),M(n,()=>{if(t){t=!1;return}d("save-content",{answer:n.value,hashed_answer:""})}),(e,s)=>{const c=ye;return a(),S(c,{type:"text",modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=r=>n.value=r??""),class:"w-full",size:"small"},null,8,["modelValue"])}}}),St=I({__name:"VideoEditor",props:{video:{}},emits:["save-content"],setup(u,{emit:i}){const l=u,d=i,n=w("");let t=!0;return G(()=>{var e;n.value=((e=l.video)==null?void 0:e.url)??""}),M(n,()=>{if(t){t=!1;return}d("save-content",{url:n.value})}),(e,s)=>{const c=ye;return a(),S(c,{type:"text",modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=r=>n.value=r??""),class:"w-full",size:"small"},null,8,["modelValue"])}}}),Ct={class:"bg-white rounded-lg border border-gray-200"},Ut={key:1,class:"flex flex-col h-full w-full"},Lt={class:"flex items-center gap-2 px-4 pt-2"},Vt={class:"text-sm"},Bt={class:"text-sm text-gray-500"},It={key:1,class:"flex-grow px-4 py-2"},Dt={class:"flex justify-end"},Tt=I({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},emits:["delete","update"],setup(u,{emit:i}){const l=u,d=i,n=H(),t=me(),e=O(),{updateUnitByIdandLessonId:s,setLessonSaving:c,loadUnitByIdandLessonId:r}=e,k=w(!1),m=w(null),C=w(null);ve(async()=>{k.value=!0;const o=await r(l.unit.id,Number(n.params.id));o&&(m.value=o.content,C.value=o.data),k.value=!1});function f(o,h){c(!0),L(o,h)}function y(o){t.push({name:"tester2",params:{lesson_id:o.lesson_id,unit_id:o.unit_id}})}const L=qe((o,h)=>{x(o,h)},1e3,{maxWait:5e3});async function x(o,h){const v=await s(l.unit.id,Number(n.params.id),{content:o,data:h});v&&d("update",l.unit,v),c(!1)}return(o,h)=>{const v=Fe,g=F;return a(),_("div",Ct,[o.loading?(a(),S(v,{key:0,class:"flex justify-center items-center w-10 h-full"})):(a(),_("div",Ut,[$("div",Lt,[$("div",Vt,Y(o.unit.id),1),$("div",Bt,Y(`${o.unit.unitType}`),1)]),k.value?(a(),S(v,{key:0,class:"flex justify-center items-center w-10 h-full"})):(a(),_("div",It,[o.unit.unitType=="article"?(a(),S(ht,{key:0,article:m.value,onSaveContent:f},null,8,["article"])):o.unit.unitType=="options"?(a(),S($t,{key:1,"options-data":m.value,onSaveContent:f},null,8,["options-data"])):o.unit.unitType=="open"?(a(),S(kt,{key:2,open:m.value,onSaveContent:f},null,8,["open"])):o.unit.unitType=="video"?(a(),S(St,{key:3,video:m.value,onSaveContent:f},null,8,["video"])):l.unit.unitType=="code"?(a(),S(b(Pe),{key:4,id:`code-${l.unit.id}`,code:m.value,onSaveContent:f,onShowTester:y},null,8,["id","code"])):l.unit.unitType=="pibody"?(a(),S(b(ft),{key:5,id:`code-${l.unit.id}`,content:m.value,data:C.value,onSaveContent:f,onShowTester:y},null,8,["id","content","data"])):B("",!0)])),$("div",Dt,[p(g,{icon:"pi pi-trash",size:"small",severity:"danger",variant:"text",onClick:h[0]||(h[0]=de(U=>d("delete",l.unit),["stop"]))})])]))])}}}),zt={class:"group w-full relative"},Ft={class:"flex"},ae=I({__name:"AddUnitButton",props:{unitId:{},showAddGroup:{type:Boolean},hided:{type:Boolean}},emits:["add-group-divider"],setup(u,{emit:i}){const l=u,d=i,n=H(),t=O(),{loadLessonById:e,createUnit:s}=t,c=w(),r=w(_t.map(m=>({label:m,command:async()=>{await s({unit_type:m,prev_unit_id:l.unitId??void 0}),await e(Number(n.params.id))}}))),k=m=>{c.value.toggle(m)};return(m,C)=>{const f=We,y=F,L=Je;return a(),_(j,null,[$("div",zt,[C[1]||(C[1]=$("div",{class:"h-3"},null,-1)),$("div",{class:ie(["absolute left-1/2 -translate-x-1/2 -top-5 group-hover:block mt-[9px] w-full",m.hided?"hidden":""])},[$("div",Ft,[p(f,{class:"w-7",type:"dashed"}),p(f,{class:"flex-grow",type:"dashed"}),p(y,{icon:"pi pi-plus",class:"flex self-end shadow-xl h-7",size:"small",onClick:k}),p(f,{class:"flex-grow",type:"dashed"}),m.showAddGroup?(a(),S(y,{key:0,icon:"pi pi-arrow-up-right-and-arrow-down-left-from-center",class:"flex self-end h-7",size:"small",variant:"text",onClick:C[0]||(C[0]=x=>d("add-group-divider"))})):(a(),S(f,{key:1,class:"w-7",type:"dashed"}))])],2)]),p(L,{ref_key:"menu",ref:c,model:r.value,popup:!0},null,8,["model"])],64)}}}),At=I({__name:"RemoveGroupButton",emits:["remove-group-divider"],setup(u,{emit:i}){const l=i;return(d,n)=>{const t=F;return a(),S(t,{icon:"pi pi-arrow-down-left-and-arrow-up-right-to-center",severity:"danger",class:"flex self-end h-7 w-7",size:"small",variant:"text",onClick:n[0]||(n[0]=de(e=>l("remove-group-divider"),["stop"]))})}}}),Rt={class:"flex flex-col gap-2"},Mt={class:"w-full flex justify-between gap-2 mr-4"},Et={class:"flex flex-row"},Nt={class:"flex flex-col p-2 rounded-lg bg-slate-50"},Pt=I({__name:"UnitsView",props:{pages:{}},setup(u){const i=u,l=H(),d=ke(),n=O(),{isUnitDeleting:t}=P(n),{loadLessonById:e,createUnit:s,deleteUnitByIdandLessonId:c}=n,r=w(null);async function k(g){await s({unit_type:"group-divider",prev_unit_id:g.id}),await e(Number(l.params.id))}async function m(){await s({unit_type:"page-divider"}),await e(Number(l.params.id))}async function C(g){await s({unit_type:"page-divider",prev_unit_id:g}),await c(g,Number(l.params.id)),await e(Number(l.params.id))}async function f(g){await c(g,Number(l.params.id)),await e(Number(l.params.id))}function y(g){r.value=g,d.require({...Ue,message:"Are you sure you want to delete this lesson?",accept:async()=>{await c(g.id,Number(l.params.id)),await e(Number(l.params.id))}})}function L(g,U){U>g.id&&(g.id=U)}const x=Number(l.params.id),o=`openedPanels-${x}`,h=w({});G(async()=>{const g=localStorage.getItem(o);g&&(h.value=JSON.parse(g)),await Se(),setTimeout(()=>{const U=localStorage.getItem(`lastOpenedGroup-${x}`);if(U){const T=document.getElementById(`group-${U}`);if(T){T.scrollIntoView({behavior:"smooth"});return}}},1e3)}),M(h,g=>{localStorage.setItem(o,JSON.stringify(g))},{deep:!0});function v(g,U){h.value[U]=g,h.value[U].length>0&&localStorage.setItem(`lastOpenedGroup-${x}`,g[g.length-1])}return(g,U)=>{const T=F,V=Ie,K=De,Q=Te,X=ze;return a(),_("div",Rt,[(a(!0),_(j,null,W(i.pages,N=>(a(),S(X,{value:h.value[N.id]||[],"onUpdate:value":D=>v(D,N.id),multiple:"",key:N.id,class:"flex flex-col gap-2 bg-white p-4 rounded-lg shadow-lg"},{default:R(()=>[(a(!0),_(j,null,W(N.groups,(D,q)=>(a(),S(Q,{key:D.id,value:D.id,id:`group-${D.id}`},{default:R(()=>[p(V,null,{default:R(()=>[$("div",Mt,[$("div",null,"Step: "+Y(q),1),$("div",Et,[q!=0?(a(),S(T,{key:0,icon:"pi pi-file-plus",class:"flex self-end h-7 w-7",size:"small",variant:"text",onClick:de(z=>C(D.id),["stop"])},null,8,["onClick"])):B("",!0),D.id!=-1?(a(),S(At,{key:1,onRemoveGroupDivider:z=>f(D.id)},null,8,["onRemoveGroupDivider"])):B("",!0)])])]),_:2},1024),p(K,{class:"flex flex-col"},{default:R(()=>[$("div",Nt,[(a(!0),_(j,null,W(D.units,(z,Z)=>{var J;return a(),_("div",{key:z.id},[Z==0?(a(),S(ae,{key:0,hided:!0,"unit-id":D.id,"show-add-group":!1},null,8,["unit-id"])):B("",!0),p(Tt,{unit:z,loading:((J=r.value)==null?void 0:J.id)===z.id&&b(t),onDelete:ee=>y(z),onUpdate:L},null,8,["unit","loading","onDelete"]),p(ae,{hided:!0,"unit-id":z.id,"show-add-group":!0,onAddGroupDivider:ee=>k(z)},null,8,["unit-id","onAddGroupDivider"])])}),128)),D.units.length==0?(a(),S(ae,{key:0,hided:!1,"unit-id":D.id,"show-add-group":!1},null,8,["unit-id"])):B("",!0)])]),_:2},1024)]),_:2},1032,["value","id"]))),128))]),_:2},1032,["value","onUpdate:value"]))),128)),p(T,{id:"newpage",icon:"pi pi-plus",label:"New page",variant:"text",size:"small",class:"flex self-center",onClick:U[0]||(U[0]=N=>m())})])}}}),jt={class:"w-[24px] h-[24px]"},Gt={key:0,class:"flex items-center"},Ot={key:0,class:"material-icons text-gray-500"},Ht={key:1,class:"material-icons text-gray-500"},qt={key:1},Jt={class:"material-icons text-gray-500"},Wt=I({__name:"AutoSaveCloud",setup(u){const i=O(),{selectedLesson:l,isLessonSaving:d}=P(i);return(n,t)=>{var s;const e=Ye;return a(),_("div",jt,[(s=b(l))!=null&&s.editable?(a(),_("div",Gt,[b(d)?oe((a(),_("span",Ht,t[1]||(t[1]=[ne("cloud_sync")]))),[[e,"Saving...",void 0,{bottom:!0}]]):oe((a(),_("span",Ot,t[0]||(t[0]=[ne("cloud_done")]))),[[e,"Saved",void 0,{bottom:!0}]])])):(a(),_("div",qt,[oe((a(),_("span",Jt,t[2]||(t[2]=[ne("cloud_off")]))),[[e,"Save not allowed",void 0,{bottom:!0}]])]))])}}}),Yt={key:0},Kt={key:0},Qt={key:1},Xt={key:0},Zt={key:1},es={key:2},ts={key:0,class:"flex gap-1"},ss={key:3},os={key:0},ns={key:4},ls={key:0,class:"flex gap-1"},as={key:5},is={key:0,class:"flex gap-1"},rs={key:6},ds={key:0,class:"flex gap-1"},us=I({__name:"StageButtons",setup(u){const i=H(),l=Ce(),{user:d}=P(l),n=O(),{selectedLesson:t}=P(n),e=w(!1),s=w(!1);async function c(){e.value=!0;try{await A.sendLessonForReview(i.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function r(){e.value=!0;try{await A.cancelLessonReview(i.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function k(){e.value=!0;try{await A.startLessonReview(i.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function m(){e.value=!0;try{await A.acceptLesson(i.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function C(){s.value=!0;try{await A.rejectLesson(i.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{s.value=!1}}async function f(){e.value=!0;try{await A.editLesson(i.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function y(){e.value=!0;try{await A.publishLesson(i.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}async function L(){s.value=!0;try{await A.hideLesson(i.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{s.value=!1}}async function x(){e.value=!0;try{await A.modifyLesson(i.params.id.toString()),window.location.reload()}catch(o){console.log(o)}finally{e.value=!1}}return(o,h)=>{var g,U,T,V,K,Q,X,N,D,q,z,Z,J,ee,ue;const v=F;return((g=b(t))==null?void 0:g.stage)=="prepare_for_submission"?(a(),_("div",Yt,[((U=b(d))==null?void 0:U.user_type)=="contributor"?(a(),_("div",Kt,[p(v,{label:"Send for review",severity:"info",size:"small",onClick:c,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((T=b(t))==null?void 0:T.stage)=="waiting_for_review"?(a(),_("div",Qt,[((V=b(d))==null?void 0:V.user_type)=="contributor"?(a(),_("div",Xt,[p(v,{label:"Cancel submission",severity:"danger",size:"small",onClick:r,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):((K=b(d))==null?void 0:K.user_type)=="editor"?(a(),_("div",Zt,[p(v,{label:"Start review",severity:"info",size:"small",onClick:k,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((Q=b(t))==null?void 0:Q.stage)=="in_review"?(a(),_("div",es,[((X=b(d))==null?void 0:X.user_type)=="editor"?(a(),_("div",ts,[p(v,{label:"Reject",severity:"danger",size:"small",onClick:C,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),p(v,{label:"Accept",size:"small",onClick:m,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((N=b(t))==null?void 0:N.stage)=="rejected"?(a(),_("div",ss,[((D=b(d))==null?void 0:D.user_type)=="contributor"?(a(),_("div",os,[p(v,{label:"Edit submission",severity:"info",size:"small",onClick:f,disabled:e.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((q=b(t))==null?void 0:q.stage)=="ready_for_publish"?(a(),_("div",ns,[((z=b(d))==null?void 0:z.user_type)=="editor"?(a(),_("div",ls,[b(t).createdBy!=Number(b(d).user_id)?(a(),S(v,{key:0,label:"Reject",severity:"danger",size:"small",onClick:C,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"])):B("",!0),p(v,{label:"Publish",size:"small",onClick:y,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((Z=b(t))==null?void 0:Z.stage)=="published"?(a(),_("div",as,[((J=b(d))==null?void 0:J.user_type)=="editor"?(a(),_("div",is,[p(v,{label:"Hide",severity:"danger",size:"small",onClick:L,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),p(v,{label:"Modify",size:"small",onClick:x,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):((ee=b(t))==null?void 0:ee.stage)=="in_modify"?(a(),_("div",rs,[((ue=b(d))==null?void 0:ue.user_type)=="editor"?(a(),_("div",ds,[p(v,{label:"Hide",severity:"danger",size:"small",onClick:L,disabled:e.value||s.value,loading:s.value},null,8,["disabled","loading"]),p(v,{label:"Publish",size:"small",onClick:y,disabled:e.value||s.value,loading:e.value},null,8,["disabled","loading"])])):B("",!0)])):B("",!0)}}}),cs={key:0},ps=I({__name:"StageStatus",setup(u){const i=O(),{selectedLesson:l}=P(i);return(d,n)=>{const t=Ke;return b(l)?(a(),_("div",cs,[["prepare_for_submission","waiting_for_review","in_review","in_modify"].includes(b(l).stage)?(a(),S(t,{key:0,label:b(l).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-clock",pt:{icon:{class:"text-yellow-500"}},class:"h-8 bg-yellow-50 w-fit"},null,8,["label"])):["ready_for_publish","published"].includes(b(l).stage)?(a(),S(t,{key:1,label:b(l).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-check-circle",pt:{icon:{class:"text-green-500"}},class:"h-8 bg-green-50 w-fit"},null,8,["label"])):["rejected"].includes(b(l).stage)?(a(),S(t,{key:2,label:b(l).stage.replace(/_/g," ").replace(/^./,e=>e.toUpperCase()),icon:"pi pi-times-circle",pt:{icon:{class:"text-red-500"}},class:"h-8 bg-red-50 w-fit"},null,8,["label"])):B("",!0)])):B("",!0)}}}),vs={class:"flex flex-col items-center"},ms={class:"flex justify-between items-center w-full min-h-16 border-b border-gray-200 px-8 shadow-md gap-8"},fs={class:"flex items-center gap-4"},_s={class:"flex items-center gap-4"},gs={class:"w-full h-full max-w-screen-lg px-4 md:px-28 py-8"},ys={class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-50 border border-gray-200 flex flex-col items-center gap-4"},Xs=I({__name:"LessonEditPage",setup(u){const i=H(),l=me(),d=fe(),{lang:n}=P(d),t=O(),{selectedLesson:e}=P(t),{loadLessonById:s}=t;G(()=>s(Number(i.params.id))),M(n,async(k,m)=>{k!==m&&e.value&&await s(e.value.id)});const c=()=>{const k=i.path.endsWith("/edit")?i.path.replace(/\/edit$/,""):"#";window.open(k,"_blank")};function r(){window.history.length>2?l.go(-1):l.push("/v2/routes")}return(k,m)=>{var f;const C=F;return a(),_("div",vs,[$("div",ms,[$("div",fs,[p(C,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:r}),p(ps)]),$("div",_s,[p(us)])]),$("div",gs,[(a(),S(Pt,{key:b(n),pages:(f=b(e))==null?void 0:f.pages},null,8,["pages"]))]),$("div",ys,[p(Wt),p(b(Le)),p(C,{icon:"pi pi-eye",variant:"text",severity:"contrast",onClick:c})])])}}});export{Xs as default};
